<ion-header>
  <ion-toolbar class="custom-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button color="light"></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <img src="assets/logo-blanco.png" alt="Cosmos Fitness" class="header-logo">
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding cosmos-page">

  <div class="page-header">
    <h1>Horarios disponibles</h1>
    <p class="subtitle">Reserva tu plaza en las pr√≥ximas clases</p>
  </div>

  <!-- FILTROS -->
  <div class="filtros-container">

    <ion-searchbar
      placeholder="Buscar clase..."
      [(ngModel)]="textoBusqueda"
      (ionInput)="aplicarFiltros()">
    </ion-searchbar>

    <div class="filtros-row">
      <ion-input
        type="date"
        [(ngModel)]="filtroFecha"
        (ionChange)="aplicarFiltros()">
      </ion-input>

      <ion-select
        placeholder="Profesor"
        [(ngModel)]="filtroProfesor"
        (ionChange)="aplicarFiltros()">

        <ion-select-option value="">
          Todos
        </ion-select-option>

        <ion-select-option
          *ngFor="let p of profesoresUnicos"
          [value]="p">

          {{p}}

        </ion-select-option>

      </ion-select>
    </div>
  </div>

  <!-- LISTA -->
  <div class="horarios-list" *ngIf="horariosFiltrados.length > 0; else sinHorarios">
    
    <ion-card *ngFor="let h of horariosFiltrados" class="horario-card">
      <ion-card-content>

        <!-- HEADER CON ICONO VISUAL -->
        <div class="horario-header">

          <div class="clase-visual"
               [ngClass]="getClaseColor(h.Clase?.nombre_clase)">
            
            <ion-icon
              [name]="getIconoClase(h.Clase?.nombre_clase)">
            </ion-icon>

          </div>

          <div class="clase-info">
            <h3 class="clase-title">
              {{ h.Clase?.nombre_clase }}
            </h3>

            <div class="plazas-badge"
                 [ngClass]="{'completo': !h.plazas_disponibles}">
              <ion-icon name="people-outline"></ion-icon>
              <span>{{ h.plazas_ocupadas }} / {{ h.plazas_totales }}</span>
            </div>
          </div>

        </div>

        <div class="horario-details">
          <div class="detail-row">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>{{ h.fecha }}</span>
          </div>
          
          <div class="detail-row">
            <ion-icon name="time-outline"></ion-icon>
            <span>{{ h.hora_inicio }} - {{ h.hora_fin }}</span>
          </div>
          
          <div class="detail-row">
            <ion-icon name="location-outline"></ion-icon>
            <span>{{ h.lugar }}</span>
          </div>
          
          <div class="detail-row">
            <ion-icon name="person-outline"></ion-icon>
            <span>
              {{ h.Clase?.profesor?.nombre }}
              {{ h.Clase?.profesor?.apellidos }}
            </span>
          </div>
        </div>

        <ion-button
          expand="block"
          class="btn-reservar"
          [ngClass]="{
            'btn-disabled': !h.plazas_disponibles || h.ya_reservado,
            'btn-success': h.plazas_disponibles && !h.ya_reservado
          }"
          [disabled]="!h.plazas_disponibles || h.ya_reservado"
          (click)="reservar(h)">

          <ion-icon 
            slot="start" 
            [name]="h.ya_reservado ? 'checkmark-circle' : (!h.plazas_disponibles ? 'close-circle' : 'add-circle')">
          </ion-icon>

          <ng-container *ngIf="h.ya_reservado">
            Ya reservado
          </ng-container>

          <ng-container *ngIf="!h.ya_reservado && !h.plazas_disponibles">
            Completo
          </ng-container>

          <ng-container *ngIf="!h.ya_reservado && h.plazas_disponibles">
            Reservar plaza
          </ng-container>

        </ion-button>

      </ion-card-content>
    </ion-card>
  </div>

  <ng-template #sinHorarios>
    <div class="empty-state">
      <ion-icon name="calendar-outline"></ion-icon>
      <h3>No hay horarios disponibles</h3>
      <p>Debes disponer de un bono activo para ver los horarios disponibles.</p>
      <ion-button routerLink="/bonos" class="btn-primary">
        <ion-icon slot="start" name="cart-outline"></ion-icon>
        Ver bonos disponibles
      </ion-button>
    </div>
  </ng-template>

</ion-content>