==============================================================================
RESUMEN EJECUTIVO DE C√ìDIGO FUENTE
==============================================================================

[ARCHIVO]: ./.dockerignore
------------------------------------------------------------------------------
node_modules
npm-debug.log
------------------------------------------------------------------------------

[ARCHIVO]: ./.gitignore
------------------------------------------------------------------------------
# Node
node_modules/
npm-debug.log*
yarn-error.log*

# Environment
.env

# Docker
*.log

# Angular / Ionic
dist/
.angular/
www/

# OS
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/


------------------------------------------------------------------------------

[ARCHIVO]: ./package.json
------------------------------------------------------------------------------
{
  "name": "cosmos-api",
  "version": "1.0.0",
  "main": "src/app.js",
  "scripts": {
    "start": "node src/app.js",
    "dev": "nodemon src/app.js"
  },
  "dependencies": {
    "express": "^5.2.1",
    "sequelize": "^6.37.0",
    "pg": "^8.11.0",
    "pg-hstore": "^2.3.4",
    "dotenv": "^16.4.0",
    "cors": "^2.8.5"
  },
  "devDependencies": {
    "nodemon": "^3.0.0"
  }
}
------------------------------------------------------------------------------

[ARCHIVO]: ./stop.sh
------------------------------------------------------------------------------
#!/bin/bash

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "üõë Parando Cosmos Fitness..."
$COMPOSE down
echo "üóëÔ∏è Borrando volumen de datos de Postgres..."
docker volume rm proyectocosmos_postgres_data

------------------------------------------------------------------------------

[ARCHIVO]: ./README.md
------------------------------------------------------------------------------
# ProyectoCosmos

#Usuarios de prueba

Cliente:
juan@mail.com
 / 1234

Profesor:
ana@mail.com
 / 1234

Admin:
admin@mail.com
 / admin



 // Configurar el repo:

 git clone https://github.com/TU_USUARIO/ProyectoCosmos.git


Ejemplo clone : https://github.com/ieselrincon-dnavori/ProyectoCosmos
 
 
 
 
cd NOMBRE_DEL_PROYECTO
chmod +x *.ps1


Configurar tus credenciales globales para git/github

git config --global credential.helper store




/// EJECUTAR ESTO SI NO FUNCIONA LOS SCRIPT PARA WINDOWS

Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser



//USO DE LA API

Ver horarios
    curl -s http://localhost:3000/horarios | jq


------------------------------------------------------------------------------

[ARCHIVO]: ./win_stop.ps1
------------------------------------------------------------------------------
Write-Host "üõë Parando Cosmos Fitness..."

# Detectar si existe docker-compose
$compose = "docker compose"

if (Get-Command "docker-compose" -ErrorAction SilentlyContinue) {
    $compose = "docker-compose"
}

Write-Host "‚û° Usando: $compose"

# Parar contenedores
Invoke-Expression "$compose down"

------------------------------------------------------------------------------

[ARCHIVO]: ./codigo_proyecto2.txt
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./win_subirGitHub.ps1
------------------------------------------------------------------------------
# Configuraci√≥n de codificaci√≥n para emojis
$OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8

Write-Host "==============================" -ForegroundColor Cyan
Write-Host " üöÄ GESTI√ìN DE REPOSITORIO" -ForegroundColor Cyan
Write-Host "==============================" -ForegroundColor Cyan

# 1. COMPROBAR CAMBIOS NUEVOS EN LA NUBE
Write-Host "üîç Buscando cambios nuevos en GitHub..." -ForegroundColor Gray
git fetch | Out-Null

$cambiosNuevos = git log HEAD..origin/main --oneline --pretty=format:"- %an: %s"

if ($cambiosNuevos) {
    Write-Host "‚ö†Ô∏è  HAY CAMBIOS NUEVOS DE TU COMPA√ëERO/A:" -ForegroundColor Yellow
    Write-Host $cambiosNuevos
    Write-Host "`nüì• Descargando actualizaciones antes de continuar..." -ForegroundColor Gray
    git pull
} else {
    Write-Host "‚ú® Todo actualizado, no hay cambios externos." -ForegroundColor Green
}

Write-Host "`n------------------------------"

# 2. MEN√ö DE SELECCI√ìN DE USUARIO
Write-Host "üë§ ¬øQui√©n est√° realizando los cambios ahora?"
Write-Host " [ 1 ] - Domingo"
Write-Host " [ 2 ] - D√°maris"
Write-Host " [ 0 ] - Salir"
Write-Host "------------------------------"
$opcion = Read-Host "Selecciona una opci√≥n"

switch ($opcion) {
    "1" {
        $userName = "Domingo"
        $userEmail = "domingojosenavarroorihuela@alumno.ieselrincon.es"
    }
    "2" {
        $userName = "D√°maris"
        $userEmail = "damarisvidalrodriguez@alumno.ieselrincon.es"
    }
    "0" {
        Write-Host "üëã Saliendo..." -ForegroundColor Yellow
        exit
    }
    Default {
        Write-Host "‚ùå Opci√≥n no v√°lida." -ForegroundColor Red
        exit
    }
}

# Configurar identidad local
git config user.name "$userName"
git config user.email "$userEmail"

# 3. PROCESO DE SUBIDA
if (-not (Test-Path ".git")) {
    Write-Host "‚ùå Error: No es un repositorio git." -ForegroundColor Red
    exit
}

Write-Host "`nüìã Estado actual:" -ForegroundColor Yellow
git status -s

Write-Host "`n‚ûï A√±adiendo archivos..." -ForegroundColor Yellow
git add .

$mensaje = Read-Host "‚úèÔ∏è  Mensaje del commit"
if ([string]::IsNullOrWhiteSpace($mensaje)) {
    $mensaje = "Actualizaci√≥n autom√°tica por $userName"
}

Write-Host "üì¶ Creando commit..." -ForegroundColor Yellow
git commit -m "$mensaje"

Write-Host "‚¨ÜÔ∏è  Subiendo a GitHub..." -ForegroundColor Yellow
git push

Write-Host "======================================" -ForegroundColor Green
Write-Host " ‚úÖ PROYECTO SUBIDO POR $userName" -ForegroundColor Green
Write-Host "======================================" -ForegroundColor Green
------------------------------------------------------------------------------

[ARCHIVO]: ./restart.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  REINICIANDO COSMOS FITNESS"
echo "=============================="

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "‚û° Usando: $COMPOSE"

echo "üõë Parando contenedores..."
$COMPOSE down

echo "üöÄ Levantando servicios SIN rebuild..."
$COMPOSE up -d

echo ""
echo "üí° Si cambiaste Dockerfile o package.json usa:"
echo "   docker compose up -d --build"

echo "=============================="
echo " COSMOS FITNESS REINICIADO"
echo "=============================="


------------------------------------------------------------------------------

[ARCHIVO]: ./codigo_proyecto.txt
------------------------------------------------------------------------------
==============================================================================
RESUMEN EJECUTIVO DE C√ìDIGO FUENTE
==============================================================================

[ARCHIVO]: ./.dockerignore
------------------------------------------------------------------------------
node_modules
npm-debug.log
------------------------------------------------------------------------------

[ARCHIVO]: ./.gitignore
------------------------------------------------------------------------------
# Node
node_modules/
npm-debug.log*
yarn-error.log*

# Environment
.env

# Docker
*.log

# Angular / Ionic
dist/
.angular/
www/

# OS
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/


------------------------------------------------------------------------------

[ARCHIVO]: ./package.json
------------------------------------------------------------------------------
{
  "name": "cosmos-api",
  "version": "1.0.0",
  "main": "src/app.js",
  "scripts": {
    "start": "node src/app.js",
    "dev": "nodemon src/app.js"
  },
  "dependencies": {
    "express": "^5.2.1",
    "sequelize": "^6.37.0",
    "pg": "^8.11.0",
    "pg-hstore": "^2.3.4",
    "dotenv": "^16.4.0",
    "cors": "`2.8.5"
  },
  "devDependencies": {
    "nodemon": "^3.0.0"
  }
}
------------------------------------------------------------------------------

[ARCHIVO]: ./stop.sh
------------------------------------------------------------------------------
#!/bin/bash

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "üõë Parando Cosmos Fitness..."
$COMPOSE down
echo "üóëÔ∏è Borrando volumen de datos de Postgres..."
docker volume rm proyectocosmos_postgres_data

------------------------------------------------------------------------------

[ARCHIVO]: ./README.md
------------------------------------------------------------------------------
# ProyectoCosmos

#Usuarios de prueba

Cliente:
juan@mail.com
 / 1234

Profesor:
ana@mail.com
 / 1234

Admin:
admin@mail.com
 / admin



 // Configurar el repo:

 git clone https://github.com/TU_USUARIO/ProyectoCosmos.git


Ejemplo clone : https://github.com/ieselrincon-dnavori/ProyectoCosmos
 
 
 
 
cd NOMBRE_DEL_PROYECTO
chmod +x *.ps1


Configurar tus credenciales globales para git/github

git config --global credential.helper store




/// EJECUTAR ESTO SI NO FUNCIONA LOS SCRIPT PARA WINDOWS

Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser



//USO DE LA API

Ver horarios
    curl -s http://localhost:3000/horarios | jq


------------------------------------------------------------------------------

[ARCHIVO]: ./win_stop.ps1
------------------------------------------------------------------------------
Write-Host "üõë Parando Cosmos Fitness..."

# Detectar si existe docker-compose
$compose = "docker compose"

if (Get-Command "docker-compose" -ErrorAction SilentlyContinue) {
    $compose = "docker-compose"
}

Write-Host "‚û° Usando: $compose"

# Parar contenedores
Invoke-Expression "$compose down"

------------------------------------------------------------------------------

[ARCHIVO]: ./win_subirGitHub.ps1
------------------------------------------------------------------------------
# Configuraci√≥n de codificaci√≥n para emojis
$OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8

Write-Host "==============================" -ForegroundColor Cyan
Write-Host " üöÄ GESTI√ìN DE REPOSITORIO" -ForegroundColor Cyan
Write-Host "==============================" -ForegroundColor Cyan

# 1. COMPROBAR CAMBIOS NUEVOS EN LA NUBE
Write-Host "üîç Buscando cambios nuevos en GitHub..." -ForegroundColor Gray
git fetch | Out-Null

$cambiosNuevos = git log HEAD..origin/main --oneline --pretty=format:"- %an: %s"

if ($cambiosNuevos) {
    Write-Host "‚ö†Ô∏è  HAY CAMBIOS NUEVOS DE TU COMPA√ëERO/A:" -ForegroundColor Yellow
    Write-Host $cambiosNuevos
    Write-Host "`nüì• Descargando actualizaciones antes de continuar..." -ForegroundColor Gray
    git pull
} else {
    Write-Host "‚ú® Todo actualizado, no hay cambios externos." -ForegroundColor Green
}

Write-Host "`n------------------------------"

# 2. MEN√ö DE SELECCI√ìN DE USUARIO
Write-Host "üë§ ¬øQui√©n est√° realizando los cambios ahora?"
Write-Host " [ 1 ] - Domingo"
Write-Host " [ 2 ] - D√°maris"
Write-Host " [ 0 ] - Salir"
Write-Host "------------------------------"
$opcion = Read-Host "Selecciona una opci√≥n"

switch ($opcion) {
    "1" {
        $userName = "Domingo"
        $userEmail = "domingojosenavarroorihuela@alumno.ieselrincon.es"
    }
    "2" {
        $userName = "D√°maris"
        $userEmail = "damarisvidalrodriguez@alumno.ieselrincon.es"
    }
    "0" {
        Write-Host "üëã Saliendo..." -ForegroundColor Yellow
        exit
    }
    Default {
        Write-Host "‚ùå Opci√≥n no v√°lida." -ForegroundColor Red
        exit
    }
}

# Configurar identidad local
git config user.name "$userName"
git config user.email "$userEmail"

# 3. PROCESO DE SUBIDA
if (-not (Test-Path ".git")) {
    Write-Host "‚ùå Error: No es un repositorio git." -ForegroundColor Red
    exit
}

Write-Host "`nüìã Estado actual:" -ForegroundColor Yellow
git status -s

Write-Host "`n‚ûï A√±adiendo archivos..." -ForegroundColor Yellow
git add .

$mensaje = Read-Host "‚úèÔ∏è  Mensaje del commit"
if ([string]::IsNullOrWhiteSpace($mensaje)) {
    $mensaje = "Actualizaci√≥n autom√°tica por $userName"
}

Write-Host "üì¶ Creando commit..." -ForegroundColor Yellow
git commit -m "$mensaje"

Write-Host "‚¨ÜÔ∏è  Subiendo a GitHub..." -ForegroundColor Yellow
git push

Write-Host "======================================" -ForegroundColor Green
Write-Host " ‚úÖ PROYECTO SUBIDO POR $userName" -ForegroundColor Green
Write-Host "======================================" -ForegroundColor Green
------------------------------------------------------------------------------

[ARCHIVO]: ./restart.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  REINICIANDO COSMOS FITNESS"
echo "=============================="

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "‚û° Usando: $COMPOSE"

echo "üõë Parando contenedores..."
$COMPOSE down

echo "üöÄ Levantando servicios SIN rebuild..."
$COMPOSE up -d

echo ""
echo "üí° Si cambiaste Dockerfile o package.json usa:"
echo "   docker compose up -d --build"

echo "=============================="
echo " COSMOS FITNESS REINICIADO"
echo "=============================="


------------------------------------------------------------------------------

[ARCHIVO]: ./codigo_proyecto.txt
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./.env.example
------------------------------------------------------------------------------
# POSTGRES
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin
POSTGRES_DB=cosmos_db
POSTGRES_PORT=5432

# API
API_PORT=3000

# IONIC
IONIC_PORT=8100

------------------------------------------------------------------------------

[ARCHIVO]: ./build.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  BUILD COMPLETO COSMOS"
echo "=============================="

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

$COMPOSE down
$COMPOSE up -d --build

echo "‚úÖ Build terminado"


------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/.dockerignore
------------------------------------------------------------------------------
node_modules
www
dist
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/main.ts
------------------------------------------------------------------------------
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';

import { AppModule } from './app/app.module';

platformBrowserDynamic().bootstrapModule(AppModule)
  .catch(err => console.log(err));

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/index.html
------------------------------------------------------------------------------
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Ionic App</title>

  <base href="/" />

  <meta name="color-scheme" content="light dark" />
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />

  <link rel="icon" type="image/png" href="assets/icon/favicon.png" />

  <!-- add to homescreen for ios -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
</head>

<body>
  <app-root></app-root>
</body>

</html>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/zone-flags.ts
------------------------------------------------------------------------------
/**
 * Prevents Angular change detection from
 * running with certain Web Component callbacks
 */
// eslint-disable-next-line no-underscore-dangle
(window as any).__Zone_disable_customElements = true;

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/theme/variables.scss
------------------------------------------------------------------------------
// For information on how to create your own theme, please refer to:
// https://ionicframework.com/docs/theming/

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/polyfills.ts
------------------------------------------------------------------------------
/**
 * This file includes polyfills needed by Angular and is loaded before the app.
 * You can add your own extra polyfills to this file.
 *
 * This file is divided into 2 sections:
 *   1. Browser polyfills. These are applied before loading ZoneJS and are sorted by browsers.
 *   2. Application imports. Files imported after ZoneJS that should be loaded before your main
 *      file.
 *
 * The current setup is for so-called "evergreen" browsers; the last versions of browsers that
 * automatically update themselves. This includes recent versions of Safari, Chrome (including
 * Opera), Edge on the desktop, and iOS and Chrome on mobile.
 *
 * Learn more in https://angular.io/guide/browser-support
 */

/***************************************************************************************************
 * BROWSER POLYFILLS
 */

/**
 * By default, zone.js will patch all possible macroTask and DomEvents
 * user can disable parts of macroTask/DomEvents patch by setting following flags
 * because those flags need to be set before `zone.js` being loaded, and webpack
 * will put import in the top of bundle, so user need to create a separate file
 * in this directory (for example: zone-flags.ts), and put the following flags
 * into that file, and then add the following code before importing zone.js.
 * import './zone-flags';
 *
 * The flags allowed in zone-flags.ts are listed here.
 *
 * The following flags will work for all browsers.
 *
 * (window as any).__Zone_disable_requestAnimationFrame = true; // disable patch requestAnimationFrame
 * (window as any).__Zone_disable_on_property = true; // disable patch onProperty such as onclick
 * (window as any).__zone_symbol__UNPATCHED_EVENTS = ['scroll', 'mousemove']; // disable patch specified eventNames
 *
 *  in IE/Edge developer tools, the addEventListener will also be wrapped by zone.js
 *  with the following flag, it will bypass `zone.js` patch for IE/Edge
 *
 *  (window as any).__Zone_enable_cross_context_check = true;
 *
 */
 
import './zone-flags';

/***************************************************************************************************
 * Zone JS is required by default for Angular itself.
 */
import 'zone.js';  // Included with Angular CLI.


/***************************************************************************************************
 * APPLICATION IMPORTS
 */

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/global.scss
------------------------------------------------------------------------------
/*
 * App Global CSS
 * ----------------------------------------------------------------------------
 * Put style rules here that you want to apply globally. These styles are for
 * the entire app and not just one component. Additionally, this file can be
 * used as an entry point to import other CSS/Sass files to be included in the
 * output CSS.
 * For more information on global stylesheets, visit the documentation:
 * https://ionicframework.com/docs/layout/global-stylesheets
 */

/* Core CSS required for Ionic components to work properly */
@import "@ionic/angular/css/core.css";

/* Basic CSS for apps built with Ionic */
@import "@ionic/angular/css/normalize.css";
@import "@ionic/angular/css/structure.css";
@import "@ionic/angular/css/typography.css";
@import "@ionic/angular/css/display.css";

/* Optional CSS utils that can be commented out */
@import "@ionic/angular/css/padding.css";
@import "@ionic/angular/css/float-elements.css";
@import "@ionic/angular/css/text-alignment.css";
@import "@ionic/angular/css/text-transformation.css";
@import "@ionic/angular/css/flex-utils.css";

/**
 * Ionic Dark Mode
 * -----------------------------------------------------
 * For more info, please see:
 * https://ionicframework.com/docs/theming/dark-mode
 */

/* @import "@ionic/angular/css/palettes/dark.always.css"; */
/* @import "@ionic/angular/css/palettes/dark.class.css"; */
@import "@ionic/angular/css/palettes/dark.system.css";

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/environments/environment.prod.ts
------------------------------------------------------------------------------
export const environment = {
  production: true,
  apiUrl: 'http://api-node:3000'
};
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/environments/environment.ts
------------------------------------------------------------------------------
// This file can be replaced during build by using the `fileReplacements` array.
// `ng build` replaces `environment.ts` with `environment.prod.ts`.
// The list of file replacements can be found in `angular.json`.

export const environment = {
  production: false,
  apiUrl: 'http://localhost:3000'
};


/*
 * For easier debugging in development mode, you can import the following file
 * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.
 *
 * This import should be commented out in production mode because it will have a negative impact
 * on performance if an error is thrown.
 */
// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/api.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class Api {
  
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/usuario.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({
  providedIn: 'root'
})

export class UsuarioService {

  private api = 'http://localhost:3000/usuarios';

  constructor(private http: HttpClient) {}

  getUsuariosAdmin() {
    return this.http.get<any[]>(`${this.api}/admin`);
  }

  toggleActivo(id:number) {
    return this.http.patch(`${this.api}/${id}/toggle-activo`, {});
  }

  crearUsuario(usuario:any){
  return this.http.post(
    'http://localhost:3000/usuarios/admin',
    usuario
  );
}


  crearUsuarioAdmin(data: any) {
  return this.http.post(
    'http://localhost:3000/usuarios/admin',
    data
  );


}


}
export class ReservaService {

  private baseUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  getReservasCliente(idCliente: number) {
    return this.http.get<any[]>(
      `${this.baseUrl}/reservas/cliente/${idCliente}`
    );
  }
}




------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/horario.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class HorarioService {

  private apiUrl = 'http://localhost:3000/horarios';

  constructor(private http: HttpClient) {}

  getHorarios(idCliente: number): Observable<any[]> {
    return this.http.get<any[]>(`${this.apiUrl}?id_cliente=${idCliente}`);
  }

/** 
  getHorariosProfesor(idProfesor: number): Observable<any[]> {
  return this.http.get<any[]>(
    `http://localhost:3000/horarios/profesor/${idProfesor}`
  );
}
*/
cerrarReservas(idHorario: number) {
  return this.http.patch(
    `http://localhost:3000/horarios/${idHorario}/cerrar`,
    {}
  );
}

abrirReservas(idHorario: number) {
  return this.http.patch(
    `http://localhost:3000/horarios/${idHorario}/abrir`,
    {}
  );
}
getHorariosProfesor(idProfesor: number) {
  return this.http.get<any[]>(
    `http://localhost:3000/horarios/profesor/${idProfesor}`
  );
}

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/api.spec.ts
------------------------------------------------------------------------------
import { TestBed } from '@angular/core/testing';

import { Api } from './api';

describe('Api', () => {
  let service: Api;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(Api);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/auth.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({ providedIn: 'root' })
export class AuthService {

  private baseUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  login(email: string, password: string) {
    return this.http.post<any>(`${this.baseUrl}/login`, { email, password });
  }

  saveUser(user: any) {
    localStorage.setItem('user', JSON.stringify(user));
  }

  getUser() {
    return JSON.parse(localStorage.getItem('user') || 'null');
  }

  isLogged(): boolean {
  return !!this.getUser();
  }

  getRole(): string | null {
    const user = this.getUser();
    return user ? user.rol : null;
  }


  logout() {
    localStorage.removeItem('user');
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/reserva.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({
  providedIn: 'root'
})
export class ReservaService {
  private apiUrl = 'http://localhost:3000/reservas';

  private baseUrl = `${environment.apiUrl}/reservas`;

  constructor(private http: HttpClient) {}

  getReservasCliente(idCliente: number) {
    return this.http.get<any[]>(`${this.baseUrl}/cliente/${idCliente}`);
  }

  cancelarReserva(idReserva: number) {
    console.log('URL cancelaci√≥n:', `${this.baseUrl}/${idReserva}/cancelar`);

    return this.http.patch(
      `${this.baseUrl}/${idReserva}/cancelar`,
      {}
    );
  }

  crearReserva(data: { id_cliente: number; id_horario: number }) {
  return this.http.post(this.baseUrl, data);
}

forzarCancelacion(idReserva: number) {
  return this.http.patch(
    `${this.apiUrl}/${idReserva}/forzar-cancelacion`,
    {}
  );
}
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/pago.service.ts
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/clase.service.ts
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { PreloadAllModules, RouterModule, Routes } from '@angular/router';
import { AuthGuard } from './guards/auth-guard';



const routes: Routes = [
  {
    path: 'login',
    loadChildren: () => import('./pages/login/login.module').then(m => m.LoginPageModule)
  },

  {
    path: 'cliente',
    loadChildren: () => import('./pages/cliente/cliente.module').then(m => m.ClientePageModule),
    canActivate: [AuthGuard],
    data: { roles: ['cliente'] }
  },

  {
    path: 'profesor',
    loadChildren: () => import('./pages/profesor/profesor.module').then(m => m.ProfesorPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['profesor'] }
  },

  {
    path: 'admin',
    loadChildren: () => import('./pages/admin/admin.module').then(m => m.AdminPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['admin'] }
  },

  {
    path: 'horarios',
    loadChildren: () => import('./pages/horarios/horarios.module').then(m => m.HorariosPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['cliente', 'profesor', 'admin'] } // accesible para todos
  },

  {
    path: '',
    redirectTo: 'login',
    pathMatch: 'full'
  },
  {
    path: 'alumnos-modal',
    loadChildren: () => import('./pages/alumnos-modal/alumnos-modal.module').then( m => m.AlumnosModalPageModule)
  },
  {
    path: 'admin-crear-usuario',
    loadChildren: () => import('./pages/admin-crear-usuario/admin-crear-usuario.module')
    .then( m => m.AdminCrearUsuarioPageModule)
  }
];

@NgModule({
  imports: [
    RouterModule.forRoot(routes, { preloadingStrategy: PreloadAllModules })
  ],
  exports: [RouterModule]
})
export class AppRoutingModule { }

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.spec.ts
------------------------------------------------------------------------------
import { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { TestBed } from '@angular/core/testing';

import { AppComponent } from './app.component';

describe('AppComponent', () => {

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [AppComponent],
      schemas: [CUSTOM_ELEMENTS_SCHEMA],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { HomePage } from './home.page';

describe('HomePage', () => {
  let component: HomePage;
  let fixture: ComponentFixture<HomePage>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [HomePage],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(HomePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { HomePage } from './home.page';

const routes: Routes = [
  {
    path: '',
    component: HomePage,
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class HomePageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';
import { FormsModule } from '@angular/forms';
import { HomePage } from './home.page';

import { HomePageRoutingModule } from './home-routing.module';


@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    HomePageRoutingModule
  ],
  declarations: [HomePage]
})
export class HomePageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';

@Component({
  selector: 'app-home',
  templateUrl: 'home.page.html',
  styleUrls: ['home.page.scss'],
  standalone: false,
})
export class HomePage {

  constructor() {}

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.scss
------------------------------------------------------------------------------
#container {
  text-align: center;

  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
}

#container strong {
  font-size: 20px;
  line-height: 26px;
}

#container p {
  font-size: 16px;
  line-height: 22px;

  color: #8c8c8c;

  margin: 0;
}

#container a {
  text-decoration: none;
}
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.html
------------------------------------------------------------------------------
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Blank
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Blank</ion-title>
    </ion-toolbar>
  </ion-header>

  <div id="container">
    <strong>Ready to create an app?</strong>
    <p>Start with Ionic <a target="_blank" rel="noopener noreferrer" href="https://ionicframework.com/docs/components">UI Components</a></p>
  </div>
</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AuthService } from './services/auth.service';
import { Router } from '@angular/router';

interface MenuItem {
  title: string;
  url: string;
  icon: string;
}

@Component({
  selector: 'app-root',
  standalone: false,
  templateUrl: 'app.component.html',
})
export class AppComponent implements OnInit {

  menuItems: MenuItem[] = [];

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  ngOnInit() {
    this.loadMenu();
  }

  loadMenu() {
    const user = this.auth.getUser();
    if (!user) return;

    if (user.rol === 'cliente') {
      this.menuItems = [
        { title: 'Inicio', url: '/cliente', icon: 'home-outline' },
        { title: 'Horarios', url: '/horarios', icon: 'calendar-outline' },
        { title: 'Mis reservas', url: '/cliente', icon: 'bookmark-outline' },
      ];
    }

    if (user.rol === 'profesor') {
      this.menuItems = [
        { title: 'Mis clases', url: '/profesor', icon: 'fitness-outline' },
        { title: 'Horarios', url: '/horarios', icon: 'calendar-outline' },
      ];
    }

    if (user.rol === 'admin') {
      this.menuItems = [
        { title: 'Usuarios', url: '/admin', icon: 'people-outline' },
        { title: 'Clases', url: '/admin', icon: 'barbell-outline' },
        { title: 'Pagos', url: '/admin', icon: 'card-outline' },
      ];
    }
  }

  logout() {
    this.auth.logout();
    this.router.navigate(['/login']);
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.html
------------------------------------------------------------------------------
<ion-app>

  <ion-menu contentId="main-content">
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Cosmos Fitness</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <ion-list>

        <ion-item *ngFor="let item of menuItems" [routerLink]="item.url">
          <ion-icon [name]="item.icon" slot="start"></ion-icon>
          <ion-label>{{ item.title }}</ion-label>
        </ion-item>

        <ion-item button color="danger" (click)="logout()">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          <ion-label>Cerrar sesi√≥n</ion-label>
        </ion-item>

      </ion-list>
    </ion-content>
  </ion-menu>

  <!-- AQU√ç EL CAMBIO -->
  <ion-router-outlet id="main-content"></ion-router-outlet>

</ion-app>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { RouteReuseStrategy } from '@angular/router';
import { IonicModule, IonicRouteStrategy } from '@ionic/angular';
import { AppComponent } from './app.component';
import { AppRoutingModule } from './app-routing.module';
import { FormsModule } from '@angular/forms';
import { HttpClientModule } from '@angular/common/http';



@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, 
    IonicModule.forRoot(),
     AppRoutingModule,
     FormsModule,
     HttpClientModule],
  providers: [{ provide: RouteReuseStrategy, useClass: IonicRouteStrategy }],
  bootstrap: [AppComponent],
  
})



export class AppModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar>
    <ion-title>Cosmos Fitness</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div style="max-width: 400px; margin: auto; margin-top: 15vh;">

    <ion-card>
      <ion-card-header>
        <ion-card-title>Iniciar sesi√≥n</ion-card-title>
      </ion-card-header>

      <ion-card-content>

        <ion-item>
          <ion-label position="floating">Email</ion-label>
          <ion-input
            type="email"
            [(ngModel)]="email"
            required>
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Contrase√±a</ion-label>
          <ion-input
            type="password"
            [(ngModel)]="password"
            required>
          </ion-input>
        </ion-item>

        <!-- Mensaje de error -->
        <ion-text color="danger" *ngIf="errorMsg">
          <p style="margin-top: 10px;">{{ errorMsg }}</p>
        </ion-text>

        <!-- Bot√≥n login -->
        <ion-button
          expand="block"
          color="primary"
          style="margin-top: 20px;"
          (click)="login()"
          [disabled]="loading">

          <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
          <span *ngIf="!loading">Entrar</span>

        </ion-button>

      </ion-card-content>
    </ion-card>

  </div>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from '../../services/auth.service';

@Component({
  selector: 'app-login',
  standalone: false,
  templateUrl: './login.page.html',
})
export class LoginPage {

  email = '';
  password = '';

  loading = false;
  errorMsg = '';

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  login() {
    this.loading = true;
    this.errorMsg = '';

    this.auth.login(this.email, this.password).subscribe({
      next: user => {
        this.loading = false;
        this.auth.saveUser(user);

        switch (user.rol) {
          case 'cliente':
            this.router.navigate(['/cliente']);
            break;
          case 'profesor':
            this.router.navigate(['/profesor']);
            break;
          case 'admin':
            this.router.navigate(['/admin']);
            break;
          default:
            this.router.navigate(['/home']);
        }
      },
      error: err => {
        this.loading = false;

        if (err.status === 401) {
          this.errorMsg = 'Credenciales incorrectas';
        } else {
          this.errorMsg = 'Error de conexi√≥n con el servidor';
        }
      }
    });
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { LoginPage } from './login.page';

describe('LoginPage', () => {
  let component: LoginPage;
  let fixture: ComponentFixture<LoginPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(LoginPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { LoginPageRoutingModule } from './login-routing.module';

import { LoginPage } from './login.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    LoginPageRoutingModule
  ],
  declarations: [LoginPage]
})
export class LoginPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { LoginPage } from './login.page';

const routes: Routes = [
  {
    path: '',
    component: LoginPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class LoginPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { HorariosPage } from './horarios.page';

describe('HorariosPage', () => {
  let component: HorariosPage;
  let fixture: ComponentFixture<HorariosPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(HorariosPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Horarios disponibles</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="horarios.length > 0; else sinHorarios">

    <ion-item *ngFor="let h of horarios">
      <ion-label>
        <h2>{{ h.Clase?.nombre_clase }}</h2>
        <p>{{ h.fecha }} ¬∑ {{ h.hora_inicio }} - {{ h.hora_fin }}</p>
        <p>{{ h.lugar }}</p>
        <p>
          Profesor:
          {{ h.Clase?.profesor?.nombre }}
          {{ h.Clase?.profesor?.apellidos }}
        </p>
        <p>
            Plazas:
            {{ h.plazas_ocupadas }} / {{ h.plazas_totales }}
        </p>
      </ion-label>
<ion-button
  slot="end"
  color="success"
  fill="outline"
  [disabled]="!h.plazas_disponibles || h.ya_reservado"
  (click)="reservar(h)">

  <ng-container *ngIf="h.ya_reservado">
    Ya reservado
  </ng-container>

  <ng-container *ngIf="!h.ya_reservado && !h.plazas_disponibles">
    Completo
  </ng-container>

  <ng-container *ngIf="!h.ya_reservado && h.plazas_disponibles">
    Reservar
  </ng-container>

</ion-button>

    </ion-item>

  </ion-list>

  <ng-template #sinHorarios>
    <ion-text color="medium">
      <p>No hay horarios disponibles.</p>
    </ion-text>
  </ng-template>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { HorariosPage } from './horarios.page';

const routes: Routes = [
  {
    path: '',
    component: HorariosPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class HorariosPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { HorarioService } from '../../services/horario.service';
import { ReservaService } from '../../services/reserva.service';
import { AuthService } from '../../services/auth.service';
import { AlertController } from '@ionic/angular';

@Component({
  selector: 'app-horarios',
  templateUrl: './horarios.page.html',
  styleUrls: ['./horarios.page.scss'],
  standalone: false,
})
export class HorariosPage implements OnInit {

  horarios: any[] = [];
  user: any;

  constructor(
    private horarioService: HorarioService,
    private reservaService: ReservaService,
    private auth: AuthService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
  }

  cargarHorarios() {
    this.horarioService.getHorarios(this.user.id_usuario).subscribe({
      next: data => this.horarios = data,
      error: err => console.error(err)
    });
  }

  reservar(horario: any) {
    this.reservaService.crearReserva({
      id_cliente: this.user.id_usuario,
      id_horario: horario.id_horario
    }).subscribe({
      next: () => this.cargarHorarios(),
      error: err => this.mostrarError(err.error?.error || 'Error al reservar')
    });
  }

  async mostrarError(msg: string) {
    const alert = await this.alertCtrl.create({
      header: 'Reserva',
      message: msg,
      buttons: ['OK']
    });
    await alert.present();
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { HorariosPageRoutingModule } from './horarios-routing.module';

import { HorariosPage } from './horarios.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    HorariosPageRoutingModule
  ],
  declarations: [HorariosPage]
})
export class HorariosPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';

import { ClientePageRoutingModule } from './cliente-routing.module';
import { ClientePage } from './cliente.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ClientePageRoutingModule
  ],
  declarations: [ClientePage]
})
export class ClientePageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mis reservas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="reservas.length > 0; else sinReservas">

  <ion-item *ngFor="let r of reservas">
    <ion-label>
      <h2>{{ r.Horario?.Clase?.nombre_clase }}</h2>

      <p>
        {{ r.Horario?.fecha }}
        ¬∑ {{ r.Horario?.hora_inicio }} - {{ r.Horario?.hora_fin }}
      </p>

      <p>
        Profesor:
        {{ r.Horario?.Clase?.profesor?.nombre }}
        {{ r.Horario?.Clase?.profesor?.apellidos }}
      </p>

      <ion-badge
        [color]="r.estado === 'activa' ? 'success' : 'medium'">
        {{ r.estado | uppercase }}
      </ion-badge>
    </ion-label>

    <ion-button
      *ngIf="r.estado === 'activa'"
      color="danger"
      fill="outline"
      slot="end"
      (click)="cancelar(r)">
      Cancelar
    </ion-button>

  </ion-item>

</ion-list>

<ng-template #sinReservas>
  <ion-text color="medium">
    <p>No tienes reservas.</p>
  </ion-text>
</ng-template>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AlertController } from '@ionic/angular';
import { ReservaService } from '../../services/reserva.service';
import { HorarioService } from '../../services/horario.service';
import { AuthService } from '../../services/auth.service';

@Component({
  selector: 'app-cliente',
  standalone: false,
  templateUrl: './cliente.page.html',
  styleUrls: ['./cliente.page.scss']
})
export class ClientePage implements OnInit {

  user: any;

  // üîπ NUEVO
  horarios: any[] = [];

  // üîπ EXISTENTE
  reservas: any[] = [];

  constructor(
    private reservaService: ReservaService,
    private horarioService: HorarioService,
    private auth: AuthService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
    this.cargarReservas();
  }

  // =====================
  // HORARIOS
  // =====================
  cargarHorarios() {
    this.horarioService.getHorarios(this.user.id_usuario).subscribe({
      next: data => this.horarios = data,
      error: err => console.error(err)
    });
  }

  get tieneReservasActivas(): boolean {
  return this.reservas.some(r => r.estado === 'activa');
}

  reservar(idHorario: number) {
    this.reservaService.crearReserva({
      id_cliente: this.user.id_usuario,
      id_horario: idHorario
    }).subscribe({
      next: () => {
        this.cargarReservas();
        alert('Reserva realizada ‚úÖ');
      },
      error: err => {
        alert(err.error?.error || 'No se pudo reservar');
      }
    });
  }

 
  cargarReservas() {
    this.reservaService.getReservasCliente(this.user.id_usuario)
      .subscribe({
        next: data => this.reservas = data,
        error: err => console.error(err)
      });
  }

  async cancelar(reserva: any) {
    const alert = await this.alertCtrl.create({
      header: 'Cancelar reserva',
      message: '¬øSeguro que deseas cancelar esta reserva?',
      buttons: [
        { text: 'No', role: 'cancel' },
        {
          text: 'S√≠, cancelar',
          handler: () => {
            this.reservaService
              .cancelarReserva(reserva.id_reserva)
              .subscribe(() => this.cargarReservas());
          }
        }
      ]
    });

    await alert.present();
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ClientePage } from './cliente.page';

describe('ClientePage', () => {
  let component: ClientePage;
  let fixture: ComponentFixture<ClientePage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(ClientePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ClientePage } from './cliente.page';

const routes: Routes = [
  {
    path: '',
    component: ClientePage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ClientePageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AdminPage } from './admin.page';

describe('AdminPage', () => {
  let component: AdminPage;
  let fixture: ComponentFixture<AdminPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AdminPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';

import { UsuarioService } from '../../services/usuario.service';
import { AlertController } from '@ionic/angular';

@Component({
  selector: 'app-admin',
  templateUrl: './admin.page.html',
  standalone: false,
  styleUrls: ['./admin.page.scss'],
})
export class AdminPage implements OnInit {

  usuarios:any[] = [];

  constructor(
    private usuarioService: UsuarioService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.cargarUsuarios();
  }

  cargarUsuarios() {
    this.usuarioService.getUsuariosAdmin()
      .subscribe((data:any[]) => this.usuarios = data);
  }

  toggle(usuario:any) {
    this.usuarioService.toggleActivo(usuario.id_usuario)
      .subscribe(() => this.cargarUsuarios());
  }

  async crearUsuario() {

  const alert = await this.alertCtrl.create({
    header: 'Nuevo usuario',
    inputs: [
      { name: 'nombre', placeholder: 'Nombre', type: 'text' },
      { name: 'apellidos', placeholder: 'Apellidos', type: 'text' },
      { name: 'email', placeholder: 'Email', type: 'email' },
      { name: 'password', placeholder: 'Contrase√±a', type: 'password' },
      { name: 'telefono', placeholder: 'Tel√©fono', type: 'text' },
      {
        name: 'rol',
        type: 'radio',
        label: 'Cliente',
        value: 'cliente',
        checked: true
      },
      {
        name: 'rol',
        type: 'radio',
        label: 'Profesor',
        value: 'profesor'
      }
    ],
    buttons: [
      { text: 'Cancelar', role: 'cancel' },
      {
        text: 'Crear',
        handler: (data) => {

          const payload = {
            nombre: data.nombre,
            apellidos: data.apellidos,
            email: data.email,
            password_hash: data.password,
            telefono: data.telefono,
            rol: data.rol
          };

          this.usuarioService.crearUsuarioAdmin(payload)
            .subscribe(() => this.cargarUsuarios());
        }
      }
    ]
  });

  await alert.present();
}

}
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AdminPage } from './admin.page';

const routes: Routes = [
  {
    path: '',
    component: AdminPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AdminPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="dark">
    <ion-title>Panel Admin</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-button expand="block" routerLink="/admin-crear-usuario">
  Crear usuario
  </ion-button >


  <ion-list>


    <ion-item *ngFor="let u of usuarios">

      <ion-label>
        <h2>{{u.nombre}} {{u.apellidos}}</h2>
        <p>{{u.email}}</p>
        <p>Rol: {{u.rol}}</p>
      </ion-label>

      <ion-chip [color]="u.activo ? 'success' : 'danger'">
  <ion-label>
    {{ u.activo ? 'Activo' : 'Desactivado' }}
  </ion-label>
</ion-chip>


      <ion-button
      [disabled]="u.rol === 'admin'"

        slot="end"
        fill="outline"
        (click)="toggle(u)">
        Toggle
      </ion-button>

    </ion-item>

  </ion-list>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AdminPageRoutingModule } from './admin-routing.module';

import { AdminPage } from './admin.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AdminPageRoutingModule
  ],
  declarations: [AdminPage]
})
export class AdminPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mis clases</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-card *ngFor="let h of horarios" class="ion-margin-bottom">

    <ion-card-header>
      <ion-card-title>
        {{ h.Clase.nombre_clase }}
      </ion-card-title>

      <ion-card-subtitle>
        {{ h.fecha }} ¬∑ {{ h.hora_inicio }} - {{ h.hora_fin }}
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>

      <p><strong>Lugar:</strong> {{ h.lugar }}</p>

      <p>
        <strong>Plazas:</strong>
        {{ h.plazas_ocupadas }} / {{ h.plazas_totales }}
      </p>

      <!-- Estado -->
      <ion-chip
        [color]="h.reservas_abiertas ? 'success' : 'danger'">
        <ion-label>
          {{ h.reservas_abiertas ? 'Reservas abiertas' : 'Reservas cerradas' }}
        </ion-label>
      </ion-chip>

      <ion-grid class="ion-margin-top">
        <ion-row>

          <!-- VER ALUMNOS -->
          <ion-col size="6">
            <ion-button
              expand="block"
              fill="outline"
              (click)="verAlumnos(h)">
              Ver alumnos
            </ion-button>
          </ion-col>

          <!-- ABRIR / CERRAR -->
          <ion-col size="6">
            <ion-button
              expand="block"
              [color]="h.reservas_abiertas ? 'warning' : 'success'"
              (click)="cambiarEstado(h)">

              {{ h.reservas_abiertas ? 'Cerrar reservas' : 'Abrir reservas' }}

            </ion-button>
          </ion-col>

        </ion-row>
      </ion-grid>

      <!-- LISTA DE ALUMNOS INLINE -->
      <ion-list *ngIf="h.Reservas?.length">

        <ion-item *ngFor="let r of h.Reservas">

          <ion-label>
            {{ r.Usuario.nombre }}
            {{ r.Usuario.apellidos }}
          </ion-label>

          <ion-button
            color="danger"
            fill="clear"
            (click)="cancelarAlumno(r)">
            Cancelar
          </ion-button>

        </ion-item>

      </ion-list>

    </ion-card-content>
  </ion-card>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AlertController } from '@ionic/angular';
import { HorarioService } from '../../services/horario.service';
import { AuthService } from '../../services/auth.service';
import { ReservaService } from '../../services/reserva.service';
import { ModalController } from '@ionic/angular';
import { AlumnosModalPage } from '../alumnos-modal/alumnos-modal.page';




@Component({
  selector: 'app-profesor',
  templateUrl: './profesor.page.html',
  styleUrls: ['./profesor.page.scss'],
  standalone: false
})
export class ProfesorPage implements OnInit {

  horarios: any[] = [];
  user: any;

  constructor(
    private horarioService: HorarioService,
    private auth: AuthService,
    private reservaService: ReservaService,
    private alertCtrl: AlertController,
    private modalCtrl: ModalController

  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
  }

  cargarHorarios() {
    this.horarioService.getHorariosProfesor(this.user.id_usuario)
      .subscribe({
        next: data => this.horarios = data,
        error: err => console.error(err)
      });
  }

  async cancelarAlumno(reserva: any) {

  const alert = await this.alertCtrl.create({
    header: 'Cancelar reserva',
    message: `¬øCancelar la reserva de ${reserva.Usuario.nombre} ${reserva.Usuario.apellidos}?`,
    buttons: [
      { text: 'No', role: 'cancel' },
      {
        text: 'S√≠',
        handler: () => {
          this.reservaService.forzarCancelacion(reserva.id_reserva)
            .subscribe(() => this.cargarHorarios());
        }
      }
    ]
  });

  await alert.present();
}
async verAlumnos(horario: any) {

  const modal = await this.modalCtrl.create({
    component: AlumnosModalPage,
    componentProps: {
      reservas: horario.Reservas
    }
  });

  await modal.present();

}



  async cambiarEstado(horario: any) {

    const accion = horario.reservas_abiertas ? 'cerrar' : 'abrir';

    const alert = await this.alertCtrl.create({
      header: 'Confirmar',
      message: `¬øDeseas ${accion} las reservas de este horario?`,
      buttons: [
        { text: 'Cancelar', role: 'cancel' },
        {
          text: 'S√≠',
          handler: () => {
            const obs = horario.reservas_abiertas
              ? this.horarioService.cerrarReservas(horario.id_horario)
              : this.horarioService.abrirReservas(horario.id_horario);

            obs.subscribe(() => this.cargarHorarios());
          }
        }
      ]
    });

    await alert.present();
  }
}




------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ProfesorPage } from './profesor.page';

describe('ProfesorPage', () => {
  let component: ProfesorPage;
  let fixture: ComponentFixture<ProfesorPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(ProfesorPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ProfesorPage } from './profesor.page';

const routes: Routes = [
  {
    path: '',
    component: ProfesorPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ProfesorPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { ProfesorPageRoutingModule } from './profesor-routing.module';

import { ProfesorPage } from './profesor.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ProfesorPageRoutingModule
  ],
  declarations: [ProfesorPage]
})
export class ProfesorPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AlumnosModalPageRoutingModule } from './alumnos-modal-routing.module';

import { AlumnosModalPage } from './alumnos-modal.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AlumnosModalPageRoutingModule
  ],
  declarations: [AlumnosModalPage]
})
export class AlumnosModalPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AlumnosModalPage } from './alumnos-modal.page';

const routes: Routes = [
  {
    path: '',
    component: AlumnosModalPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AlumnosModalPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Alumnos inscritos</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="cerrar()">Cerrar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="reservas.length; else vacio">

    <ion-item *ngFor="let r of reservas">

      <ion-label>
        <h2>
          {{ r.Usuario.nombre }}
          {{ r.Usuario.apellidos }}
        </h2>
      </ion-label>

      <ion-button
        color="danger"
        fill="outline"
        (click)="cancelar(r)">
        Cancelar
      </ion-button>

    </ion-item>

  </ion-list>

  <ng-template #vacio>
    <ion-text color="medium">
      No hay alumnos inscritos.
    </ion-text>
  </ng-template>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AlumnosModalPage } from './alumnos-modal.page';

describe('AlumnosModalPage', () => {
  let component: AlumnosModalPage;
  let fixture: ComponentFixture<AlumnosModalPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AlumnosModalPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.ts
------------------------------------------------------------------------------
import { Component, Input } from '@angular/core';
import { ModalController } from '@ionic/angular';
import { ReservaService } from '../../services/reserva.service';

@Component({
  selector: 'app-alumnos-modal',
  templateUrl: './alumnos-modal.page.html',
  styleUrls: ['./alumnos-modal.page.scss'],
  standalone:false
})
export class AlumnosModalPage {

  @Input() reservas: any[] = [];

  constructor(
    private modalCtrl: ModalController,
    private reservaService: ReservaService
  ) {}

  cerrar() {
    this.modalCtrl.dismiss();
  }

  cancelar(reserva: any) {
    this.reservaService
      .forzarCancelacion(reserva.id_reserva)
      .subscribe(() => {

        // eliminar de la lista visualmente
        this.reservas = this.reservas.filter(
          r => r.id_reserva !== reserva.id_reserva
        );

      });
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AdminCrearUsuarioPageRoutingModule } from './admin-crear-usuario-routing.module';

import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AdminCrearUsuarioPageRoutingModule
  ],
  declarations: [AdminCrearUsuarioPage]
})
export class AdminCrearUsuarioPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

describe('AdminCrearUsuarioPage', () => {
  let component: AdminCrearUsuarioPage;
  let fixture: ComponentFixture<AdminCrearUsuarioPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AdminCrearUsuarioPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';
import { UsuarioService } from '../../services/usuario.service';
import { AlertController } from '@ionic/angular';
import { Router } from '@angular/router';

@Component({
  selector: 'app-admin-crear-usuario',
  templateUrl: './admin-crear-usuario.page.html',
  styleUrls: ['./admin-crear-usuario.page.scss'],
  standalone:false
})
export class AdminCrearUsuarioPage {

  usuario: any = {
    rol: 'cliente'
  };

  constructor(
    private usuarioService: UsuarioService,
    private alertCtrl: AlertController,
    private router: Router
  ) {}

  async crearUsuario() {

    if (!this.usuario.nombre || !this.usuario.email || !this.usuario.password_hash) {
      return this.mostrarAlert('Faltan campos obligatorios');
    }

    this.usuarioService.crearUsuario(this.usuario)
      .subscribe({
        next: async () => {

          const alert = await this.alertCtrl.create({
            header: '√âxito',
            message: 'Usuario creado correctamente',
            buttons: ['OK']
          });

          await alert.present();

          this.router.navigate(['/admin']);
        },
        error: err => {
          this.mostrarAlert(err.error?.error || 'Error creando usuario');
        }
      });
  }

  async mostrarAlert(msg:string){
    const alert = await this.alertCtrl.create({
      header:'Error',
      message:msg,
      buttons:['OK']
    });

    await alert.present();
  }

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Crear usuario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-item>
    <ion-input label="Nombre" [(ngModel)]="usuario.nombre"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Apellidos" [(ngModel)]="usuario.apellidos"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Email" [(ngModel)]="usuario.email"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input 
      label="Contrase√±a"
      type="password"
      [(ngModel)]="usuario.password_hash">
    </ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Tel√©fono" [(ngModel)]="usuario.telefono"></ion-input>
  </ion-item>

  <ion-item>
    <ion-select label="Rol" [(ngModel)]="usuario.rol">
      <ion-select-option value="cliente">Cliente</ion-select-option>
      <ion-select-option value="profesor">Profesor</ion-select-option>
      <ion-select-option value="admin">Admin</ion-select-option>
    </ion-select>
  </ion-item>

  <ion-button expand="block" (click)="crearUsuario()">
    Crear usuario
  </ion-button>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

const routes: Routes = [
  {
    path: '',
    component: AdminCrearUsuarioPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AdminCrearUsuarioPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/guards/auth-guard.spec.ts
------------------------------------------------------------------------------
import { TestBed } from '@angular/core/testing';
import { CanActivateFn } from '@angular/router';

import { authGuard } from './auth-guard';

describe('authGuard', () => {
  const executeGuard: CanActivateFn = (...guardParameters) => 
      TestBed.runInInjectionContext(() => authGuard(...guardParameters));

  beforeEach(() => {
    TestBed.configureTestingModule({});
  });

  it('should be created', () => {
    expect(executeGuard).toBeTruthy();
  });
});
d
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/guards/auth-guard.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { CanActivate, ActivatedRouteSnapshot, Router } from '@angular/router';
import { AuthService } from '../services/auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  canActivate(route: ActivatedRouteSnapshot): boolean {

    const user = this.auth.getUser();

    if (!user) {
      this.router.navigate(['/login']);
      return false;
    }

    const allowedRoles = route.data['roles'] as string[];

    if (allowedRoles && !allowedRoles.includes(user.rol)) {
      // Redirigir a su panel correcto
      this.router.navigate(['/' + user.rol]);
      return false;
    }

    return true;
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/test.ts
------------------------------------------------------------------------------
// This file is required by karma.conf.js and loads recursively all the .spec and framework files

import 'zone.js/testing';
import { getTestBed } from '@angular/core/testing';
import {
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting
} from '@angular/platform-browser-dynamic/testing';

// First, initialize the Angular testing environment.
getTestBed().initTestEnvironment(
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting(),
);

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.gitignore
------------------------------------------------------------------------------
# Specifies intentionally untracked files to ignore when using Git
# http://git-scm.com/docs/gitignore

*~
*.sw[mnpcod]
.tmp
*.tmp
*.tmp.*
UserInterfaceState.xcuserstate
$RECYCLE.BIN/

*.log
log.txt


/.sourcemaps
/.versions
/coverage

# Ionic
/.ionic
/www
/platforms
/plugins

# Compiled output
/dist
/tmp
/out-tsc
/bazel-out

# Node
/node_modules
npm-debug.log
yarn-error.log

# IDEs and editors
.idea/
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-project
*.sublime-workspace

# Visual Studio Code
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
.history/*


# Miscellaneous
/.angular
/.angular/cache
.sass-cache/
/.nx
/.nx/cache
/connect.lock
/coverage
/libpeerconnection.log
testem.log
/typings

# System files
.DS_Store
Thumbs.db

node_modules/
.env
android/
ios/
dist/
build/


------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.editorconfig
------------------------------------------------------------------------------
# Editor configuration, see https://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
insert_final_newline = true
trim_trailing_whitespace = true

[*.ts]
quote_type = single

[*.md]
max_line_length = off
trim_trailing_whitespace = false

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/package.json
------------------------------------------------------------------------------
{
  "name": "app-ionic",
  "version": "0.0.1",
  "author": "Ionic Framework",
  "homepage": "https://ionicframework.com/",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "watch": "ng build --watch --configuration development",
    "test": "ng test",
    "lint": "ng lint"
  },
  "private": true,
  "dependencies": {
    "@angular/animations": "^20.0.0",
    "@angular/common": "^20.0.0",
    "@angular/compiler": "^20.0.0",
    "@angular/core": "^20.0.0",
    "@angular/forms": "^20.0.0",
    "@angular/platform-browser": "^20.0.0",
    "@angular/platform-browser-dynamic": "^20.0.0",
    "@angular/router": "^20.0.0",
    "@capacitor/app": "8.0.0",
    "@capacitor/core": "8.0.1",
    "@capacitor/haptics": "8.0.0",
    "@capacitor/keyboard": "8.0.0",
    "@capacitor/status-bar": "8.0.0",
    "@ionic/angular": "^8.0.0",
    "ionicons": "^7.0.0",
    "rxjs": "~7.8.0",
    "tslib": "^2.3.0",
    "zone.js": "~0.15.0"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "^20.0.0",
    "@angular-eslint/builder": "^20.0.0",
    "@angular-eslint/eslint-plugin": "^20.0.0",
    "@angular-eslint/eslint-plugin-template": "^20.0.0",
    "@angular-eslint/schematics": "^20.0.0",
    "@angular-eslint/template-parser": "^20.0.0",
    "@angular/cli": "^20.0.0",
    "@angular/compiler-cli": "^20.0.0",
    "@angular/language-service": "^20.0.0",
    "@capacitor/cli": "8.0.1",
    "@ionic/angular-toolkit": "^12.0.0",
    "@types/jasmine": "~5.1.0",
    "@typescript-eslint/eslint-plugin": "^8.18.0",
    "@typescript-eslint/parser": "^8.18.0",
    "eslint": "^9.16.0",
    "eslint-plugin-import": "^2.29.1",
    "eslint-plugin-jsdoc": "^48.2.1",
    "eslint-plugin-prefer-arrow": "1.2.2",
    "jasmine-core": "~5.1.0",
    "jasmine-spec-reporter": "~5.0.0",
    "karma": "~6.4.0",
    "karma-chrome-launcher": "~3.2.0",
    "karma-coverage": "~2.2.0",
    "karma-jasmine": "~5.1.0",
    "karma-jasmine-html-reporter": "~2.1.0",
    "typescript": "~5.9.0"
  },
  "description": "An Ionic project"
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.spec.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/spec",
    "types": [
      "jasmine"
    ]
  },
  "files": [
    "src/test.ts",
    "src/polyfills.ts"
  ],
  "include": [
    "src/**/*.spec.ts",
    "src/**/*.d.ts"
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/capacitor.config.json
------------------------------------------------------------------------------
{}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.eslintrc.json
------------------------------------------------------------------------------
{
  "root": true,
  "ignorePatterns": ["projects/**/*"],
  "overrides": [
    {
      "files": ["*.ts"],
      "parserOptions": {
        "project": ["tsconfig.json"],
        "createDefaultProgram": true
      },
      "extends": [
        "plugin:@angular-eslint/recommended",
        "plugin:@angular-eslint/template/process-inline-templates"
      ],
      "rules": {
        "@angular-eslint/prefer-standalone": "off",
        "@angular-eslint/component-class-suffix": [
          "error",
          {
            "suffixes": ["Page", "Component"]
          }
        ],
        "@angular-eslint/component-selector": [
          "error",
          {
            "type": "element",
            "prefix": "app",
            "style": "kebab-case"
          }
        ],
        "@angular-eslint/directive-selector": [
          "error",
          {
            "type": "attribute",
            "prefix": "app",
            "style": "camelCase"
          }
        ]
      }
    },
    {
      "files": ["*.html"],
      "extends": ["plugin:@angular-eslint/template/recommended"],
      "rules": {}
    }
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.browserslistrc
------------------------------------------------------------------------------
# This file is used by the build system to adjust CSS and JS output to support the specified browsers below.
# For additional information regarding the format and rule options, please see:
# https://github.com/browserslist/browserslist#queries

# For the full list of supported browsers by the Angular framework, please see:
# https://angular.dev/reference/versions#browser-support

# You can see what browsers were selected by your queries by running:
#   npx browserslist

Chrome >=107
Firefox >=106
Edge >=107
Safari >=16.1
iOS >=16.1

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/ionic.config.json
------------------------------------------------------------------------------
{
  "name": "app-ionic",
  "integrations": {
    "capacitor": {}
  },
  "type": "angular"
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.app.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/app",
    "types": []
  },
  "files": [
    "src/main.ts",
    "src/polyfills.ts"
  ],
  "include": [
    "src/**/*.d.ts"
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/capacitor.config.ts
------------------------------------------------------------------------------
import type { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'io.ionic.starter',
  appName: 'app-ionic',
  webDir: 'www'
};

export default config;

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "compileOnSave": false,
  "compilerOptions": {
    "baseUrl": "./",
    "outDir": "./dist/out-tsc",
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "sourceMap": true,
    "declaration": false,
    "downlevelIteration": true,
    "experimentalDecorators": true,
    "moduleResolution": "node",
    "importHelpers": true,
    "target": "es2022",
    "module": "es2020",
    "lib": [
      "es2018",
      "dom"
    ],
    "skipLibCheck": true,
    "useDefineForClassFields": false
  },
  "angularCompilerOptions": {
    "enableI18nLegacyMessageIdFormat": false,
    "strictInjectionParameters": true,
    "strictInputAccessModifiers": true,
    "strictTemplates": true
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.vscode/extensions.json
------------------------------------------------------------------------------
{
    "recommendations": [
       "Webnative.webnative"
    ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.vscode/settings.json
------------------------------------------------------------------------------
{
  "typescript.preferences.autoImportFileExcludePatterns": ["@ionic/angular/common", "@ionic/angular/standalone"]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/angular.json
------------------------------------------------------------------------------
{
  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
  "version": 1,
  "newProjectRoot": "projects",
  "projects": {
    "app": {
      "projectType": "application",
      "schematics": {},
      "root": "",
      "sourceRoot": "src",
      "prefix": "app",
      "architect": {
        "build": {
          "builder": "@angular-devkit/build-angular:browser",
          "options": {
            "outputPath": "www",
            "index": "src/index.html",
            "main": "src/main.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "tsconfig.app.json",
            "inlineStyleLanguage": "scss",
            "assets": [
              {
                "glob": "**/*",
                "input": "src/assets",
                "output": "assets"
              },
              {
                "glob": "**/*.svg",
                "input": "node_modules/ionicons/dist/ionicons/svg",
                "output": "./svg"
              }
            ],
            "styles": ["src/global.scss", "src/theme/variables.scss"],
            "scripts": []
          },
          "configurations": {
            "production": {
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "2mb",
                  "maximumError": "5mb"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "2kb",
                  "maximumError": "4kb"
                }
              ],
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.prod.ts"
                }
              ],
              "outputHashing": "all"
            },
            "development": {
              "buildOptimizer": false,
              "optimization": false,
              "vendorChunk": true,
              "extractLicenses": false,
              "sourceMap": true,
              "namedChunks": true
            },
            "ci": {
              "progress": false
            }
          },
          "defaultConfiguration": "production"
        },
        "serve": {
          "builder": "@angular-devkit/build-angular:dev-server",
          "configurations": {
            "production": {
              "buildTarget": "app:build:production"
            },
            "development": {
              "buildTarget": "app:build:development"
            },
            "ci": {
              "progress": false
            }
          },
          "defaultConfiguration": "development"
        },
        "extract-i18n": {
          "builder": "@angular-devkit/build-angular:extract-i18n",
          "options": {
            "buildTarget": "app:build"
          }
        },
        "test": {
          "builder": "@angular-devkit/build-angular:karma",
          "options": {
            "main": "src/test.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "tsconfig.spec.json",
            "karmaConfig": "karma.conf.js",
            "inlineStyleLanguage": "scss",
            "assets": [
              {
                "glob": "**/*",
                "input": "src/assets",
                "output": "assets"
              },
              {
                "glob": "**/*.svg",
                "input": "node_modules/ionicons/dist/ionicons/svg",
                "output": "./svg"
              }
            ],
            "styles": ["src/global.scss", "src/theme/variables.scss"],
            "scripts": []
          },
          "configurations": {
            "ci": {
              "progress": false,
              "watch": false
            }
          }
        },
        "lint": {
          "builder": "@angular-eslint/builder:lint",
          "options": {
            "lintFilePatterns": [
              "src/**/*.ts",
              "src/**/*.html"
            ]
          }
        }
      }
    }
  },
  "cli": {
    "schematicCollections": [
      "@ionic/angular-toolkit"
    ],
    "analytics": false
  },
  "schematics": {
    "@ionic/angular-toolkit:component": {
      "styleext": "scss"
    },
    "@ionic/angular-toolkit:page": {
      "styleext": "scss"
    }
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/Dockerfile
------------------------------------------------------------------------------
FROM node:20
WORKDIR /app
COPY package*.json ./
# Instalamos CLI de forma global y dependencias locales
RUN npm install -g @ionic/cli && npm install
COPY . .
EXPOSE 8100
# --poll ayuda a que detecte cambios en vol√∫menes de Ubuntu/Docker
CMD ["ionic", "serve", "--host=0.0.0.0", "--port=8100", "--disable-host-check"]
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/karma.conf.js
------------------------------------------------------------------------------
// Karma configuration file, see link for more information
// https://karma-runner.github.io/1.0/config/configuration-file.html

module.exports = function (config) {
  config.set({
    basePath: '',
    frameworks: ['jasmine', '@angular-devkit/build-angular'],
    plugins: [
      require('karma-jasmine'),
      require('karma-chrome-launcher'),
      require('karma-jasmine-html-reporter'),
      require('karma-coverage'),
      require('@angular-devkit/build-angular/plugins/karma')
    ],
    client: {
      jasmine: {
        // you can add configuration options for Jasmine here
        // the possible options are listed at https://jasmine.github.io/api/edge/Configuration.html
        // for example, you can disable the random execution with `random: false`
        // or set a specific seed with `seed: 4321`
      },
      clearContext: false // leave Jasmine Spec Runner output visible in browser
    },
    jasmineHtmlReporter: {
      suppressAll: true // removes the duplicated traces
    },
    coverageReporter: {
      dir: require('path').join(__dirname, './coverage/app'),
      subdir: '.',
      reporters: [
        { type: 'html' },
        { type: 'text-summary' }
      ]
    },
    reporters: ['progress', 'kjhtml'],
    port: 9876,
    colors: true,
    logLevel: config.LOG_INFO,
    autoWatch: true,
    browsers: ['Chrome'],
    singleRun: false,
    restartOnFileChange: true
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./subirGithub.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo " üöÄ GESTOR DE GITHUB - COSMOS"
echo "=============================="

# ==============================
# Selecci√≥n de usuario
# ==============================

echo "üë§ ¬øQui√©n est√° realizando los cambios?"
echo " [ 1 ] - Domingo"
echo " [ 2 ] - D√°maris"
echo " [ 0 ] - Salir"
echo "------------------------------"
read -p "Selecciona una opci√≥n: " USER_OPTION

case $USER_OPTION in
    1)
        USER_NAME="Domingo"
        USER_EMAIL="domingojosenavarroorihuela@alumno.ieselrincon.es"
        ;;
    2)
        USER_NAME="D√°maris"
        USER_EMAIL="damarisvidalrodriguez@alumno.ieselrincon.es"
        ;;
    0)
        echo "üëã Saliendo."
        exit 0
        ;;
    *)
        echo "‚ùå Opci√≥n no v√°lida."
        exit 1
        ;;
esac

git config user.name "$USER_NAME"
git config user.email "$USER_EMAIL"

echo "‚úÖ Identidad configurada como: $USER_NAME"
echo ""

# ==============================
# Verificar repo
# ==============================

if [ ! -d ".git" ]; then
  echo "‚ùå Este directorio no es un repositorio git"
  exit 1
fi

# ==============================
# Men√∫ principal
# ==============================

echo "üìå ¬øQu√© deseas hacer?"
echo " [ 1 ] Subir cambios a DEVELOP"
echo " [ 2 ] Migrar DEVELOP ‚Üí MAIN"
echo " [ 0 ] Salir"
echo "------------------------------"
read -p "Selecciona una opci√≥n: " OPCION

# ==============================
# OPCI√ìN 1 ‚Üí DEVELOP
# ==============================

if [ "$OPCION" == "1" ]; then

    echo "üåø Cambiando a rama develop..."

    # Crear develop si no existe
    git checkout develop 2>/dev/null || git checkout -b develop

    echo "üìã Estado actual:"
    git status -s

    echo "‚ûï A√±adiendo archivos..."
    git add .

    read -p "‚úèÔ∏è  Mensaje del commit: " MENSAJE

    if [ -z "$MENSAJE" ]; then
      MENSAJE="Actualizaci√≥n en develop por $USER_NAME"
    fi

    git commit -m "$MENSAJE"

    echo "‚¨ÜÔ∏è Subiendo a develop..."
    git push -u origin develop

    echo ""
    echo "‚úÖ Cambios subidos a DEVELOP"
    echo "======================================"
fi


# ==============================
# OPCI√ìN 2 ‚Üí MERGE A MAIN
# ==============================

if [ "$OPCION" == "2" ]; then

    echo "‚ö†Ô∏è Vas a migrar DEVELOP ‚Üí MAIN"
    read -p "¬øEst√°s seguro? (yes/no): " CONFIRMACION

    if [ "$CONFIRMACION" != "yes" ]; then
        echo "Cancelado."
        exit 0
    fi

    echo "üåø Cambiando a main..."
    git checkout main

    echo "üîÑ Haciendo merge de develop..."
    git merge develop

    echo "‚¨ÜÔ∏è Subiendo main..."
    git push origin main

    echo ""
    echo "üöÄ DEVELOP MIGRADO A MAIN"
    echo "======================================"
fi


------------------------------------------------------------------------------

[ARCHIVO]: ./peticiones/test_api.sh
------------------------------------------------------------------------------
#!/bin/bash

API="http://localhost:3000"

echo "====================================="
echo "      üß™ TEST AUTOM√ÅTICO COSMOS"
echo "====================================="


##################################
echo ""
echo "1Ô∏è‚É£ Comprobando API..."
##################################

curl -s $API | jq .

if [ $? -ne 0 ]; then
  echo "‚ùå API no responde"
  exit 1
fi

echo "‚úÖ API OK"



##################################
echo ""
echo "2Ô∏è‚É£ Login ADMIN"
##################################

curl -s -X POST $API/login \
-H "Content-Type: application/json" \
-d '{"email":"admin@mail.com","password":"admin"}' | jq .

echo "‚úÖ Login admin OK"



##################################
echo ""
echo "3Ô∏è‚É£ Obtener bonos"
##################################

curl -s $API/bonos | jq .

echo "‚úÖ Bonos cargan"



##################################
echo ""
echo "4Ô∏è‚É£ Crear pago cliente 10"
##################################

curl -s -X POST $API/pagos \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_bono":2,
"metodo_pago":"tarjeta"
}' | jq .

echo "‚úÖ Pago creado"



##################################
echo ""
echo "5Ô∏è‚É£ Ver bono activo"
##################################

curl -s $API/pagos/cliente/10/activo | jq .

echo "‚úÖ Bono activo detectado"



##################################
echo ""
echo "6Ô∏è‚É£ Intentar reservar SIN bono (cliente 14)"
##################################

curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":14,
"id_horario":1
}' | jq .

echo "üëâ Debe devolver error 403"



##################################
echo ""
echo "7Ô∏è‚É£ Crear reserva v√°lida (cliente 10)"
##################################

RESERVA=$(curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_horario":1
}')

echo $RESERVA | jq .

RESERVA_ID=$(echo $RESERVA | jq -r '.id_reserva')

echo "Reserva ID: $RESERVA_ID"



##################################
echo ""
echo "8Ô∏è‚É£ Ver sesiones restantes"
##################################

curl -s $API/pagos/cliente/10 | jq .

echo "üëâ Debe ser 9"



##################################
echo ""
echo "9Ô∏è‚É£ Probar duplicado"
##################################

curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_horario":1
}' | jq .

echo "üëâ Debe decir 'Ya tienes una reserva activa'"



##################################
echo ""
echo "üîü Cancelar reserva"
##################################

curl -s -X PATCH $API/reservas/$RESERVA_ID/cancelar | jq .

echo "‚úÖ Reserva cancelada"



##################################
echo ""
echo "11Ô∏è‚É£ Ver reservas cliente"
##################################

curl -s $API/reservas/cliente/10 | jq .



echo ""
echo "====================================="
echo "       ‚úÖ TEST COMPLETADO"
echo "====================================="

------------------------------------------------------------------------------

[ARCHIVO]: ./lectura.sh
------------------------------------------------------------------------------
#!/bin/bash

# ==============================================================================
# SCRIPT DE INSPECCI√ìN ESENCIAL
# OBJETIVO: Mostrar solo c√≥digo fuente y archivos de configuraci√≥n clave.
# ==============================================================================

ROOT_DIR=${1:-"."}

# Validar existencia del directorio
[ ! -d "$ROOT_DIR" ] && echo "Error: Directorio no encontrado." && exit 1

echo "=============================================================================="
echo "RESUMEN EJECUTIVO DE C√ìDIGO FUENTE"
echo "=============================================================================="

# B√∫squeda selectiva:
# 1. Excluye node_modules, .git, y assets de imagen.
# 2. Excluye archivos de bloqueo (lock) y temporales.
find "$ROOT_DIR" \( -name "node_modules" -o -name ".git" -o -name "assets" -o -name ".angular" \) -prune -o \
    -type f \
    ! -name "package-lock.json" \
    ! -name "*.png" \
    ! -name "*.svg" \
    ! -name "*.ico" \
    ! -name "*.jpg" \
    -print | while read -r archivo; do

    echo -e "\n[ARCHIVO]: $archivo"
    echo "------------------------------------------------------------------------------"
    
    # Mostrar contenido
    cat "$archivo"
    
    echo -e "\n------------------------------------------------------------------------------"
done

echo "=============================================================================="
echo "INSPECCI√ìN FINALIZADA"
echo "=============================================================================="

------------------------------------------------------------------------------

[ARCHIVO]: ./docker-compose.yml
------------------------------------------------------------------------------
services:
  postgres:
    image: postgres:16
    container_name: postgres-db
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
      - "${POSTGRES_PORT}:5432"
    volumes:
    - postgres_data:/var/lib/postgresql/data
    - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 5s
      timeout: 5s
      retries: 10

  api:
    build: ./api
    container_name: api-node
    ports:
      - "${API_PORT}:3000"
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      DB_HOST: postgres
      DB_USER: ${POSTGRES_USER}
      DB_PASS: ${POSTGRES_PASSWORD}
      DB_NAME: ${POSTGRES_DB}
    volumes:
      - ./api:/app
      - /app/node_modules

  ionic:
    build: ./ionic/app-ionic
    container_name: ionic-app
    ports:
      - "${IONIC_PORT}:8100"
    depends_on:
      - api
    volumes:
      - ./ionic/app-ionic:/app
      - /app/node_modules

volumes:
  postgres_data:

------------------------------------------------------------------------------

[ARCHIVO]: ./db/init.sql
------------------------------------------------------------------------------

CREATE TABLE Usuario (
id_usuario SERIAL PRIMARY KEY,
nombre VARCHAR(100) NOT NULL,
apellidos VARCHAR(100) NOT NULL,
email VARCHAR(100) UNIQUE NOT NULL,
password_hash VARCHAR(255) NOT NULL,
telefono VARCHAR(20),
rol VARCHAR(20) NOT NULL,
fecha_registro DATE DEFAULT CURRENT_DATE
);
CREATE TABLE Bono_Plan (
id_bono SERIAL PRIMARY KEY,
nombre_bono VARCHAR(100) UNIQUE NOT NULL,
precio NUMERIC(10,2) NOT NULL,
duracion_dias INTEGER,
num_sesiones INTEGER,
descripcion TEXT
);
CREATE TABLE Pago (
id_pago SERIAL PRIMARY KEY,
id_cliente INTEGER NOT NULL,
id_bono INTEGER NOT NULL,
fecha_pago TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
monto NUMERIC(10,2) NOT NULL,
metodo_pago VARCHAR(50),
fecha_vencimiento DATE,
CONSTRAINT fk_pago_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_pago_bono FOREIGN KEY (id_bono)
REFERENCES Bono_Plan(id_bono)
);
CREATE TABLE Clase (
id_clase SERIAL PRIMARY KEY,
nombre_clase VARCHAR(100) NOT NULL,
descripcion TEXT,
capacidad_maxima INTEGER NOT NULL,
contenido_profesor TEXT,
id_profesor INTEGER NOT NULL,
CONSTRAINT fk_clase_profesor FOREIGN KEY (id_profesor)
REFERENCES Usuario(id_usuario)
);
CREATE TABLE Horario (
id_horario SERIAL PRIMARY KEY,
id_clase INTEGER NOT NULL,
fecha DATE NOT NULL,
hora_inicio TIME NOT NULL,
hora_fin TIME NOT NULL,
reservas_abiertas BOOLEAN DEFAULT true, -- üëà A√ëADE
lugar VARCHAR(100),
CONSTRAINT fk_horario_clase FOREIGN KEY (id_clase)
REFERENCES Clase(id_clase)
);


CREATE TABLE Reserva (
id_reserva SERIAL PRIMARY KEY,
id_cliente INTEGER NOT NULL,
id_horario INTEGER NOT NULL,
fecha_reserva TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
estado VARCHAR(20) NOT NULL,
CONSTRAINT fk_reserva_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_reserva_horario FOREIGN KEY (id_horario)
REFERENCES Horario(id_horario)
);
CREATE TABLE Rutina (
id_rutina SERIAL PRIMARY KEY,
nombre_rutina VARCHAR(100) NOT NULL,
descripcion TEXT,
fecha_asignacion DATE DEFAULT CURRENT_DATE,
id_cliente INTEGER NOT NULL,
id_profesor INTEGER NOT NULL,
CONSTRAINT fk_rutina_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_rutina_profesor FOREIGN KEY (id_profesor)
REFERENCES Usuario(id_usuario)
);
------------------------------------------------------------------------------

[ARCHIVO]: ./texto.txt
------------------------------------------------------------------------------
prueba.
prueba2
------------------------------------------------------------------------------

[ARCHIVO]: ./.lectura.sh.swp
------------------------------------------------------------------------------
b0VIM 9.1      µ¥áiá1K " dno                                     dno-X570-Phantom-Gaming-4S              ~dno/ProyectoCosmos/lectura.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               utf-8U3210    #"! U                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 tp           `                            A       b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ad     ≥     `       £  ê  x  `  C  :  '    	    ›  √  i  Û  ‡  »  ∞  í  â  v  ^  V  O  ,    º  F  .      ˚  Ù  œ  µ  [  Â
  Œ
  «
  ´
  ë
  I
  ”	  ¿	  ®	  ô	  q	  i	  b	  D	  *	  ﬁ  h  P  8    ı  ÷  Õ  ∫  °  ô  í  r  X    í    h  a  @  %  “  \  E  >       ©  3      ¯  ﬁ  î      Û  ⁄  “  À  ∞  ñ  P  ⁄  ¬  ≥  ≤                               "bin": {       "license": "MIT",       "integrity": "sha512-+NYs2QeMWy+GWFOEm9xnn6HCDp0l7QBD7ml8zLUmJ+93Q5NF0NocErnwkTkXVFNiX3/fpC6afS8Dhb/gz7R7eg==",       "resolved": "https://registry.npmjs.org/uuid/-/uuid-8.3.2.tgz",       "version": "8.3.2",     "node_modules/uuid": {     },       }         "node": ">= 0.8"       "engines": {       "license": "MIT",       "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",       "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",       "version": "1.0.0",     "node_modules/unpipe": {     },       "license": "MIT"       "integrity": "sha512-Zz+aZWSj8LE6zoxD+xrjh4VfkIG8Ya6LvYkZqtUQGJPZjYl53ypCaUwWqo7eI0x66KBGeRo+mlBEkMSeSZ38Nw==",       "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-7.16.0.tgz",       "version": "7.16.0",     "node_modules/undici-types": {     },       "license": "MIT"       "integrity": "sha512-GMXzWtsc57XAtguZgaQViUOzs0KTkk8ojr3/xAxXLITqf/3EMwxC0inyETfDFjH/Krbhuep0HNbbjI9i/q3F3g==",       "resolved": "https://registry.npmjs.org/underscore/-/underscore-1.13.7.tgz",       "version": "1.13.7",     "node_modules/underscore": {     },       "license": "MIT"       "dev": true,       "integrity": "sha512-WxONCrssBM8TSPRqN5EmsjVrsv4A8X12J4ArBiiayv3DyyG3ZlIg6yysuuSYdZsVz3TKcTg2fd//Ujd4CHV1iA==",       "resolved": "https://registry.npmjs.org/undefsafe/-/undefsafe-2.0.5.tgz",       "version": "2.0.5",     "node_modules/undefsafe": {     },       }         "node": ">= 0.6"       "engines": {       },         "mime-types": "^3.0.0"         "media-typer": "^1.1.0",         "content-type": "^1.0.5",       "dependencies": {       "license": "MIT",       "integrity": "sha512-OZs6gsjF4vMp32qrCbiVSkrFmXtG/AZhY3t0iAMrMBiAZyV9oALtXO8hsrHbMXF9x6L3grlFuwW2oAz7cav+Gw==",       "resolved": "https://registry.npmjs.org/type-is/-/type-is-2.0.1.tgz",       "version": "2.0.1",     "node_modules/type-is": {     },       }         "nodetouch": "bin/nodetouch.js"       "bin": {       "license": "ISC",       "dev": true,       "integrity": "sha512-r0eojU4bI8MnHr8c5bNo7lJDdI2qXlWWJk6a9EAFG7vbhTjElYhBVS3/miuE0uOuoLdb8Mc/rVfsmm6eo5o9GA==",       "resolved": "https://registry.npmjs.org/touch/-/touch-3.1.1.tgz",       "version": "3.1.1",     "node_modules/touch": {     },       "license": "MIT"       "integrity": "sha512-OsLcGGbYF3rMjPUf8oKktyvCiUxSbqMMS39m33MAjLTC1DVIH6x3WSt63/M77ihI09+Sdfk1AXvfhCEeUmC7mg==",       "resolved": "https://registry.npmjs.org/toposort-class/-/toposort-class-1.0.1.tgz",       "version": "1.0.1",     "node_modules/toposort-class": {     },       }         "node": ">=0.6"       "engines": {       "license": "MIT",       "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",       "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",       "version": "1.0.1",     "node_modules/toidentifier": {     },       }         "node": ">=8.0"       "engines": {       },         "is-number": "^7.0.0"       "dependencies": {       "license": "MIT",       "dev": true,       "integrity": "sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==",       "resolved": "https://registry.npmjs.org/to-regex-range/-/to-regex-range-5.0.1.tgz",       "version": "5.0.1",     "node_modules/to-regex-range": {     },       }         "node": ">=4"       "engines": {       },         "has-flag": "^3.0.0"       "dependencies": {       "license": "MIT",       "dev": true, 2-QjVjwdXIt408MIiAqCX4oUKsgU2EqAGzs2Ppkm4aQYbjm+ZEWEcW4SfFNTr4uMNZma0ey4f5lgLrkB0aX0QMow==", ad  ‰  –     5       ‡  ÿ  —  ±  î  A  À  ≥  †  Ü  ~  w  \  B  ¸  Ü  n  [  B  :  3    ˇ  ª  E  -    ˙  Ú  Î  Œ  ¥  j  Ù
  ›
  ÷
  ∫
  †
  X
  ‚	   	  ∑	  ü	  ó	  ë	  ç	  ã	  ä	  â	  :	   	  —  –                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ------------------------------------------------------------------------------ ARCHIVO: ./api/Dockerfile ------------------------------------------------------------------------------   }   }     }       }         "node": ">=0.4"       "engines": {       "license": "MIT",       "integrity": "sha512-LKYU1iAXJXUgAXn9URjiu+MWhyUXHsvfp7mcuYm9dSUKK0/CjtrUwFAxD82/mCWbtLsGjFIad0wIsod4zrTAEQ==",       "resolved": "https://registry.npmjs.org/xtend/-/xtend-4.0.2.tgz",       "version": "4.0.2",     "node_modules/xtend": {     },       "license": "ISC"       "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==",       "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",       "version": "1.0.2",     "node_modules/wrappy": {     },       }         "@types/node": "*"       "dependencies": {       "license": "MIT",       "integrity": "sha512-Xng/d4Ichh8uN4l0FToV/258EjMGU9MGcA0HV2d9B/ZpZB3lqQm7nkOdZdm5GhKtLLhAE7PiVQwN4eN+2YJJUg==",       "resolved": "https://registry.npmjs.org/wkx/-/wkx-0.5.0.tgz",       "version": "0.5.0",     "node_modules/wkx": {     },       }         "node": ">= 0.8"       "engines": {       "license": "MIT",       "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",       "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",       "version": "1.1.2",     "node_modules/vary": {     },       }         "node": ">= 0.10"       "engines": {       "license": "MIT",       "integrity": "sha512-spH26xU080ydGggxRyR1Yhcbgx+j3y5jbNXk/8L+iRvdIEQ4uTRH2Sgf2dokud6Q4oAtsbNvJ1Ft+9xmm6IZcA==",       "resolved": "https://registry.npmjs.org/validator/-/validator-13.15.26.tgz",       "version": "13.15.26",     "node_modules/validator": {     },       }         "uuid": "dist/bin/uuid" 
------------------------------------------------------------------------------

[ARCHIVO]: ./.env
------------------------------------------------------------------------------
# Postgres
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin123
POSTGRES_DB=cosmos_db
POSTGRES_PORT=5432

# Backend
API_PORT=3000

# Frontend
IONIC_PORT=8100


------------------------------------------------------------------------------

[ARCHIVO]: ./win_start.ps1
------------------------------------------------------------------------------
Write-Host "=============================="
Write-Host "  INICIANDO COSMOS FITNESS"
Write-Host "=============================="

docker compose build
docker compose up -d

Write-Host "API: http://localhost:3000"
Write-Host "FRONTEND: http://localhost:8100"

------------------------------------------------------------------------------

[ARCHIVO]: ./start.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  INICIANDO COSMOS FITNESS"
echo "=============================="

if ! command -v docker &> /dev/null
then
    echo "‚ùå Docker no est√° instalado"
    exit 1
fi

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "‚û° Usando: $COMPOSE"

echo "üöÄ Levantando servicios SIN rebuild..."
$COMPOSE up -d

echo "=============================="
echo " COSMOS FITNESS EN MARCHA"
echo " API:      http://localhost:3000"
echo " FRONTEND: http://localhost:8100"
echo "=============================="


------------------------------------------------------------------------------

[ARCHIVO]: ./lectura.txt
------------------------------------------------------------------------------
==============================================================================
RESUMEN EJECUTIVO DE C√ìDIGO FUENTE
==============================================================================

[ARCHIVO]: ./.dockerignore
------------------------------------------------------------------------------
node_modules
npm-debug.log
------------------------------------------------------------------------------

[ARCHIVO]: ./.gitignore
------------------------------------------------------------------------------
# Node
node_modules/
npm-debug.log*
yarn-error.log*

# Environment
.env

# Docker
*.log

# Angular / Ionic
dist/
.angular/
www/

# OS
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/


------------------------------------------------------------------------------

[ARCHIVO]: ./package.json
------------------------------------------------------------------------------
{
  "name": "cosmos-api",
  "version": "1.0.0",
  "main": "src/app.js",
  "scripts": {
    "start": "node src/app.js",
    "dev": "nodemon src/app.js"
  },
  "dependencies": {
    "express": "^5.2.1",
    "sequelize": "^6.37.0",
    "pg": "^8.11.0",
    "pg-hstore": "^2.3.4",
    "dotenv": "^16.4.0",
    "cors": "`2.8.5"
  },
  "devDependencies": {
    "nodemon": "^3.0.0"
  }
}
------------------------------------------------------------------------------

[ARCHIVO]: ./stop.sh
------------------------------------------------------------------------------
#!/bin/bash

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "üõë Parando Cosmos Fitness..."
$COMPOSE down
echo "üóëÔ∏è Borrando volumen de datos de Postgres..."
docker volume rm proyectocosmos_postgres_data

------------------------------------------------------------------------------

[ARCHIVO]: ./README.md
------------------------------------------------------------------------------
# ProyectoCosmos

#Usuarios de prueba

Cliente:
juan@mail.com
 / 1234

Profesor:
ana@mail.com
 / 1234

Admin:
admin@mail.com
 / admin



 // Configurar el repo:

 git clone https://github.com/TU_USUARIO/ProyectoCosmos.git


Ejemplo clone : https://github.com/ieselrincon-dnavori/ProyectoCosmos
 
 
 
 
cd NOMBRE_DEL_PROYECTO
chmod +x *.ps1


Configurar tus credenciales globales para git/github

git config --global credential.helper store




/// EJECUTAR ESTO SI NO FUNCIONA LOS SCRIPT PARA WINDOWS

Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser



//USO DE LA API

Ver horarios
    curl -s http://localhost:3000/horarios | jq


------------------------------------------------------------------------------

[ARCHIVO]: ./win_stop.ps1
------------------------------------------------------------------------------
Write-Host "üõë Parando Cosmos Fitness..."

# Detectar si existe docker-compose
$compose = "docker compose"

if (Get-Command "docker-compose" -ErrorAction SilentlyContinue) {
    $compose = "docker-compose"
}

Write-Host "‚û° Usando: $compose"

# Parar contenedores
Invoke-Expression "$compose down"

------------------------------------------------------------------------------

[ARCHIVO]: ./win_subirGitHub.ps1
------------------------------------------------------------------------------
# Configuraci√≥n de codificaci√≥n para emojis
$OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8

Write-Host "==============================" -ForegroundColor Cyan
Write-Host " üöÄ GESTI√ìN DE REPOSITORIO" -ForegroundColor Cyan
Write-Host "==============================" -ForegroundColor Cyan

# 1. COMPROBAR CAMBIOS NUEVOS EN LA NUBE
Write-Host "üîç Buscando cambios nuevos en GitHub..." -ForegroundColor Gray
git fetch | Out-Null

$cambiosNuevos = git log HEAD..origin/main --oneline --pretty=format:"- %an: %s"

if ($cambiosNuevos) {
    Write-Host "‚ö†Ô∏è  HAY CAMBIOS NUEVOS DE TU COMPA√ëERO/A:" -ForegroundColor Yellow
    Write-Host $cambiosNuevos
    Write-Host "`nüì• Descargando actualizaciones antes de continuar..." -ForegroundColor Gray
    git pull
} else {
    Write-Host "‚ú® Todo actualizado, no hay cambios externos." -ForegroundColor Green
}

Write-Host "`n------------------------------"

# 2. MEN√ö DE SELECCI√ìN DE USUARIO
Write-Host "üë§ ¬øQui√©n est√° realizando los cambios ahora?"
Write-Host " [ 1 ] - Domingo"
Write-Host " [ 2 ] - D√°maris"
Write-Host " [ 0 ] - Salir"
Write-Host "------------------------------"
$opcion = Read-Host "Selecciona una opci√≥n"

switch ($opcion) {
    "1" {
        $userName = "Domingo"
        $userEmail = "domingojosenavarroorihuela@alumno.ieselrincon.es"
    }
    "2" {
        $userName = "D√°maris"
        $userEmail = "damarisvidalrodriguez@alumno.ieselrincon.es"
    }
    "0" {
        Write-Host "üëã Saliendo..." -ForegroundColor Yellow
        exit
    }
    Default {
        Write-Host "‚ùå Opci√≥n no v√°lida." -ForegroundColor Red
        exit
    }
}

# Configurar identidad local
git config user.name "$userName"
git config user.email "$userEmail"

# 3. PROCESO DE SUBIDA
if (-not (Test-Path ".git")) {
    Write-Host "‚ùå Error: No es un repositorio git." -ForegroundColor Red
    exit
}

Write-Host "`nüìã Estado actual:" -ForegroundColor Yellow
git status -s

Write-Host "`n‚ûï A√±adiendo archivos..." -ForegroundColor Yellow
git add .

$mensaje = Read-Host "‚úèÔ∏è  Mensaje del commit"
if ([string]::IsNullOrWhiteSpace($mensaje)) {
    $mensaje = "Actualizaci√≥n autom√°tica por $userName"
}

Write-Host "üì¶ Creando commit..." -ForegroundColor Yellow
git commit -m "$mensaje"

Write-Host "‚¨ÜÔ∏è  Subiendo a GitHub..." -ForegroundColor Yellow
git push

Write-Host "======================================" -ForegroundColor Green
Write-Host " ‚úÖ PROYECTO SUBIDO POR $userName" -ForegroundColor Green
Write-Host "======================================" -ForegroundColor Green
------------------------------------------------------------------------------

[ARCHIVO]: ./restart.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  REINICIANDO COSMOS FITNESS"
echo "=============================="

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "‚û° Usando: $COMPOSE"

echo "üõë Parando contenedores..."
$COMPOSE down

echo "üöÄ Levantando servicios SIN rebuild..."
$COMPOSE up -d

echo ""
echo "üí° Si cambiaste Dockerfile o package.json usa:"
echo "   docker compose up -d --build"

echo "=============================="
echo " COSMOS FITNESS REINICIADO"
echo "=============================="


------------------------------------------------------------------------------

[ARCHIVO]: ./.env.example
------------------------------------------------------------------------------
# POSTGRES
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin
POSTGRES_DB=cosmos_db
POSTGRES_PORT=5432

# API
API_PORT=3000

# IONIC
IONIC_PORT=8100

------------------------------------------------------------------------------

[ARCHIVO]: ./build.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  BUILD COMPLETO COSMOS"
echo "=============================="

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

$COMPOSE down
$COMPOSE up -d --build

echo "‚úÖ Build terminado"


------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/.dockerignore
------------------------------------------------------------------------------
node_modules
www
dist
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/main.ts
------------------------------------------------------------------------------
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';

import { AppModule } from './app/app.module';

platformBrowserDynamic().bootstrapModule(AppModule)
  .catch(err => console.log(err));

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/index.html
------------------------------------------------------------------------------
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Ionic App</title>

  <base href="/" />

  <meta name="color-scheme" content="light dark" />
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />

  <link rel="icon" type="image/png" href="assets/icon/favicon.png" />

  <!-- add to homescreen for ios -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
</head>

<body>
  <app-root></app-root>
</body>

</html>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/zone-flags.ts
------------------------------------------------------------------------------
/**
 * Prevents Angular change detection from
 * running with certain Web Component callbacks
 */
// eslint-disable-next-line no-underscore-dangle
(window as any).__Zone_disable_customElements = true;

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/theme/variables.scss
------------------------------------------------------------------------------
// For information on how to create your own theme, please refer to:
// https://ionicframework.com/docs/theming/

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/polyfills.ts
------------------------------------------------------------------------------
/**
 * This file includes polyfills needed by Angular and is loaded before the app.
 * You can add your own extra polyfills to this file.
 *
 * This file is divided into 2 sections:
 *   1. Browser polyfills. These are applied before loading ZoneJS and are sorted by browsers.
 *   2. Application imports. Files imported after ZoneJS that should be loaded before your main
 *      file.
 *
 * The current setup is for so-called "evergreen" browsers; the last versions of browsers that
 * automatically update themselves. This includes recent versions of Safari, Chrome (including
 * Opera), Edge on the desktop, and iOS and Chrome on mobile.
 *
 * Learn more in https://angular.io/guide/browser-support
 */

/***************************************************************************************************
 * BROWSER POLYFILLS
 */

/**
 * By default, zone.js will patch all possible macroTask and DomEvents
 * user can disable parts of macroTask/DomEvents patch by setting following flags
 * because those flags need to be set before `zone.js` being loaded, and webpack
 * will put import in the top of bundle, so user need to create a separate file
 * in this directory (for example: zone-flags.ts), and put the following flags
 * into that file, and then add the following code before importing zone.js.
 * import './zone-flags';
 *
 * The flags allowed in zone-flags.ts are listed here.
 *
 * The following flags will work for all browsers.
 *
 * (window as any).__Zone_disable_requestAnimationFrame = true; // disable patch requestAnimationFrame
 * (window as any).__Zone_disable_on_property = true; // disable patch onProperty such as onclick
 * (window as any).__zone_symbol__UNPATCHED_EVENTS = ['scroll', 'mousemove']; // disable patch specified eventNames
 *
 *  in IE/Edge developer tools, the addEventListener will also be wrapped by zone.js
 *  with the following flag, it will bypass `zone.js` patch for IE/Edge
 *
 *  (window as any).__Zone_enable_cross_context_check = true;
 *
 */
 
import './zone-flags';

/***************************************************************************************************
 * Zone JS is required by default for Angular itself.
 */
import 'zone.js';  // Included with Angular CLI.


/***************************************************************************************************
 * APPLICATION IMPORTS
 */

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/global.scss
------------------------------------------------------------------------------
/*
 * App Global CSS
 * ----------------------------------------------------------------------------
 * Put style rules here that you want to apply globally. These styles are for
 * the entire app and not just one component. Additionally, this file can be
 * used as an entry point to import other CSS/Sass files to be included in the
 * output CSS.
 * For more information on global stylesheets, visit the documentation:
 * https://ionicframework.com/docs/layout/global-stylesheets
 */

/* Core CSS required for Ionic components to work properly */
@import "@ionic/angular/css/core.css";

/* Basic CSS for apps built with Ionic */
@import "@ionic/angular/css/normalize.css";
@import "@ionic/angular/css/structure.css";
@import "@ionic/angular/css/typography.css";
@import "@ionic/angular/css/display.css";

/* Optional CSS utils that can be commented out */
@import "@ionic/angular/css/padding.css";
@import "@ionic/angular/css/float-elements.css";
@import "@ionic/angular/css/text-alignment.css";
@import "@ionic/angular/css/text-transformation.css";
@import "@ionic/angular/css/flex-utils.css";

/**
 * Ionic Dark Mode
 * -----------------------------------------------------
 * For more info, please see:
 * https://ionicframework.com/docs/theming/dark-mode
 */

/* @import "@ionic/angular/css/palettes/dark.always.css"; */
/* @import "@ionic/angular/css/palettes/dark.class.css"; */
@import "@ionic/angular/css/palettes/dark.system.css";

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/environments/environment.prod.ts
------------------------------------------------------------------------------
export const environment = {
  production: true,
  apiUrl: 'http://api-node:3000'
};
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/environments/environment.ts
------------------------------------------------------------------------------
// This file can be replaced during build by using the `fileReplacements` array.
// `ng build` replaces `environment.ts` with `environment.prod.ts`.
// The list of file replacements can be found in `angular.json`.

export const environment = {
  production: false,
  apiUrl: 'http://localhost:3000'
};


/*
 * For easier debugging in development mode, you can import the following file
 * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.
 *
 * This import should be commented out in production mode because it will have a negative impact
 * on performance if an error is thrown.
 */
// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/api.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class Api {
  
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/usuario.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({
  providedIn: 'root'
})

export class UsuarioService {

  private api = 'http://localhost:3000/usuarios';

  constructor(private http: HttpClient) {}

  getUsuariosAdmin() {
    return this.http.get<any[]>(`${this.api}/admin`);
  }

  toggleActivo(id:number) {
    return this.http.patch(`${this.api}/${id}/toggle-activo`, {});
  }

  crearUsuario(usuario:any){
  return this.http.post(
    'http://localhost:3000/usuarios/admin',
    usuario
  );
}


  crearUsuarioAdmin(data: any) {
  return this.http.post(
    'http://localhost:3000/usuarios/admin',
    data
  );


}


}
export class ReservaService {

  private baseUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  getReservasCliente(idCliente: number) {
    return this.http.get<any[]>(
      `${this.baseUrl}/reservas/cliente/${idCliente}`
    );
  }
}




------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/horario.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class HorarioService {

  private apiUrl = 'http://localhost:3000/horarios';

  constructor(private http: HttpClient) {}

  getHorarios(idCliente: number): Observable<any[]> {
    return this.http.get<any[]>(`${this.apiUrl}?id_cliente=${idCliente}`);
  }

/** 
  getHorariosProfesor(idProfesor: number): Observable<any[]> {
  return this.http.get<any[]>(
    `http://localhost:3000/horarios/profesor/${idProfesor}`
  );
}
*/
cerrarReservas(idHorario: number) {
  return this.http.patch(
    `http://localhost:3000/horarios/${idHorario}/cerrar`,
    {}
  );
}

abrirReservas(idHorario: number) {
  return this.http.patch(
    `http://localhost:3000/horarios/${idHorario}/abrir`,
    {}
  );
}
getHorariosProfesor(idProfesor: number) {
  return this.http.get<any[]>(
    `http://localhost:3000/horarios/profesor/${idProfesor}`
  );
}

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/api.spec.ts
------------------------------------------------------------------------------
import { TestBed } from '@angular/core/testing';

import { Api } from './api';

describe('Api', () => {
  let service: Api;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(Api);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/auth.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({ providedIn: 'root' })
export class AuthService {

  private baseUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  login(email: string, password: string) {
    return this.http.post<any>(`${this.baseUrl}/login`, { email, password });
  }

  saveUser(user: any) {
    localStorage.setItem('user', JSON.stringify(user));
  }

  getUser() {
    return JSON.parse(localStorage.getItem('user') || 'null');
  }

  isLogged(): boolean {
  return !!this.getUser();
  }

  getRole(): string | null {
    const user = this.getUser();
    return user ? user.rol : null;
  }


  logout() {
    localStorage.removeItem('user');
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/reserva.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({
  providedIn: 'root'
})
export class ReservaService {
  private apiUrl = 'http://localhost:3000/reservas';

  private baseUrl = `${environment.apiUrl}/reservas`;

  constructor(private http: HttpClient) {}

  getReservasCliente(idCliente: number) {
    return this.http.get<any[]>(`${this.baseUrl}/cliente/${idCliente}`);
  }

  cancelarReserva(idReserva: number) {
    console.log('URL cancelaci√≥n:', `${this.baseUrl}/${idReserva}/cancelar`);

    return this.http.patch(
      `${this.baseUrl}/${idReserva}/cancelar`,
      {}
    );
  }

  crearReserva(data: { id_cliente: number; id_horario: number }) {
  return this.http.post(this.baseUrl, data);
}

forzarCancelacion(idReserva: number) {
  return this.http.patch(
    `${this.apiUrl}/${idReserva}/forzar-cancelacion`,
    {}
  );
}
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/pago.service.ts
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/clase.service.ts
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { PreloadAllModules, RouterModule, Routes } from '@angular/router';
import { AuthGuard } from './guards/auth-guard';



const routes: Routes = [
  {
    path: 'login',
    loadChildren: () => import('./pages/login/login.module').then(m => m.LoginPageModule)
  },

  {
    path: 'cliente',
    loadChildren: () => import('./pages/cliente/cliente.module').then(m => m.ClientePageModule),
    canActivate: [AuthGuard],
    data: { roles: ['cliente'] }
  },

  {
    path: 'profesor',
    loadChildren: () => import('./pages/profesor/profesor.module').then(m => m.ProfesorPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['profesor'] }
  },

  {
    path: 'admin',
    loadChildren: () => import('./pages/admin/admin.module').then(m => m.AdminPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['admin'] }
  },

  {
    path: 'horarios',
    loadChildren: () => import('./pages/horarios/horarios.module').then(m => m.HorariosPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['cliente', 'profesor', 'admin'] } // accesible para todos
  },

  {
    path: '',
    redirectTo: 'login',
    pathMatch: 'full'
  },
  {
    path: 'alumnos-modal',
    loadChildren: () => import('./pages/alumnos-modal/alumnos-modal.module').then( m => m.AlumnosModalPageModule)
  },
  {
    path: 'admin-crear-usuario',
    loadChildren: () => import('./pages/admin-crear-usuario/admin-crear-usuario.module')
    .then( m => m.AdminCrearUsuarioPageModule)
  }
];

@NgModule({
  imports: [
    RouterModule.forRoot(routes, { preloadingStrategy: PreloadAllModules })
  ],
  exports: [RouterModule]
})
export class AppRoutingModule { }

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.spec.ts
------------------------------------------------------------------------------
import { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { TestBed } from '@angular/core/testing';

import { AppComponent } from './app.component';

describe('AppComponent', () => {

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [AppComponent],
      schemas: [CUSTOM_ELEMENTS_SCHEMA],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { HomePage } from './home.page';

describe('HomePage', () => {
  let component: HomePage;
  let fixture: ComponentFixture<HomePage>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [HomePage],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(HomePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { HomePage } from './home.page';

const routes: Routes = [
  {
    path: '',
    component: HomePage,
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class HomePageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';
import { FormsModule } from '@angular/forms';
import { HomePage } from './home.page';

import { HomePageRoutingModule } from './home-routing.module';


@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    HomePageRoutingModule
  ],
  declarations: [HomePage]
})
export class HomePageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';

@Component({
  selector: 'app-home',
  templateUrl: 'home.page.html',
  styleUrls: ['home.page.scss'],
  standalone: false,
})
export class HomePage {

  constructor() {}

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.scss
------------------------------------------------------------------------------
#container {
  text-align: center;

  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
}

#container strong {
  font-size: 20px;
  line-height: 26px;
}

#container p {
  font-size: 16px;
  line-height: 22px;

  color: #8c8c8c;

  margin: 0;
}

#container a {
  text-decoration: none;
}
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.html
------------------------------------------------------------------------------
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Blank
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Blank</ion-title>
    </ion-toolbar>
  </ion-header>

  <div id="container">
    <strong>Ready to create an app?</strong>
    <p>Start with Ionic <a target="_blank" rel="noopener noreferrer" href="https://ionicframework.com/docs/components">UI Components</a></p>
  </div>
</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AuthService } from './services/auth.service';
import { Router } from '@angular/router';

interface MenuItem {
  title: string;
  url: string;
  icon: string;
}

@Component({
  selector: 'app-root',
  standalone: false,
  templateUrl: 'app.component.html',
})
export class AppComponent implements OnInit {

  menuItems: MenuItem[] = [];

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  ngOnInit() {
    this.loadMenu();
  }

  loadMenu() {
    const user = this.auth.getUser();
    if (!user) return;

    if (user.rol === 'cliente') {
      this.menuItems = [
        { title: 'Inicio', url: '/cliente', icon: 'home-outline' },
        { title: 'Horarios', url: '/horarios', icon: 'calendar-outline' },
        { title: 'Mis reservas', url: '/cliente', icon: 'bookmark-outline' },
      ];
    }

    if (user.rol === 'profesor') {
      this.menuItems = [
        { title: 'Mis clases', url: '/profesor', icon: 'fitness-outline' },
        { title: 'Horarios', url: '/horarios', icon: 'calendar-outline' },
      ];
    }

    if (user.rol === 'admin') {
      this.menuItems = [
        { title: 'Usuarios', url: '/admin', icon: 'people-outline' },
        { title: 'Clases', url: '/admin', icon: 'barbell-outline' },
        { title: 'Pagos', url: '/admin', icon: 'card-outline' },
      ];
    }
  }

  logout() {
    this.auth.logout();
    this.router.navigate(['/login']);
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.html
------------------------------------------------------------------------------
<ion-app>

  <ion-menu contentId="main-content">
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Cosmos Fitness</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <ion-list>

        <ion-item *ngFor="let item of menuItems" [routerLink]="item.url">
          <ion-icon [name]="item.icon" slot="start"></ion-icon>
          <ion-label>{{ item.title }}</ion-label>
        </ion-item>

        <ion-item button color="danger" (click)="logout()">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          <ion-label>Cerrar sesi√≥n</ion-label>
        </ion-item>

      </ion-list>
    </ion-content>
  </ion-menu>

  <!-- AQU√ç EL CAMBIO -->
  <ion-router-outlet id="main-content"></ion-router-outlet>

</ion-app>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { RouteReuseStrategy } from '@angular/router';
import { IonicModule, IonicRouteStrategy } from '@ionic/angular';
import { AppComponent } from './app.component';
import { AppRoutingModule } from './app-routing.module';
import { FormsModule } from '@angular/forms';
import { HttpClientModule } from '@angular/common/http';



@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, 
    IonicModule.forRoot(),
     AppRoutingModule,
     FormsModule,
     HttpClientModule],
  providers: [{ provide: RouteReuseStrategy, useClass: IonicRouteStrategy }],
  bootstrap: [AppComponent],
  
})



export class AppModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar>
    <ion-title>Cosmos Fitness</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div style="max-width: 400px; margin: auto; margin-top: 15vh;">

    <ion-card>
      <ion-card-header>
        <ion-card-title>Iniciar sesi√≥n</ion-card-title>
      </ion-card-header>

      <ion-card-content>

        <ion-item>
          <ion-label position="floating">Email</ion-label>
          <ion-input
            type="email"
            [(ngModel)]="email"
            required>
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Contrase√±a</ion-label>
          <ion-input
            type="password"
            [(ngModel)]="password"
            required>
          </ion-input>
        </ion-item>

        <!-- Mensaje de error -->
        <ion-text color="danger" *ngIf="errorMsg">
          <p style="margin-top: 10px;">{{ errorMsg }}</p>
        </ion-text>

        <!-- Bot√≥n login -->
        <ion-button
          expand="block"
          color="primary"
          style="margin-top: 20px;"
          (click)="login()"
          [disabled]="loading">

          <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
          <span *ngIf="!loading">Entrar</span>

        </ion-button>

      </ion-card-content>
    </ion-card>

  </div>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from '../../services/auth.service';

@Component({
  selector: 'app-login',
  standalone: false,
  templateUrl: './login.page.html',
})
export class LoginPage {

  email = '';
  password = '';

  loading = false;
  errorMsg = '';

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  login() {
    this.loading = true;
    this.errorMsg = '';

    this.auth.login(this.email, this.password).subscribe({
      next: user => {
        this.loading = false;
        this.auth.saveUser(user);

        switch (user.rol) {
          case 'cliente':
            this.router.navigate(['/cliente']);
            break;
          case 'profesor':
            this.router.navigate(['/profesor']);
            break;
          case 'admin':
            this.router.navigate(['/admin']);
            break;
          default:
            this.router.navigate(['/home']);
        }
      },
      error: err => {
        this.loading = false;

        if (err.status === 401) {
          this.errorMsg = 'Credenciales incorrectas';
        } else {
          this.errorMsg = 'Error de conexi√≥n con el servidor';
        }
      }
    });
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { LoginPage } from './login.page';

describe('LoginPage', () => {
  let component: LoginPage;
  let fixture: ComponentFixture<LoginPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(LoginPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { LoginPageRoutingModule } from './login-routing.module';

import { LoginPage } from './login.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    LoginPageRoutingModule
  ],
  declarations: [LoginPage]
})
export class LoginPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { LoginPage } from './login.page';

const routes: Routes = [
  {
    path: '',
    component: LoginPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class LoginPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { HorariosPage } from './horarios.page';

describe('HorariosPage', () => {
  let component: HorariosPage;
  let fixture: ComponentFixture<HorariosPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(HorariosPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Horarios disponibles</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="horarios.length > 0; else sinHorarios">

    <ion-item *ngFor="let h of horarios">
      <ion-label>
        <h2>{{ h.Clase?.nombre_clase }}</h2>
        <p>{{ h.fecha }} ¬∑ {{ h.hora_inicio }} - {{ h.hora_fin }}</p>
        <p>{{ h.lugar }}</p>
        <p>
          Profesor:
          {{ h.Clase?.profesor?.nombre }}
          {{ h.Clase?.profesor?.apellidos }}
        </p>
        <p>
            Plazas:
            {{ h.plazas_ocupadas }} / {{ h.plazas_totales }}
        </p>
      </ion-label>
<ion-button
  slot="end"
  color="success"
  fill="outline"
  [disabled]="!h.plazas_disponibles || h.ya_reservado"
  (click)="reservar(h)">

  <ng-container *ngIf="h.ya_reservado">
    Ya reservado
  </ng-container>

  <ng-container *ngIf="!h.ya_reservado && !h.plazas_disponibles">
    Completo
  </ng-container>

  <ng-container *ngIf="!h.ya_reservado && h.plazas_disponibles">
    Reservar
  </ng-container>

</ion-button>

    </ion-item>

  </ion-list>

  <ng-template #sinHorarios>
    <ion-text color="medium">
      <p>No hay horarios disponibles.</p>
    </ion-text>
  </ng-template>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { HorariosPage } from './horarios.page';

const routes: Routes = [
  {
    path: '',
    component: HorariosPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class HorariosPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { HorarioService } from '../../services/horario.service';
import { ReservaService } from '../../services/reserva.service';
import { AuthService } from '../../services/auth.service';
import { AlertController } from '@ionic/angular';

@Component({
  selector: 'app-horarios',
  templateUrl: './horarios.page.html',
  styleUrls: ['./horarios.page.scss'],
  standalone: false,
})
export class HorariosPage implements OnInit {

  horarios: any[] = [];
  user: any;

  constructor(
    private horarioService: HorarioService,
    private reservaService: ReservaService,
    private auth: AuthService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
  }

  cargarHorarios() {
    this.horarioService.getHorarios(this.user.id_usuario).subscribe({
      next: data => this.horarios = data,
      error: err => console.error(err)
    });
  }

  reservar(horario: any) {
    this.reservaService.crearReserva({
      id_cliente: this.user.id_usuario,
      id_horario: horario.id_horario
    }).subscribe({
      next: () => this.cargarHorarios(),
      error: err => this.mostrarError(err.error?.error || 'Error al reservar')
    });
  }

  async mostrarError(msg: string) {
    const alert = await this.alertCtrl.create({
      header: 'Reserva',
      message: msg,
      buttons: ['OK']
    });
    await alert.present();
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { HorariosPageRoutingModule } from './horarios-routing.module';

import { HorariosPage } from './horarios.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    HorariosPageRoutingModule
  ],
  declarations: [HorariosPage]
})
export class HorariosPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';

import { ClientePageRoutingModule } from './cliente-routing.module';
import { ClientePage } from './cliente.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ClientePageRoutingModule
  ],
  declarations: [ClientePage]
})
export class ClientePageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mis reservas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="reservas.length > 0; else sinReservas">

  <ion-item *ngFor="let r of reservas">
    <ion-label>
      <h2>{{ r.Horario?.Clase?.nombre_clase }}</h2>

      <p>
        {{ r.Horario?.fecha }}
        ¬∑ {{ r.Horario?.hora_inicio }} - {{ r.Horario?.hora_fin }}
      </p>

      <p>
        Profesor:
        {{ r.Horario?.Clase?.profesor?.nombre }}
        {{ r.Horario?.Clase?.profesor?.apellidos }}
      </p>

      <ion-badge
        [color]="r.estado === 'activa' ? 'success' : 'medium'">
        {{ r.estado | uppercase }}
      </ion-badge>
    </ion-label>

    <ion-button
      *ngIf="r.estado === 'activa'"
      color="danger"
      fill="outline"
      slot="end"
      (click)="cancelar(r)">
      Cancelar
    </ion-button>

  </ion-item>

</ion-list>

<ng-template #sinReservas>
  <ion-text color="medium">
    <p>No tienes reservas.</p>
  </ion-text>
</ng-template>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AlertController } from '@ionic/angular';
import { ReservaService } from '../../services/reserva.service';
import { HorarioService } from '../../services/horario.service';
import { AuthService } from '../../services/auth.service';

@Component({
  selector: 'app-cliente',
  standalone: false,
  templateUrl: './cliente.page.html',
  styleUrls: ['./cliente.page.scss']
})
export class ClientePage implements OnInit {

  user: any;

  // üîπ NUEVO
  horarios: any[] = [];

  // üîπ EXISTENTE
  reservas: any[] = [];

  constructor(
    private reservaService: ReservaService,
    private horarioService: HorarioService,
    private auth: AuthService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
    this.cargarReservas();
  }

  // =====================
  // HORARIOS
  // =====================
  cargarHorarios() {
    this.horarioService.getHorarios(this.user.id_usuario).subscribe({
      next: data => this.horarios = data,
      error: err => console.error(err)
    });
  }

  get tieneReservasActivas(): boolean {
  return this.reservas.some(r => r.estado === 'activa');
}

  reservar(idHorario: number) {
    this.reservaService.crearReserva({
      id_cliente: this.user.id_usuario,
      id_horario: idHorario
    }).subscribe({
      next: () => {
        this.cargarReservas();
        alert('Reserva realizada ‚úÖ');
      },
      error: err => {
        alert(err.error?.error || 'No se pudo reservar');
      }
    });
  }

 
  cargarReservas() {
    this.reservaService.getReservasCliente(this.user.id_usuario)
      .subscribe({
        next: data => this.reservas = data,
        error: err => console.error(err)
      });
  }

  async cancelar(reserva: any) {
    const alert = await this.alertCtrl.create({
      header: 'Cancelar reserva',
      message: '¬øSeguro que deseas cancelar esta reserva?',
      buttons: [
        { text: 'No', role: 'cancel' },
        {
          text: 'S√≠, cancelar',
          handler: () => {
            this.reservaService
              .cancelarReserva(reserva.id_reserva)
              .subscribe(() => this.cargarReservas());
          }
        }
      ]
    });

    await alert.present();
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ClientePage } from './cliente.page';

describe('ClientePage', () => {
  let component: ClientePage;
  let fixture: ComponentFixture<ClientePage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(ClientePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ClientePage } from './cliente.page';

const routes: Routes = [
  {
    path: '',
    component: ClientePage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ClientePageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AdminPage } from './admin.page';

describe('AdminPage', () => {
  let component: AdminPage;
  let fixture: ComponentFixture<AdminPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AdminPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';

import { UsuarioService } from '../../services/usuario.service';
import { AlertController } from '@ionic/angular';

@Component({
  selector: 'app-admin',
  templateUrl: './admin.page.html',
  standalone: false,
  styleUrls: ['./admin.page.scss'],
})
export class AdminPage implements OnInit {

  usuarios:any[] = [];

  constructor(
    private usuarioService: UsuarioService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.cargarUsuarios();
  }

  cargarUsuarios() {
    this.usuarioService.getUsuariosAdmin()
      .subscribe((data:any[]) => this.usuarios = data);
  }

  toggle(usuario:any) {
    this.usuarioService.toggleActivo(usuario.id_usuario)
      .subscribe(() => this.cargarUsuarios());
  }

  async crearUsuario() {

  const alert = await this.alertCtrl.create({
    header: 'Nuevo usuario',
    inputs: [
      { name: 'nombre', placeholder: 'Nombre', type: 'text' },
      { name: 'apellidos', placeholder: 'Apellidos', type: 'text' },
      { name: 'email', placeholder: 'Email', type: 'email' },
      { name: 'password', placeholder: 'Contrase√±a', type: 'password' },
      { name: 'telefono', placeholder: 'Tel√©fono', type: 'text' },
      {
        name: 'rol',
        type: 'radio',
        label: 'Cliente',
        value: 'cliente',
        checked: true
      },
      {
        name: 'rol',
        type: 'radio',
        label: 'Profesor',
        value: 'profesor'
      }
    ],
    buttons: [
      { text: 'Cancelar', role: 'cancel' },
      {
        text: 'Crear',
        handler: (data) => {

          const payload = {
            nombre: data.nombre,
            apellidos: data.apellidos,
            email: data.email,
            password_hash: data.password,
            telefono: data.telefono,
            rol: data.rol
          };

          this.usuarioService.crearUsuarioAdmin(payload)
            .subscribe(() => this.cargarUsuarios());
        }
      }
    ]
  });

  await alert.present();
}

}
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AdminPage } from './admin.page';

const routes: Routes = [
  {
    path: '',
    component: AdminPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AdminPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="dark">
    <ion-title>Panel Admin</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-button expand="block" routerLink="/admin-crear-usuario">
  Crear usuario
  </ion-button >


  <ion-list>


    <ion-item *ngFor="let u of usuarios">

      <ion-label>
        <h2>{{u.nombre}} {{u.apellidos}}</h2>
        <p>{{u.email}}</p>
        <p>Rol: {{u.rol}}</p>
      </ion-label>

      <ion-chip [color]="u.activo ? 'success' : 'danger'">
  <ion-label>
    {{ u.activo ? 'Activo' : 'Desactivado' }}
  </ion-label>
</ion-chip>


      <ion-button
      [disabled]="u.rol === 'admin'"

        slot="end"
        fill="outline"
        (click)="toggle(u)">
        Toggle
      </ion-button>

    </ion-item>

  </ion-list>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AdminPageRoutingModule } from './admin-routing.module';

import { AdminPage } from './admin.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AdminPageRoutingModule
  ],
  declarations: [AdminPage]
})
export class AdminPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mis clases</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-card *ngFor="let h of horarios" class="ion-margin-bottom">

    <ion-card-header>
      <ion-card-title>
        {{ h.Clase.nombre_clase }}
      </ion-card-title>

      <ion-card-subtitle>
        {{ h.fecha }} ¬∑ {{ h.hora_inicio }} - {{ h.hora_fin }}
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>

      <p><strong>Lugar:</strong> {{ h.lugar }}</p>

      <p>
        <strong>Plazas:</strong>
        {{ h.plazas_ocupadas }} / {{ h.plazas_totales }}
      </p>

      <!-- Estado -->
      <ion-chip
        [color]="h.reservas_abiertas ? 'success' : 'danger'">
        <ion-label>
          {{ h.reservas_abiertas ? 'Reservas abiertas' : 'Reservas cerradas' }}
        </ion-label>
      </ion-chip>

      <ion-grid class="ion-margin-top">
        <ion-row>

          <!-- VER ALUMNOS -->
          <ion-col size="6">
            <ion-button
              expand="block"
              fill="outline"
              (click)="verAlumnos(h)">
              Ver alumnos
            </ion-button>
          </ion-col>

          <!-- ABRIR / CERRAR -->
          <ion-col size="6">
            <ion-button
              expand="block"
              [color]="h.reservas_abiertas ? 'warning' : 'success'"
              (click)="cambiarEstado(h)">

              {{ h.reservas_abiertas ? 'Cerrar reservas' : 'Abrir reservas' }}

            </ion-button>
          </ion-col>

        </ion-row>
      </ion-grid>

      <!-- LISTA DE ALUMNOS INLINE -->
      <ion-list *ngIf="h.Reservas?.length">

        <ion-item *ngFor="let r of h.Reservas">

          <ion-label>
            {{ r.Usuario.nombre }}
            {{ r.Usuario.apellidos }}
          </ion-label>

          <ion-button
            color="danger"
            fill="clear"
            (click)="cancelarAlumno(r)">
            Cancelar
          </ion-button>

        </ion-item>

      </ion-list>

    </ion-card-content>
  </ion-card>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AlertController } from '@ionic/angular';
import { HorarioService } from '../../services/horario.service';
import { AuthService } from '../../services/auth.service';
import { ReservaService } from '../../services/reserva.service';
import { ModalController } from '@ionic/angular';
import { AlumnosModalPage } from '../alumnos-modal/alumnos-modal.page';




@Component({
  selector: 'app-profesor',
  templateUrl: './profesor.page.html',
  styleUrls: ['./profesor.page.scss'],
  standalone: false
})
export class ProfesorPage implements OnInit {

  horarios: any[] = [];
  user: any;

  constructor(
    private horarioService: HorarioService,
    private auth: AuthService,
    private reservaService: ReservaService,
    private alertCtrl: AlertController,
    private modalCtrl: ModalController

  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
  }

  cargarHorarios() {
    this.horarioService.getHorariosProfesor(this.user.id_usuario)
      .subscribe({
        next: data => this.horarios = data,
        error: err => console.error(err)
      });
  }

  async cancelarAlumno(reserva: any) {

  const alert = await this.alertCtrl.create({
    header: 'Cancelar reserva',
    message: `¬øCancelar la reserva de ${reserva.Usuario.nombre} ${reserva.Usuario.apellidos}?`,
    buttons: [
      { text: 'No', role: 'cancel' },
      {
        text: 'S√≠',
        handler: () => {
          this.reservaService.forzarCancelacion(reserva.id_reserva)
            .subscribe(() => this.cargarHorarios());
        }
      }
    ]
  });

  await alert.present();
}
async verAlumnos(horario: any) {

  const modal = await this.modalCtrl.create({
    component: AlumnosModalPage,
    componentProps: {
      reservas: horario.Reservas
    }
  });

  await modal.present();

}



  async cambiarEstado(horario: any) {

    const accion = horario.reservas_abiertas ? 'cerrar' : 'abrir';

    const alert = await this.alertCtrl.create({
      header: 'Confirmar',
      message: `¬øDeseas ${accion} las reservas de este horario?`,
      buttons: [
        { text: 'Cancelar', role: 'cancel' },
        {
          text: 'S√≠',
          handler: () => {
            const obs = horario.reservas_abiertas
              ? this.horarioService.cerrarReservas(horario.id_horario)
              : this.horarioService.abrirReservas(horario.id_horario);

            obs.subscribe(() => this.cargarHorarios());
          }
        }
      ]
    });

    await alert.present();
  }
}




------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ProfesorPage } from './profesor.page';

describe('ProfesorPage', () => {
  let component: ProfesorPage;
  let fixture: ComponentFixture<ProfesorPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(ProfesorPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ProfesorPage } from './profesor.page';

const routes: Routes = [
  {
    path: '',
    component: ProfesorPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ProfesorPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { ProfesorPageRoutingModule } from './profesor-routing.module';

import { ProfesorPage } from './profesor.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ProfesorPageRoutingModule
  ],
  declarations: [ProfesorPage]
})
export class ProfesorPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AlumnosModalPageRoutingModule } from './alumnos-modal-routing.module';

import { AlumnosModalPage } from './alumnos-modal.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AlumnosModalPageRoutingModule
  ],
  declarations: [AlumnosModalPage]
})
export class AlumnosModalPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AlumnosModalPage } from './alumnos-modal.page';

const routes: Routes = [
  {
    path: '',
    component: AlumnosModalPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AlumnosModalPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Alumnos inscritos</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="cerrar()">Cerrar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="reservas.length; else vacio">

    <ion-item *ngFor="let r of reservas">

      <ion-label>
        <h2>
          {{ r.Usuario.nombre }}
          {{ r.Usuario.apellidos }}
        </h2>
      </ion-label>

      <ion-button
        color="danger"
        fill="outline"
        (click)="cancelar(r)">
        Cancelar
      </ion-button>

    </ion-item>

  </ion-list>

  <ng-template #vacio>
    <ion-text color="medium">
      No hay alumnos inscritos.
    </ion-text>
  </ng-template>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AlumnosModalPage } from './alumnos-modal.page';

describe('AlumnosModalPage', () => {
  let component: AlumnosModalPage;
  let fixture: ComponentFixture<AlumnosModalPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AlumnosModalPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.ts
------------------------------------------------------------------------------
import { Component, Input } from '@angular/core';
import { ModalController } from '@ionic/angular';
import { ReservaService } from '../../services/reserva.service';

@Component({
  selector: 'app-alumnos-modal',
  templateUrl: './alumnos-modal.page.html',
  styleUrls: ['./alumnos-modal.page.scss'],
  standalone:false
})
export class AlumnosModalPage {

  @Input() reservas: any[] = [];

  constructor(
    private modalCtrl: ModalController,
    private reservaService: ReservaService
  ) {}

  cerrar() {
    this.modalCtrl.dismiss();
  }

  cancelar(reserva: any) {
    this.reservaService
      .forzarCancelacion(reserva.id_reserva)
      .subscribe(() => {

        // eliminar de la lista visualmente
        this.reservas = this.reservas.filter(
          r => r.id_reserva !== reserva.id_reserva
        );

      });
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AdminCrearUsuarioPageRoutingModule } from './admin-crear-usuario-routing.module';

import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AdminCrearUsuarioPageRoutingModule
  ],
  declarations: [AdminCrearUsuarioPage]
})
export class AdminCrearUsuarioPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

describe('AdminCrearUsuarioPage', () => {
  let component: AdminCrearUsuarioPage;
  let fixture: ComponentFixture<AdminCrearUsuarioPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AdminCrearUsuarioPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';
import { UsuarioService } from '../../services/usuario.service';
import { AlertController } from '@ionic/angular';
import { Router } from '@angular/router';

@Component({
  selector: 'app-admin-crear-usuario',
  templateUrl: './admin-crear-usuario.page.html',
  styleUrls: ['./admin-crear-usuario.page.scss'],
  standalone:false
})
export class AdminCrearUsuarioPage {

  usuario: any = {
    rol: 'cliente'
  };

  constructor(
    private usuarioService: UsuarioService,
    private alertCtrl: AlertController,
    private router: Router
  ) {}

  async crearUsuario() {

    if (!this.usuario.nombre || !this.usuario.email || !this.usuario.password_hash) {
      return this.mostrarAlert('Faltan campos obligatorios');
    }

    this.usuarioService.crearUsuario(this.usuario)
      .subscribe({
        next: async () => {

          const alert = await this.alertCtrl.create({
            header: '√âxito',
            message: 'Usuario creado correctamente',
            buttons: ['OK']
          });

          await alert.present();

          this.router.navigate(['/admin']);
        },
        error: err => {
          this.mostrarAlert(err.error?.error || 'Error creando usuario');
        }
      });
  }

  async mostrarAlert(msg:string){
    const alert = await this.alertCtrl.create({
      header:'Error',
      message:msg,
      buttons:['OK']
    });

    await alert.present();
  }

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Crear usuario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-item>
    <ion-input label="Nombre" [(ngModel)]="usuario.nombre"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Apellidos" [(ngModel)]="usuario.apellidos"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Email" [(ngModel)]="usuario.email"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input 
      label="Contrase√±a"
      type="password"
      [(ngModel)]="usuario.password_hash">
    </ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Tel√©fono" [(ngModel)]="usuario.telefono"></ion-input>
  </ion-item>

  <ion-item>
    <ion-select label="Rol" [(ngModel)]="usuario.rol">
      <ion-select-option value="cliente">Cliente</ion-select-option>
      <ion-select-option value="profesor">Profesor</ion-select-option>
      <ion-select-option value="admin">Admin</ion-select-option>
    </ion-select>
  </ion-item>

  <ion-button expand="block" (click)="crearUsuario()">
    Crear usuario
  </ion-button>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

const routes: Routes = [
  {
    path: '',
    component: AdminCrearUsuarioPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AdminCrearUsuarioPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/guards/auth-guard.spec.ts
------------------------------------------------------------------------------
import { TestBed } from '@angular/core/testing';
import { CanActivateFn } from '@angular/router';

import { authGuard } from './auth-guard';

describe('authGuard', () => {
  const executeGuard: CanActivateFn = (...guardParameters) => 
      TestBed.runInInjectionContext(() => authGuard(...guardParameters));

  beforeEach(() => {
    TestBed.configureTestingModule({});
  });

  it('should be created', () => {
    expect(executeGuard).toBeTruthy();
  });
});
d
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/guards/auth-guard.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { CanActivate, ActivatedRouteSnapshot, Router } from '@angular/router';
import { AuthService } from '../services/auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  canActivate(route: ActivatedRouteSnapshot): boolean {

    const user = this.auth.getUser();

    if (!user) {
      this.router.navigate(['/login']);
      return false;
    }

    const allowedRoles = route.data['roles'] as string[];

    if (allowedRoles && !allowedRoles.includes(user.rol)) {
      // Redirigir a su panel correcto
      this.router.navigate(['/' + user.rol]);
      return false;
    }

    return true;
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/test.ts
------------------------------------------------------------------------------
// This file is required by karma.conf.js and loads recursively all the .spec and framework files

import 'zone.js/testing';
import { getTestBed } from '@angular/core/testing';
import {
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting
} from '@angular/platform-browser-dynamic/testing';

// First, initialize the Angular testing environment.
getTestBed().initTestEnvironment(
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting(),
);

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.gitignore
------------------------------------------------------------------------------
# Specifies intentionally untracked files to ignore when using Git
# http://git-scm.com/docs/gitignore

*~
*.sw[mnpcod]
.tmp
*.tmp
*.tmp.*
UserInterfaceState.xcuserstate
$RECYCLE.BIN/

*.log
log.txt


/.sourcemaps
/.versions
/coverage

# Ionic
/.ionic
/www
/platforms
/plugins

# Compiled output
/dist
/tmp
/out-tsc
/bazel-out

# Node
/node_modules
npm-debug.log
yarn-error.log

# IDEs and editors
.idea/
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-project
*.sublime-workspace

# Visual Studio Code
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
.history/*


# Miscellaneous
/.angular
/.angular/cache
.sass-cache/
/.nx
/.nx/cache
/connect.lock
/coverage
/libpeerconnection.log
testem.log
/typings

# System files
.DS_Store
Thumbs.db

node_modules/
.env
android/
ios/
dist/
build/


------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.editorconfig
------------------------------------------------------------------------------
# Editor configuration, see https://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
insert_final_newline = true
trim_trailing_whitespace = true

[*.ts]
quote_type = single

[*.md]
max_line_length = off
trim_trailing_whitespace = false

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/package.json
------------------------------------------------------------------------------
{
  "name": "app-ionic",
  "version": "0.0.1",
  "author": "Ionic Framework",
  "homepage": "https://ionicframework.com/",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "watch": "ng build --watch --configuration development",
    "test": "ng test",
    "lint": "ng lint"
  },
  "private": true,
  "dependencies": {
    "@angular/animations": "^20.0.0",
    "@angular/common": "^20.0.0",
    "@angular/compiler": "^20.0.0",
    "@angular/core": "^20.0.0",
    "@angular/forms": "^20.0.0",
    "@angular/platform-browser": "^20.0.0",
    "@angular/platform-browser-dynamic": "^20.0.0",
    "@angular/router": "^20.0.0",
    "@capacitor/app": "8.0.0",
    "@capacitor/core": "8.0.1",
    "@capacitor/haptics": "8.0.0",
    "@capacitor/keyboard": "8.0.0",
    "@capacitor/status-bar": "8.0.0",
    "@ionic/angular": "^8.0.0",
    "ionicons": "^7.0.0",
    "rxjs": "~7.8.0",
    "tslib": "^2.3.0",
    "zone.js": "~0.15.0"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "^20.0.0",
    "@angular-eslint/builder": "^20.0.0",
    "@angular-eslint/eslint-plugin": "^20.0.0",
    "@angular-eslint/eslint-plugin-template": "^20.0.0",
    "@angular-eslint/schematics": "^20.0.0",
    "@angular-eslint/template-parser": "^20.0.0",
    "@angular/cli": "^20.0.0",
    "@angular/compiler-cli": "^20.0.0",
    "@angular/language-service": "^20.0.0",
    "@capacitor/cli": "8.0.1",
    "@ionic/angular-toolkit": "^12.0.0",
    "@types/jasmine": "~5.1.0",
    "@typescript-eslint/eslint-plugin": "^8.18.0",
    "@typescript-eslint/parser": "^8.18.0",
    "eslint": "^9.16.0",
    "eslint-plugin-import": "^2.29.1",
    "eslint-plugin-jsdoc": "^48.2.1",
    "eslint-plugin-prefer-arrow": "1.2.2",
    "jasmine-core": "~5.1.0",
    "jasmine-spec-reporter": "~5.0.0",
    "karma": "~6.4.0",
    "karma-chrome-launcher": "~3.2.0",
    "karma-coverage": "~2.2.0",
    "karma-jasmine": "~5.1.0",
    "karma-jasmine-html-reporter": "~2.1.0",
    "typescript": "~5.9.0"
  },
  "description": "An Ionic project"
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.spec.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/spec",
    "types": [
      "jasmine"
    ]
  },
  "files": [
    "src/test.ts",
    "src/polyfills.ts"
  ],
  "include": [
    "src/**/*.spec.ts",
    "src/**/*.d.ts"
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/capacitor.config.json
------------------------------------------------------------------------------
{}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.eslintrc.json
------------------------------------------------------------------------------
{
  "root": true,
  "ignorePatterns": ["projects/**/*"],
  "overrides": [
    {
      "files": ["*.ts"],
      "parserOptions": {
        "project": ["tsconfig.json"],
        "createDefaultProgram": true
      },
      "extends": [
        "plugin:@angular-eslint/recommended",
        "plugin:@angular-eslint/template/process-inline-templates"
      ],
      "rules": {
        "@angular-eslint/prefer-standalone": "off",
        "@angular-eslint/component-class-suffix": [
          "error",
          {
            "suffixes": ["Page", "Component"]
          }
        ],
        "@angular-eslint/component-selector": [
          "error",
          {
            "type": "element",
            "prefix": "app",
            "style": "kebab-case"
          }
        ],
        "@angular-eslint/directive-selector": [
          "error",
          {
            "type": "attribute",
            "prefix": "app",
            "style": "camelCase"
          }
        ]
      }
    },
    {
      "files": ["*.html"],
      "extends": ["plugin:@angular-eslint/template/recommended"],
      "rules": {}
    }
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.browserslistrc
------------------------------------------------------------------------------
# This file is used by the build system to adjust CSS and JS output to support the specified browsers below.
# For additional information regarding the format and rule options, please see:
# https://github.com/browserslist/browserslist#queries

# For the full list of supported browsers by the Angular framework, please see:
# https://angular.dev/reference/versions#browser-support

# You can see what browsers were selected by your queries by running:
#   npx browserslist

Chrome >=107
Firefox >=106
Edge >=107
Safari >=16.1
iOS >=16.1

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/ionic.config.json
------------------------------------------------------------------------------
{
  "name": "app-ionic",
  "integrations": {
    "capacitor": {}
  },
  "type": "angular"
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.app.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/app",
    "types": []
  },
  "files": [
    "src/main.ts",
    "src/polyfills.ts"
  ],
  "include": [
    "src/**/*.d.ts"
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/capacitor.config.ts
------------------------------------------------------------------------------
import type { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'io.ionic.starter',
  appName: 'app-ionic',
  webDir: 'www'
};

export default config;

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "compileOnSave": false,
  "compilerOptions": {
    "baseUrl": "./",
    "outDir": "./dist/out-tsc",
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "sourceMap": true,
    "declaration": false,
    "downlevelIteration": true,
    "experimentalDecorators": true,
    "moduleResolution": "node",
    "importHelpers": true,
    "target": "es2022",
    "module": "es2020",
    "lib": [
      "es2018",
      "dom"
    ],
    "skipLibCheck": true,
    "useDefineForClassFields": false
  },
  "angularCompilerOptions": {
    "enableI18nLegacyMessageIdFormat": false,
    "strictInjectionParameters": true,
    "strictInputAccessModifiers": true,
    "strictTemplates": true
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.vscode/extensions.json
------------------------------------------------------------------------------
{
    "recommendations": [
       "Webnative.webnative"
    ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.vscode/settings.json
------------------------------------------------------------------------------
{
  "typescript.preferences.autoImportFileExcludePatterns": ["@ionic/angular/common", "@ionic/angular/standalone"]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/angular.json
------------------------------------------------------------------------------
{
  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
  "version": 1,
  "newProjectRoot": "projects",
  "projects": {
    "app": {
      "projectType": "application",
      "schematics": {},
      "root": "",
      "sourceRoot": "src",
      "prefix": "app",
      "architect": {
        "build": {
          "builder": "@angular-devkit/build-angular:browser",
          "options": {
            "outputPath": "www",
            "index": "src/index.html",
            "main": "src/main.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "tsconfig.app.json",
            "inlineStyleLanguage": "scss",
            "assets": [
              {
                "glob": "**/*",
                "input": "src/assets",
                "output": "assets"
              },
              {
                "glob": "**/*.svg",
                "input": "node_modules/ionicons/dist/ionicons/svg",
                "output": "./svg"
              }
            ],
            "styles": ["src/global.scss", "src/theme/variables.scss"],
            "scripts": []
          },
          "configurations": {
            "production": {
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "2mb",
                  "maximumError": "5mb"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "2kb",
                  "maximumError": "4kb"
                }
              ],
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.prod.ts"
                }
              ],
              "outputHashing": "all"
            },
            "development": {
              "buildOptimizer": false,
              "optimization": false,
              "vendorChunk": true,
              "extractLicenses": false,
              "sourceMap": true,
              "namedChunks": true
            },
            "ci": {
              "progress": false
            }
          },
          "defaultConfiguration": "production"
        },
        "serve": {
          "builder": "@angular-devkit/build-angular:dev-server",
          "configurations": {
            "production": {
              "buildTarget": "app:build:production"
            },
            "development": {
              "buildTarget": "app:build:development"
            },
            "ci": {
              "progress": false
            }
          },
          "defaultConfiguration": "development"
        },
        "extract-i18n": {
          "builder": "@angular-devkit/build-angular:extract-i18n",
          "options": {
            "buildTarget": "app:build"
          }
        },
        "test": {
          "builder": "@angular-devkit/build-angular:karma",
          "options": {
            "main": "src/test.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "tsconfig.spec.json",
            "karmaConfig": "karma.conf.js",
            "inlineStyleLanguage": "scss",
            "assets": [
              {
                "glob": "**/*",
                "input": "src/assets",
                "output": "assets"
              },
              {
                "glob": "**/*.svg",
                "input": "node_modules/ionicons/dist/ionicons/svg",
                "output": "./svg"
              }
            ],
            "styles": ["src/global.scss", "src/theme/variables.scss"],
            "scripts": []
          },
          "configurations": {
            "ci": {
              "progress": false,
              "watch": false
            }
          }
        },
        "lint": {
          "builder": "@angular-eslint/builder:lint",
          "options": {
            "lintFilePatterns": [
              "src/**/*.ts",
              "src/**/*.html"
            ]
          }
        }
      }
    }
  },
  "cli": {
    "schematicCollections": [
      "@ionic/angular-toolkit"
    ],
    "analytics": false
  },
  "schematics": {
    "@ionic/angular-toolkit:component": {
      "styleext": "scss"
    },
    "@ionic/angular-toolkit:page": {
      "styleext": "scss"
    }
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/Dockerfile
------------------------------------------------------------------------------
FROM node:20
WORKDIR /app
COPY package*.json ./
# Instalamos CLI de forma global y dependencias locales
RUN npm install -g @ionic/cli && npm install
COPY . .
EXPOSE 8100
# --poll ayuda a que detecte cambios en vol√∫menes de Ubuntu/Docker
CMD ["ionic", "serve", "--host=0.0.0.0", "--port=8100", "--disable-host-check"]
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/karma.conf.js
------------------------------------------------------------------------------
// Karma configuration file, see link for more information
// https://karma-runner.github.io/1.0/config/configuration-file.html

module.exports = function (config) {
  config.set({
    basePath: '',
    frameworks: ['jasmine', '@angular-devkit/build-angular'],
    plugins: [
      require('karma-jasmine'),
      require('karma-chrome-launcher'),
      require('karma-jasmine-html-reporter'),
      require('karma-coverage'),
      require('@angular-devkit/build-angular/plugins/karma')
    ],
    client: {
      jasmine: {
        // you can add configuration options for Jasmine here
        // the possible options are listed at https://jasmine.github.io/api/edge/Configuration.html
        // for example, you can disable the random execution with `random: false`
        // or set a specific seed with `seed: 4321`
      },
      clearContext: false // leave Jasmine Spec Runner output visible in browser
    },
    jasmineHtmlReporter: {
      suppressAll: true // removes the duplicated traces
    },
    coverageReporter: {
      dir: require('path').join(__dirname, './coverage/app'),
      subdir: '.',
      reporters: [
        { type: 'html' },
        { type: 'text-summary' }
      ]
    },
    reporters: ['progress', 'kjhtml'],
    port: 9876,
    colors: true,
    logLevel: config.LOG_INFO,
    autoWatch: true,
    browsers: ['Chrome'],
    singleRun: false,
    restartOnFileChange: true
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./subirGithub.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo " üöÄ GESTOR DE GITHUB - COSMOS"
echo "=============================="

# ==============================
# Selecci√≥n de usuario
# ==============================

echo "üë§ ¬øQui√©n est√° realizando los cambios?"
echo " [ 1 ] - Domingo"
echo " [ 2 ] - D√°maris"
echo " [ 0 ] - Salir"
echo "------------------------------"
read -p "Selecciona una opci√≥n: " USER_OPTION

case $USER_OPTION in
    1)
        USER_NAME="Domingo"
        USER_EMAIL="domingojosenavarroorihuela@alumno.ieselrincon.es"
        ;;
    2)
        USER_NAME="D√°maris"
        USER_EMAIL="damarisvidalrodriguez@alumno.ieselrincon.es"
        ;;
    0)
        echo "üëã Saliendo."
        exit 0
        ;;
    *)
        echo "‚ùå Opci√≥n no v√°lida."
        exit 1
        ;;
esac

git config user.name "$USER_NAME"
git config user.email "$USER_EMAIL"

echo "‚úÖ Identidad configurada como: $USER_NAME"
echo ""

# ==============================
# Verificar repo
# ==============================

if [ ! -d ".git" ]; then
  echo "‚ùå Este directorio no es un repositorio git"
  exit 1
fi

# ==============================
# Men√∫ principal
# ==============================

echo "üìå ¬øQu√© deseas hacer?"
echo " [ 1 ] Subir cambios a DEVELOP"
echo " [ 2 ] Migrar DEVELOP ‚Üí MAIN"
echo " [ 0 ] Salir"
echo "------------------------------"
read -p "Selecciona una opci√≥n: " OPCION

# ==============================
# OPCI√ìN 1 ‚Üí DEVELOP
# ==============================

if [ "$OPCION" == "1" ]; then

    echo "üåø Cambiando a rama develop..."

    # Crear develop si no existe
    git checkout develop 2>/dev/null || git checkout -b develop

    echo "üìã Estado actual:"
    git status -s

    echo "‚ûï A√±adiendo archivos..."
    git add .

    read -p "‚úèÔ∏è  Mensaje del commit: " MENSAJE

    if [ -z "$MENSAJE" ]; then
      MENSAJE="Actualizaci√≥n en develop por $USER_NAME"
    fi

    git commit -m "$MENSAJE"

    echo "‚¨ÜÔ∏è Subiendo a develop..."
    git push -u origin develop

    echo ""
    echo "‚úÖ Cambios subidos a DEVELOP"
    echo "======================================"
fi


# ==============================
# OPCI√ìN 2 ‚Üí MERGE A MAIN
# ==============================

if [ "$OPCION" == "2" ]; then

    echo "‚ö†Ô∏è Vas a migrar DEVELOP ‚Üí MAIN"
    read -p "¬øEst√°s seguro? (yes/no): " CONFIRMACION

    if [ "$CONFIRMACION" != "yes" ]; then
        echo "Cancelado."
        exit 0
    fi

    echo "üåø Cambiando a main..."
    git checkout main

    echo "üîÑ Haciendo merge de develop..."
    git merge develop

    echo "‚¨ÜÔ∏è Subiendo main..."
    git push origin main

    echo ""
    echo "üöÄ DEVELOP MIGRADO A MAIN"
    echo "======================================"
fi


------------------------------------------------------------------------------

[ARCHIVO]: ./peticiones/test_api.sh
------------------------------------------------------------------------------
#!/bin/bash

API="http://localhost:3000"

echo "====================================="
echo "      üß™ TEST AUTOM√ÅTICO COSMOS"
echo "====================================="


##################################
echo ""
echo "1Ô∏è‚É£ Comprobando API..."
##################################

curl -s $API | jq .

if [ $? -ne 0 ]; then
  echo "‚ùå API no responde"
  exit 1
fi

echo "‚úÖ API OK"



##################################
echo ""
echo "2Ô∏è‚É£ Login ADMIN"
##################################

curl -s -X POST $API/login \
-H "Content-Type: application/json" \
-d '{"email":"admin@mail.com","password":"admin"}' | jq .

echo "‚úÖ Login admin OK"



##################################
echo ""
echo "3Ô∏è‚É£ Obtener bonos"
##################################

curl -s $API/bonos | jq .

echo "‚úÖ Bonos cargan"



##################################
echo ""
echo "4Ô∏è‚É£ Crear pago cliente 10"
##################################

curl -s -X POST $API/pagos \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_bono":2,
"metodo_pago":"tarjeta"
}' | jq .

echo "‚úÖ Pago creado"



##################################
echo ""
echo "5Ô∏è‚É£ Ver bono activo"
##################################

curl -s $API/pagos/cliente/10/activo | jq .

echo "‚úÖ Bono activo detectado"



##################################
echo ""
echo "6Ô∏è‚É£ Intentar reservar SIN bono (cliente 14)"
##################################

curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":14,
"id_horario":1
}' | jq .

echo "üëâ Debe devolver error 403"



##################################
echo ""
echo "7Ô∏è‚É£ Crear reserva v√°lida (cliente 10)"
##################################

RESERVA=$(curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_horario":1
}')

echo $RESERVA | jq .

RESERVA_ID=$(echo $RESERVA | jq -r '.id_reserva')

echo "Reserva ID: $RESERVA_ID"



##################################
echo ""
echo "8Ô∏è‚É£ Ver sesiones restantes"
##################################

curl -s $API/pagos/cliente/10 | jq .

echo "üëâ Debe ser 9"



##################################
echo ""
echo "9Ô∏è‚É£ Probar duplicado"
##################################

curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_horario":1
}' | jq .

echo "üëâ Debe decir 'Ya tienes una reserva activa'"



##################################
echo ""
echo "üîü Cancelar reserva"
##################################

curl -s -X PATCH $API/reservas/$RESERVA_ID/cancelar | jq .

echo "‚úÖ Reserva cancelada"



##################################
echo ""
echo "11Ô∏è‚É£ Ver reservas cliente"
##################################

curl -s $API/reservas/cliente/10 | jq .



echo ""
echo "====================================="
echo "       ‚úÖ TEST COMPLETADO"
echo "====================================="

------------------------------------------------------------------------------

[ARCHIVO]: ./lectura.sh
------------------------------------------------------------------------------
#!/bin/bash

# ==============================================================================
# SCRIPT DE INSPECCI√ìN ESENCIAL
# OBJETIVO: Mostrar solo c√≥digo fuente y archivos de configuraci√≥n clave.
# ==============================================================================

ROOT_DIR=${1:-"."}

# Validar existencia del directorio
[ ! -d "$ROOT_DIR" ] && echo "Error: Directorio no encontrado." && exit 1

echo "=============================================================================="
echo "RESUMEN EJECUTIVO DE C√ìDIGO FUENTE"
echo "=============================================================================="

# B√∫squeda selectiva:
# 1. Excluye node_modules, .git, y assets de imagen.
# 2. Excluye archivos de bloqueo (lock) y temporales.
find "$ROOT_DIR" \( -name "node_modules" -o -name ".git" -o -name "assets" -o -name ".angular" \) -prune -o \
    -type f \
    ! -name "package-lock.json" \
    ! -name "*.png" \
    ! -name "*.svg" \
    ! -name "*.ico" \
    ! -name "*.jpg" \
    -print | while read -r archivo; do

    echo -e "\n[ARCHIVO]: $archivo"
    echo "------------------------------------------------------------------------------"
    
    # Mostrar contenido
    cat "$archivo"
    
    echo -e "\n------------------------------------------------------------------------------"
done

echo "=============================================================================="
echo "INSPECCI√ìN FINALIZADA"
echo "=============================================================================="

------------------------------------------------------------------------------

[ARCHIVO]: ./docker-compose.yml
------------------------------------------------------------------------------
services:
  postgres:
    image: postgres:16
    container_name: postgres-db
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
      - "${POSTGRES_PORT}:5432"
    volumes:
    - postgres_data:/var/lib/postgresql/data
    - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 5s
      timeout: 5s
      retries: 10

  api:
    build: ./api
    container_name: api-node
    ports:
      - "${API_PORT}:3000"
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      DB_HOST: postgres
      DB_USER: ${POSTGRES_USER}
      DB_PASS: ${POSTGRES_PASSWORD}
      DB_NAME: ${POSTGRES_DB}
    volumes:
      - ./api:/app
      - /app/node_modules

  ionic:
    build: ./ionic/app-ionic
    container_name: ionic-app
    ports:
      - "${IONIC_PORT}:8100"
    depends_on:
      - api
    volumes:
      - ./ionic/app-ionic:/app
      - /app/node_modules

volumes:
  postgres_data:

------------------------------------------------------------------------------

[ARCHIVO]: ./db/init.sql
------------------------------------------------------------------------------

CREATE TABLE Usuario (
id_usuario SERIAL PRIMARY KEY,
nombre VARCHAR(100) NOT NULL,
apellidos VARCHAR(100) NOT NULL,
email VARCHAR(100) UNIQUE NOT NULL,
password_hash VARCHAR(255) NOT NULL,
telefono VARCHAR(20),
rol VARCHAR(20) NOT NULL,
fecha_registro DATE DEFAULT CURRENT_DATE
);
CREATE TABLE Bono_Plan (
id_bono SERIAL PRIMARY KEY,
nombre_bono VARCHAR(100) UNIQUE NOT NULL,
precio NUMERIC(10,2) NOT NULL,
duracion_dias INTEGER,
num_sesiones INTEGER,
descripcion TEXT
);
CREATE TABLE Pago (
id_pago SERIAL PRIMARY KEY,
id_cliente INTEGER NOT NULL,
id_bono INTEGER NOT NULL,
fecha_pago TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
monto NUMERIC(10,2) NOT NULL,
metodo_pago VARCHAR(50),
fecha_vencimiento DATE,
CONSTRAINT fk_pago_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_pago_bono FOREIGN KEY (id_bono)
REFERENCES Bono_Plan(id_bono)
);
CREATE TABLE Clase (
id_clase SERIAL PRIMARY KEY,
nombre_clase VARCHAR(100) NOT NULL,
descripcion TEXT,
capacidad_maxima INTEGER NOT NULL,
contenido_profesor TEXT,
id_profesor INTEGER NOT NULL,
CONSTRAINT fk_clase_profesor FOREIGN KEY (id_profesor)
REFERENCES Usuario(id_usuario)
);
CREATE TABLE Horario (
id_horario SERIAL PRIMARY KEY,
id_clase INTEGER NOT NULL,
fecha DATE NOT NULL,
hora_inicio TIME NOT NULL,
hora_fin TIME NOT NULL,
reservas_abiertas BOOLEAN DEFAULT true, -- üëà A√ëADE
lugar VARCHAR(100),
CONSTRAINT fk_horario_clase FOREIGN KEY (id_clase)
REFERENCES Clase(id_clase)
);


CREATE TABLE Reserva (
id_reserva SERIAL PRIMARY KEY,
id_cliente INTEGER NOT NULL,
id_horario INTEGER NOT NULL,
fecha_reserva TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
estado VARCHAR(20) NOT NULL,
CONSTRAINT fk_reserva_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_reserva_horario FOREIGN KEY (id_horario)
REFERENCES Horario(id_horario)
);
CREATE TABLE Rutina (
id_rutina SERIAL PRIMARY KEY,
nombre_rutina VARCHAR(100) NOT NULL,
descripcion TEXT,
fecha_asignacion DATE DEFAULT CURRENT_DATE,
id_cliente INTEGER NOT NULL,
id_profesor INTEGER NOT NULL,
CONSTRAINT fk_rutina_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_rutina_profesor FOREIGN KEY (id_profesor)
REFERENCES Usuario(id_usuario)
);
------------------------------------------------------------------------------

[ARCHIVO]: ./texto.txt
------------------------------------------------------------------------------
prueba.
prueba2
------------------------------------------------------------------------------

[ARCHIVO]: ./.lectura.sh.swp
------------------------------------------------------------------------------
b0VIM 9.1      µ¥áiá1K " dno                                     dno-X570-Phantom-Gaming-4S              ~dno/ProyectoCosmos/lectura.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               utf-8U3210    #"! U                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 tp           `                            A       b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ad     ≥     `       £  ê  x  `  C  :  '    	    ›  √  i  Û  ‡  »  ∞  í  â  v  ^  V  O  ,    º  F  .      ˚  Ù  œ  µ  [  Â
  Œ
  «
  ´
  ë
  I
  ”	  ¿	  ®	  ô	  q	  i	  b	  D	  *	  ﬁ  h  P  8    ı  ÷  Õ  ∫  °  ô  í  r  X    í    h  a  @  %  “  \  E  >       ©  3      ¯  ﬁ  î      Û  ⁄  “  À  ∞  ñ  P  ⁄  ¬  ≥  ≤                               "bin": {       "license": "MIT",       "integrity": "sha512-+NYs2QeMWy+GWFOEm9xnn6HCDp0l7QBD7ml8zLUmJ+93Q5NF0NocErnwkTkXVFNiX3/fpC6afS8Dhb/gz7R7eg==",       "resolved": "https://registry.npmjs.org/uuid/-/uuid-8.3.2.tgz",       "version": "8.3.2",     "node_modules/uuid": {     },       }         "node": ">= 0.8"       "engines": {       "license": "MIT",       "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",       "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",       "version": "1.0.0",     "node_modules/unpipe": {     },       "license": "MIT"       "integrity": "sha512-Zz+aZWSj8LE6zoxD+xrjh4VfkIG8Ya6LvYkZqtUQGJPZjYl53ypCaUwWqo7eI0x66KBGeRo+mlBEkMSeSZ38Nw==",       "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-7.16.0.tgz",       "version": "7.16.0",     "node_modules/undici-types": {     },       "license": "MIT"       "integrity": "sha512-GMXzWtsc57XAtguZgaQViUOzs0KTkk8ojr3/xAxXLITqf/3EMwxC0inyETfDFjH/Krbhuep0HNbbjI9i/q3F3g==",       "resolved": "https://registry.npmjs.org/underscore/-/underscore-1.13.7.tgz",       "version": "1.13.7",     "node_modules/underscore": {     },       "license": "MIT"       "dev": true,       "integrity": "sha512-WxONCrssBM8TSPRqN5EmsjVrsv4A8X12J4ArBiiayv3DyyG3ZlIg6yysuuSYdZsVz3TKcTg2fd//Ujd4CHV1iA==",       "resolved": "https://registry.npmjs.org/undefsafe/-/undefsafe-2.0.5.tgz",       "version": "2.0.5",     "node_modules/undefsafe": {     },       }         "node": ">= 0.6"       "engines": {       },         "mime-types": "^3.0.0"         "media-typer": "^1.1.0",         "content-type": "^1.0.5",       "dependencies": {       "license": "MIT",       "integrity": "sha512-OZs6gsjF4vMp32qrCbiVSkrFmXtG/AZhY3t0iAMrMBiAZyV9oALtXO8hsrHbMXF9x6L3grlFuwW2oAz7cav+Gw==",       "resolved": "https://registry.npmjs.org/type-is/-/type-is-2.0.1.tgz",       "version": "2.0.1",     "node_modules/type-is": {     },       }         "nodetouch": "bin/nodetouch.js"       "bin": {       "license": "ISC",       "dev": true,       "integrity": "sha512-r0eojU4bI8MnHr8c5bNo7lJDdI2qXlWWJk6a9EAFG7vbhTjElYhBVS3/miuE0uOuoLdb8Mc/rVfsmm6eo5o9GA==",       "resolved": "https://registry.npmjs.org/touch/-/touch-3.1.1.tgz",       "version": "3.1.1",     "node_modules/touch": {     },       "license": "MIT"       "integrity": "sha512-OsLcGGbYF3rMjPUf8oKktyvCiUxSbqMMS39m33MAjLTC1DVIH6x3WSt63/M77ihI09+Sdfk1AXvfhCEeUmC7mg==",       "resolved": "https://registry.npmjs.org/toposort-class/-/toposort-class-1.0.1.tgz",       "version": "1.0.1",     "node_modules/toposort-class": {     },       }         "node": ">=0.6"       "engines": {       "license": "MIT",       "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",       "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",       "version": "1.0.1",     "node_modules/toidentifier": {     },       }         "node": ">=8.0"       "engines": {       },         "is-number": "^7.0.0"       "dependencies": {       "license": "MIT",       "dev": true,       "integrity": "sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==",       "resolved": "https://registry.npmjs.org/to-regex-range/-/to-regex-range-5.0.1.tgz",       "version": "5.0.1",     "node_modules/to-regex-range": {     },       }         "node": ">=4"       "engines": {       },         "has-flag": "^3.0.0"       "dependencies": {       "license": "MIT",       "dev": true, 2-QjVjwdXIt408MIiAqCX4oUKsgU2EqAGzs2Ppkm4aQYbjm+ZEWEcW4SfFNTr4uMNZma0ey4f5lgLrkB0aX0QMow==", ad  ‰  –     5       ‡  ÿ  —  ±  î  A  À  ≥  †  Ü  ~  w  \  B  ¸  Ü  n  [  B  :  3    ˇ  ª  E  -    ˙  Ú  Î  Œ  ¥  j  Ù
  ›
  ÷
  ∫
  †
  X
  ‚	   	  ∑	  ü	  ó	  ë	  ç	  ã	  ä	  â	  :	   	  —  –                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ------------------------------------------------------------------------------ ARCHIVO: ./api/Dockerfile ------------------------------------------------------------------------------   }   }     }       }         "node": ">=0.4"       "engines": {       "license": "MIT",       "integrity": "sha512-LKYU1iAXJXUgAXn9URjiu+MWhyUXHsvfp7mcuYm9dSUKK0/CjtrUwFAxD82/mCWbtLsGjFIad0wIsod4zrTAEQ==",       "resolved": "https://registry.npmjs.org/xtend/-/xtend-4.0.2.tgz",       "version": "4.0.2",     "node_modules/xtend": {     },       "license": "ISC"       "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==",       "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",       "version": "1.0.2",     "node_modules/wrappy": {     },       }         "@types/node": "*"       "dependencies": {       "license": "MIT",       "integrity": "sha512-Xng/d4Ichh8uN4l0FToV/258EjMGU9MGcA0HV2d9B/ZpZB3lqQm7nkOdZdm5GhKtLLhAE7PiVQwN4eN+2YJJUg==",       "resolved": "https://registry.npmjs.org/wkx/-/wkx-0.5.0.tgz",       "version": "0.5.0",     "node_modules/wkx": {     },       }         "node": ">= 0.8"       "engines": {       "license": "MIT",       "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",       "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",       "version": "1.1.2",     "node_modules/vary": {     },       }         "node": ">= 0.10"       "engines": {       "license": "MIT",       "integrity": "sha512-spH26xU080ydGggxRyR1Yhcbgx+j3y5jbNXk/8L+iRvdIEQ4uTRH2Sgf2dokud6Q4oAtsbNvJ1Ft+9xmm6IZcA==",       "resolved": "https://registry.npmjs.org/validator/-/validator-13.15.26.tgz",       "version": "13.15.26",     "node_modules/validator": {     },       }         "uuid": "dist/bin/uuid" 
------------------------------------------------------------------------------

[ARCHIVO]: ./.env
------------------------------------------------------------------------------
# Postgres
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin123
POSTGRES_DB=cosmos_db
POSTGRES_PORT=5432

# Backend
API_PORT=3000

# Frontend
IONIC_PORT=8100


------------------------------------------------------------------------------

[ARCHIVO]: ./win_start.ps1
------------------------------------------------------------------------------
Write-Host "=============================="
Write-Host "  INICIANDO COSMOS FITNESS"
Write-Host "=============================="

docker compose build
docker compose up -d

Write-Host "API: http://localhost:3000"
Write-Host "FRONTEND: http://localhost:8100"

------------------------------------------------------------------------------

[ARCHIVO]: ./start.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  INICIANDO COSMOS FITNESS"
echo "=============================="

if ! command -v docker &> /dev/null
then
    echo "‚ùå Docker no est√° instalado"
    exit 1
fi

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "‚û° Usando: $COMPOSE"

echo "üöÄ Levantando servicios SIN rebuild..."
$COMPOSE up -d

echo "=============================="
echo " COSMOS FITNESS EN MARCHA"
echo " API:      http://localhost:3000"
echo " FRONTEND: http://localhost:8100"
echo "=============================="


------------------------------------------------------------------------------

[ARCHIVO]: ./lectura.txt
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./api/.dockerignore
------------------------------------------------------------------------------
node_modules
npm-debug.log
Dockerfile
.git
.gitignore

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/middleware/bonoActivo.js
------------------------------------------------------------------------------
const { Pago, BonoPlan } = require('../database');
const { Op } = require('sequelize');

module.exports = async function bonoActivo(req, res, next) {

  try {

    const idCliente = req.body.id_cliente;

    if (!idCliente) {
      return res.status(400).json({
        error: 'Falta id_cliente'
      });
    }

    const hoy = new Date();

    const pagoActivo = await Pago.findOne({
      where: {
        id_cliente: idCliente,
        fecha_vencimiento: {
          [Op.gt]: hoy
        }
      },
      include: [BonoPlan]



    });

    if (
   pagoActivo.sesiones_restantes !== null &&
   pagoActivo.sesiones_restantes <= 0
){
   return res.status(403).json({
      error: 'No te quedan sesiones disponibles'
   });
}


    if (!pagoActivo) {
      return res.status(403).json({
        error: 'Necesitas un bono activo para reservar'
      });
    }

    // opcional ‚Äî dejamos info √∫til
    req.bono = pagoActivo;

    next();

  } catch (err) {

    res.status(500).json({
      error: err.message
    });

  }
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/app.js
------------------------------------------------------------------------------
const express = require('express');
const cors = require('cors');
const { initDB, Usuario } = require('./database');
const seed = require('./seed');
const app = express();

app.use(cors());
app.use(express.json());


(async () => {
  await initDB();
  await seed();
})();

// Rutas
const usuariosRouter = require('./routes/usuarios');
const horariosRouter = require('./routes/horarios');
const reservasRouter = require('./routes/reservas');
const bonosRouter = require('./routes/bonos');
const pagosRouter = require('./routes/pagos');


app.use('/usuarios', usuariosRouter);
app.use('/horarios', horariosRouter);
app.use('/reservas', reservasRouter);
app.use('/bonos', bonosRouter);
app.use('/pagos', pagosRouter);


// Login
app.post('/login', async (req, res) => {
  try {

    const { email, password } = req.body;

    const user = await Usuario.findOne({
      where: {
        email,
        activo: true
      }
    });

    if (!user) {
      return res.status(401).json({
        error: 'Usuario no v√°lido'
      });
    }

    // comprobar password
    if (user.password_hash !== password) {
      return res.status(401).json({
        error: 'Credenciales incorrectas'
      });
    }

    // üî• eliminar password antes de enviar
    const userSafe = user.toJSON();
    delete userSafe.password_hash;

    res.json(userSafe);

  } catch (err) {
    console.error(err);
    res.status(500).json({
      error: 'Error interno del servidor'
    });
  }
});



// Test
app.get('/', (req, res) => {
  res.json({ mensaje: 'API funcionando üöÄ' });
});

const PORT = process.env.API_PORT || 3000;
app.listen(PORT, () => {
  console.log(`API escuchando en puerto ${PORT}`);
});

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/bonos.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { BonoPlan } = require('../database');


/* =========================
   GET /bonos
========================= */
router.get('/', async (req, res) => {
  try {

    const bonos = await BonoPlan.findAll({
      order: [['precio', 'ASC']]
    });

    res.json(bonos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   POST /bonos
   (admin)
========================= */
router.post('/', async (req, res) => {
  try {

    const bono = await BonoPlan.create(req.body);

    res.status(201).json(bono);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   PUT /bonos/:id
========================= */
router.put('/:id', async (req, res) => {
  try {

    const bono = await BonoPlan.findByPk(req.params.id);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    await bono.update(req.body);

    res.json(bono);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   DELETE /bonos/:id
========================= */
router.delete('/:id', async (req, res) => {
  try {

    const bono = await BonoPlan.findByPk(req.params.id);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    await bono.destroy();

    res.json({
      mensaje: 'Bono eliminado'
    });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/horarios.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Horario, Clase, Usuario, Reserva } = require('../database');

router.get('/', async (req, res) => {
  try {
    const id_cliente = req.query.id_cliente;

    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          include: [
            {
              model: Usuario,
              as: 'profesor',
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false
        }
      ]
    });

    const resultado = horarios.map(h => {
      const reservas = h.Reservas || [];

      const yaReservado = id_cliente
        ? reservas.some(r => r.id_cliente == id_cliente)
        : false;

      const plazas_ocupadas = reservas.length;
      const plazas_totales = h.Clase.capacidad_maxima;

      return {
        ...h.toJSON(),
        plazas_ocupadas,
        plazas_totales,
        plazas_disponibles: plazas_ocupadas < plazas_totales,
        ya_reservado: yaReservado
      };
    });

    res.json(resultado);

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});

// GET /horarios/profesor/:id
router.get('/profesor/:id', async (req, res) => {
  try {
    const { id } = req.params;

    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          where: { id_profesor: id },
          include: [
            {
              model: Usuario,
              as: 'profesor',
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false,
          include: [
            {
              model: Usuario,
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        }
      ],
      order: [['fecha', 'ASC'], ['hora_inicio', 'ASC']]
    });

    const resultado = horarios.map(h => ({
      ...h.toJSON(),
      alumnos: h.Reservas.map(r => r.Usuario),
      plazas_ocupadas: h.Reservas.length,
      plazas_totales: h.Clase.capacidad_maxima
    }));

    res.json(resultado);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});

// PATCH /horarios/:id/cerrar
router.patch('/:id/cerrar', async (req, res) => {
  try {
    const horario = await Horario.findByPk(req.params.id);
    if (!horario) {
      return res.status(404).json({ error: 'Horario no encontrado' });
    }

    horario.reservas_abiertas = false;
    await horario.save();

    res.json({ mensaje: 'Reservas cerradas' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// PATCH /horarios/:id/abrir
router.patch('/:id/abrir', async (req, res) => {
  try {
    const horario = await Horario.findByPk(req.params.id);
    if (!horario) {
      return res.status(404).json({ error: 'Horario no encontrado' });
    }

    horario.reservas_abiertas = true;
    await horario.save();

    res.json({ mensaje: 'Reservas abiertas' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


// =========================
// GET /horarios/:id/alumnos
// =========================
router.get('/:id/alumnos', async (req, res) => {
  try {
    const reservas = await Reserva.findAll({
      where: {
        id_horario: req.params.id,
        estado: 'activa'
      },
      include: [
        {
          model: Usuario,
          attributes: ['id_usuario', 'nombre', 'apellidos', 'email']
        }
      ]
    });

    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// =========================
// GET /horarios/profesor/:id
// =========================
router.get('/profesor/:id', async (req, res) => {
  try {
    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          where: { id_profesor: req.params.id }
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false
        }
      ],
      order: [['fecha', 'ASC'], ['hora_inicio', 'ASC']]
    });

    const resultado = horarios.map(h => ({
      ...h.toJSON(),
      plazas_ocupadas: h.Reservas.length,
      plazas_totales: h.Clase.capacidad_maxima
    }));

    res.json(resultado);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});



















module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/usuarios.js
------------------------------------------------------------------------------
const express = require("express");
const router = express.Router();
const { Usuario } = require("../database");


/* =========================
   GET /usuarios
========================= */
router.get("/", async (req, res) => {
  try {
    const usuarios = await Usuario.findAll({
  where: { activo: true },
  attributes: { exclude: ['password_hash'] }
});

    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   GET /usuarios/rol/:rol
========================= */
router.get("/rol/:rol", async (req, res) => {
  try {
    const usuarios = await Usuario.findAll({
      where: { rol: req.params.rol },
      attributes: { exclude: ['password_hash'] }
    });

    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   POST /usuarios
========================= */
router.post("/", async (req, res) => {
  try {
    const usuario = await Usuario.create(req.body);

    res.status(201).json(usuario);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   PUT /usuarios/:id
========================= */
router.put("/:id", async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: "Usuario no encontrado" });
    }

    await usuario.update(req.body);

    res.json(usuario);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   DELETE /usuarios/:id
========================= */
router.delete("/:id", async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: "Usuario no encontrado" });
    }

    usuario.activo = false;
    await usuario.save();

    res.json({ mensaje: "Usuario desactivado" });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// ADMIN - Crear usuario
router.post('/admin', async (req, res) => {
  try {

    const {
      nombre,
      apellidos,
      email,
      password_hash,
      telefono,
      rol
    } = req.body;

    const existe = await Usuario.findOne({ where: { email } });

    if (existe) {
      return res.status(400).json({
        error: 'El email ya est√° registrado'
      });
    }

    const usuario = await Usuario.create({
      nombre,
      apellidos,
      email,
      password_hash,
      telefono,
      rol,
      activo: true
    });

    res.status(201).json(usuario);

  } catch (err) {
    res.status(500).json({
      error: err.message
    });
  }
});

// ADMIN - Desactivar usuario
router.patch('/:id/desactivar', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({
        error: 'Usuario no encontrado'
      });
    }

    usuario.activo = false;
    await usuario.save();

    res.json({
      mensaje: 'Usuario desactivado'
    });

  } catch (err) {
    res.status(500).json({
      error: err.message
    });
  }
});

router.get('/admin', async (req, res) => {
  try {

    const usuarios = await Usuario.findAll({
      attributes: [
        'id_usuario',
        'nombre',
        'apellidos',
        'email',
        'rol',
        'activo',
        'fecha_registro'
      ],
      order: [['id_usuario', 'DESC']]
    });

    res.json(usuarios);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

router.patch('/:id/toggle-activo', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }

    usuario.activo = !usuario.activo;

    await usuario.save();

    res.json(usuario);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

router.delete('/:id', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }

    // Soft delete profesional
    usuario.activo = false;
    await usuario.save();

    res.json({ mensaje: 'Usuario desactivado' });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/pagos.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Pago, BonoPlan, Usuario } = require('../database');
const { Op } = require('sequelize');


/* =========================
   GET /pagos (admin)
========================= */
router.get('/', async (req, res) => {
  try {

    const pagos = await Pago.findAll({
      include: [
        {
          model: Usuario,
          attributes: ['id_usuario', 'nombre', 'email']
        },
        {
          model: BonoPlan,
          attributes: ['nombre_bono', 'precio']
        }
      ],
      order: [['fecha_pago', 'DESC']]
    });

    res.json(pagos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   GET pagos de un cliente
========================= */
router.get('/cliente/:id', async (req, res) => {
  try {

    const pagos = await Pago.findAll({
      where: { id_cliente: req.params.id },
      include: [BonoPlan],
      order: [['fecha_pago', 'DESC']]
    });

    res.json(pagos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   BONO ACTIVO
========================= */
router.get('/cliente/:id/activo', async (req, res) => {
  try {

    const hoy = new Date();

    const pago = await Pago.findOne({
      where: {
        id_cliente: req.params.id,
        [Op.or]: [
          { fecha_vencimiento: { [Op.gt]: hoy } },
          { sesiones_restantes: { [Op.gt]: 0 } }
        ]
      },
      include: [BonoPlan],
      order: [['fecha_pago', 'DESC']]
    });

    if (!pago) {
      return res.json({ activo: false });
    }

    res.json({
      activo: true,
      bono: pago.BonoPlan.nombre_bono,
      vence: pago.fecha_vencimiento,
      sesiones_restantes: pago.sesiones_restantes
    });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   CREAR PAGO
========================= */
router.post('/', async (req, res) => {
  try {

    const { id_cliente, id_bono, metodo_pago } = req.body;

    const bono = await BonoPlan.findByPk(id_bono);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    let fecha_vencimiento = null;
    let sesiones_restantes = null;

    // bonos por duraci√≥n
    if (bono.duracion_dias) {
      fecha_vencimiento = new Date();
      fecha_vencimiento.setDate(
        fecha_vencimiento.getDate() + bono.duracion_dias
      );
    }

    // bonos por sesiones
    if (bono.num_sesiones) {
      sesiones_restantes = bono.num_sesiones;
    }

    const pago = await Pago.create({
      id_cliente,
      id_bono,
      monto: bono.precio,
      metodo_pago,
      fecha_vencimiento,
      sesiones_restantes
    });

    res.status(201).json(pago);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/reservas.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Reserva, Horario, Clase, Usuario } = require('../database');
const bonoActivo = require('../middleware/bonoActivo');


/* =========================
   GET /reservas
========================= */
router.get('/', async (req, res) => {
  try {
    const reservas = await Reserva.findAll();
    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

/* =========================
   GET /reservas/cliente/:id
========================= */
router.get('/cliente/:id', async (req, res) => {
  try {
    const reservas = await Reserva.findAll({
      where: { id_cliente: req.params.id },
      include: [
        {
          model: Horario,
          include: [
            {
              model: Clase,
              include: [
                {
                  model: Usuario,
                  as: 'profesor',
                  attributes: ['nombre', 'apellidos']
                }
              ]
            }
          ]
        }
      ],
      order: [['fecha_reserva', 'DESC']]
    });

    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

/* =========================
   POST /reservas
========================= */


router.post('/', bonoActivo, async (req, res) => {
  try {
    const { id_cliente, id_horario } = req.body;

   
    // 1Ô∏è‚É£ Buscar horario + clase
    const horario = await Horario.findByPk(id_horario, {
      include: [Clase]
      
    });

    

    if (!horario) {
      return res.status(404).json({ error: 'Horario no existe' });
    }

    // 2Ô∏è‚É£ Evitar duplicados
    const existente = await Reserva.findOne({
      where: {
        id_cliente,
        id_horario,
        estado: 'activa'
      }
    });

    if (existente) {
      return res.status(400).json({
        error: 'Ya tienes una reserva activa en este horario'
      });
    }

    // 3Ô∏è‚É£ Comprobar capacidad
    const reservasActivas = await Reserva.count({
      where: {
        id_horario,
        estado: 'activa'
      }
    });

    if (reservasActivas >= horario.Clase.capacidad_maxima) {
      return res.status(400).json({
        error: 'No hay plazas disponibles'
      });
    }

    if (!horario.reservas_abiertas) {
  return res.status(400).json({
    error: 'Las reservas est√°n cerradas para este horario'
  });
}

    // 4Ô∏è‚É£ Crear reserva
    const reserva = await Reserva.create({
      id_cliente,
      id_horario,
      estado: 'activa'
    });


    res.status(201).json(reserva);

    if (req.bono.sesiones_restantes !== null) {
   req.bono.sesiones_restantes--;
   await req.bono.save();
}

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Error al crear la reserva' });
  }
});

/* =========================
   PATCH /reservas/:id/cancelar
========================= */
router.patch('/:id/cancelar', async (req, res) => {
  try {
    const reserva = await Reserva.findByPk(req.params.id);

    if (!reserva) {
      return res.status(404).json({ error: 'Reserva no encontrada' });
    }

    if (reserva.estado !== 'activa') {
      return res.status(400).json({ error: 'La reserva no est√° activa' });
    }

    reserva.estado = 'cancelada';
    await reserva.save();

    res.json(reserva);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// PATCH /reservas/:id/forzar-cancelacion
router.patch('/:id/forzar-cancelacion', async (req, res) => {
  try {
    const reserva = await Reserva.findByPk(req.params.id);
    if (!reserva) {
      return res.status(404).json({ error: 'Reserva no encontrada' });
    }

    reserva.estado = 'cancelada';
    await reserva.save();

    res.json({ mensaje: 'Reserva cancelada por el profesor' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/database.js
------------------------------------------------------------------------------
const { Sequelize } = require('sequelize');

const sequelize = new Sequelize(
  process.env.DB_NAME,
  process.env.DB_USER,
  process.env.DB_PASS,
  {
    host: process.env.DB_HOST,
    dialect: 'postgres',
    logging: false,
  }
);

// MODELOS
const Usuario = require('./models/Usuario')(sequelize);
const Clase = require('./models/Clase')(sequelize);
const Horario = require('./models/Horario')(sequelize);
const Reserva = require('./models/Reserva')(sequelize);
const BonoPlan = require('./models/BonoPlan')(sequelize);
const Pago = require('./models/Pago')(sequelize);


// =======================
// RELACIONES
// =======================

// Clase ‚Üî Usuario (profesor)
Clase.belongsTo(Usuario, {
  foreignKey: 'id_profesor',
  as: 'profesor'
});
Usuario.hasMany(Clase, {
  foreignKey: 'id_profesor'
});

// Horario ‚Üî Clase
Horario.belongsTo(Clase, {
  foreignKey: 'id_clase'
});
Clase.hasMany(Horario, {
  foreignKey: 'id_clase'
});

// Reserva ‚Üî Horario
Reserva.belongsTo(Horario, {
  foreignKey: 'id_horario'
});
Horario.hasMany(Reserva, {
  foreignKey: 'id_horario'
});

// Reserva ‚Üî Usuario (cliente)
Reserva.belongsTo(Usuario, {
  foreignKey: 'id_cliente'
});
Usuario.hasMany(Reserva, {
  foreignKey: 'id_cliente'
});

// Pago ‚Üî Usuario (cliente)
Pago.belongsTo(Usuario, {
  foreignKey: 'id_cliente'
});
Usuario.hasMany(Pago, {
  foreignKey: 'id_cliente'
});

// Pago ‚Üî BonoPlan
Pago.belongsTo(BonoPlan, {
  foreignKey: 'id_bono'
});
BonoPlan.hasMany(Pago, {
  foreignKey: 'id_bono'
});




// =======================
// INIT DB
// =======================

async function initDB() {
  await sequelize.authenticate();
  console.log('‚úÖ Conectado a PostgreSQL');
  await sequelize.sync({ alter: false });
  console.log('üöÄ Modelos sincronizados');
}

module.exports = {
  sequelize,
  initDB,
  Usuario,
  Clase,
  Horario,
  Reserva,
  BonoPlan,
  Pago
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/seed.js
------------------------------------------------------------------------------
const { Usuario, Clase, Horario, Reserva, BonoPlan } = require('./database');

async function seed() {

  console.log("üå± Ejecutando seed PRO...");

  // Evitar duplicados
  const usuarios = await Usuario.count();
  if (usuarios > 0) {
    console.log("üå± Seed ya ejecutado");
    return;
  }

  /*
  ========================
  USUARIOS
  ========================
  */

  const clientes = [];

  for (let i = 1; i <= 15; i++) {
    clientes.push({
      nombre: `Cliente${i}`,
      apellidos: 'Fitness',
      email: `cliente${i}@mail.com`,
      password_hash: '1234',
      telefono: '600000000',
      rol: 'cliente',
      fecha_registro: new Date(),
      activo:true
    });
  }

  const usuariosCreados = await Usuario.bulkCreate([
    {
      nombre: 'Admin',
      apellidos: 'Root',
      email: 'admin@mail.com',
      password_hash: 'admin',
      rol: 'admin'
      ,
      activo:true
    },
    {
      nombre: 'Ana',
      apellidos: 'Yoga',
      email: 'ana@mail.com',
      password_hash: '1234',
      rol: 'profesor',
      activo:true
    },
    {
      nombre: 'Carlos',
      apellidos: 'Crossfit',
      email: 'carlos@mail.com',
      password_hash: '1234',
      rol: 'profesor',
      activo:true
    },
    ...clientes
  ]);

  console.log("‚úÖ Usuarios creados");


  /*
  ========================
  CLASES
  ========================
  */

  const clases = await Clase.bulkCreate([
    {
      nombre_clase: 'Yoga',
      descripcion: 'Clase relajante',
      capacidad_maxima: 20,
      id_profesor: 2
    },
    {
      nombre_clase: 'CrossFit',
      descripcion: 'Alta intensidad',
      capacidad_maxima: 15,
      id_profesor: 3
    }
  ]);

  console.log("‚úÖ Clases creadas");


  /*
  ========================
  HORARIOS
  ========================
  */

  const horarios = await Horario.bulkCreate([
    {
      id_clase: 1,
      fecha: '2026-02-01',
      hora_inicio: '09:00',
      hora_fin: '10:00',
      lugar: 'Sala 1',
      reservas_abiertas: true
    },
    {
      id_clase: 2,
      fecha: '2026-02-01',
      hora_inicio: '18:00',
      hora_fin: '19:00',
      lugar: 'Sala 2',
      reservas_abiertas: true
    }
  ]);

  console.log("‚úÖ Horarios creados");


  /*
  Reservas de ejemplo aleatorias.
  */

  const reservas = [];

  for (let i = 4; i <= 12; i++) {
    reservas.push({
      id_cliente: i,
      id_horario: 1,
      estado: 'activa'
    });
  }

  await Reserva.bulkCreate(reservas);

  console.log("‚úÖ Reservas creadas");

  /*
Bonos de usuario.
*/

await BonoPlan.bulkCreate([
  {
    nombre_bono: 'Bono mensual',
    precio: 40,
    duracion_dias: 30,
    descripcion: 'Acceso ilimitado durante 30 d√≠as'
  },
  {
    nombre_bono: 'Bono 10 sesiones',
    precio: 50,
    num_sesiones: 10,
    descripcion: '10 accesos al gimnasio'
  },
  {
    nombre_bono: 'Bono anual',
    precio: 400,
    duracion_dias: 365,
    descripcion: 'Acceso ilimitado durante 1 a√±o'
  }

]);




console.log("‚úÖ Bonos creados");

console.log("üî• SEED PRO COMPLETADO");


//Insertar nuevos elementos de seed arriba de este comentario.
}
//Exports

module.exports = seed;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Clase.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Clase', {
    id_clase: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    nombre_clase: {
      type: DataTypes.STRING,
      allowNull: false
    },
    descripcion: DataTypes.TEXT,
    capacidad_maxima: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    contenido_profesor: DataTypes.TEXT,
    id_profesor: {
      type: DataTypes.INTEGER,
      allowNull: false
    }
  }, {
    tableName: 'clase',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Horario.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Horario', {
    id_horario: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    id_clase: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    fecha: {
      type: DataTypes.DATEONLY,
      allowNull: false
    },
    hora_inicio: {
      type: DataTypes.TIME,
      allowNull: false
    },
    hora_fin: {
      type: DataTypes.TIME,
      allowNull: false
    },
    reservas_abiertas: {
  type: DataTypes.BOOLEAN,
  defaultValue: true
},
    lugar: DataTypes.STRING
  }, {
    tableName: 'horario',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/BonoPlan.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('BonoPlan', {

    id_bono: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },

    nombre_bono: {
      type: DataTypes.STRING,
      allowNull: false,
      unique: true
    },

    precio: {
      type: DataTypes.DECIMAL(10,2),
      allowNull: false
    },

    duracion_dias: {
      type: DataTypes.INTEGER
    },

    num_sesiones: {
      type: DataTypes.INTEGER
    },

    descripcion: {
      type: DataTypes.TEXT
    }

  }, {
    tableName: 'bono_plan',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Pago.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Pago', {

    id_pago: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },

    id_cliente: {
      type: DataTypes.INTEGER,
      allowNull: false
    },

    id_bono: {
      type: DataTypes.INTEGER,
      allowNull: false
    },

    fecha_pago: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW
    },

    monto: {
      type: DataTypes.DECIMAL(10,2),
      allowNull: false
    },

    metodo_pago: DataTypes.STRING,

    fecha_vencimiento: DataTypes.DATEONLY,

    sesiones_restantes: {
      type: DataTypes.INTEGER,
      allowNull: true
    }

  }, {
    tableName: 'pago',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Reserva.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Reserva', {
    id_reserva: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    id_cliente: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    id_horario: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    fecha_reserva: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW
    },
    estado: {
      type: DataTypes.STRING,
      allowNull: false,
      defaultValue: 'activa'
    }
  }, {
    tableName: 'reserva',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Usuario.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define("Usuario", {

    id_usuario: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true,
    },

    nombre: DataTypes.STRING,
    apellidos: DataTypes.STRING,

    
    email: {
    type: DataTypes.STRING,
    unique: true,
    allowNull: false,
    validate: {
    isEmail: true
  }
},
    password_hash: {
      type: DataTypes.STRING,
      allowNull:false,
      field: 'password_hash'
},
    telefono: DataTypes.STRING,
    rol: DataTypes.STRING,

    fecha_registro: {
      type: DataTypes.DATEONLY,
      defaultValue: DataTypes.NOW
    },

    activo: {
      type: DataTypes.BOOLEAN,
      defaultValue: true
    }

  }, {
    tableName: "usuario",
    timestamps: false,
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/package.json
------------------------------------------------------------------------------
{
  "name": "api",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "dev": "nodemon src/app.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "dependencies": {
    "cors": "^2.8.6",
    "express": "^5.2.1",
    "pg": "^8.17.2",
    "pg-hstore": "^2.3.4",
    "sequelize": "^6.37.7"
  },
  "devDependencies": {
    "nodemon": "^3.1.11"
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./api/Dockerfile
------------------------------------------------------------------------------
FROM node:20
WORKDIR /app
COPY package*.json ./
RUN npm install
# No copiamos todo aqu√≠ porque usaremos vol√∫menes en compose para desarrollo
COPY . .
EXPOSE 3000
# El usuario node mejora la seguridad y evita l√≠os de permisos en Ubuntu
RUN chown -R node:node /app
USER node
CMD ["npm", "run", "dev"]
------------------------------------------------------------------------------
==============================================================================
INSPECCI√ìN FINALIZADA
==============================================================================

------------------------------------------------------------------------------

[ARCHIVO]: ./api/.dockerignore
------------------------------------------------------------------------------
node_modules
npm-debug.log
Dockerfile
.git
.gitignore

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/middleware/bonoActivo.js
------------------------------------------------------------------------------
const { Pago, BonoPlan } = require('../database');
const { Op } = require('sequelize');

module.exports = async function bonoActivo(req, res, next) {

  try {

    const idCliente = req.body.id_cliente;

    if (!idCliente) {
      return res.status(400).json({
        error: 'Falta id_cliente'
      });
    }

    const hoy = new Date();

    const pagoActivo = await Pago.findOne({
      where: {
        id_cliente: idCliente,
        fecha_vencimiento: {
          [Op.gt]: hoy
        }
      },
      include: [BonoPlan]



    });

    if (
   pagoActivo.sesiones_restantes !== null &&
   pagoActivo.sesiones_restantes <= 0
){
   return res.status(403).json({
      error: 'No te quedan sesiones disponibles'
   });
}


    if (!pagoActivo) {
      return res.status(403).json({
        error: 'Necesitas un bono activo para reservar'
      });
    }

    // opcional ‚Äî dejamos info √∫til
    req.bono = pagoActivo;

    next();

  } catch (err) {

    res.status(500).json({
      error: err.message
    });

  }
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/app.js
------------------------------------------------------------------------------
const express = require('express');
const cors = require('cors');
const { initDB, Usuario } = require('./database');
const seed = require('./seed');
const app = express();

app.use(cors());
app.use(express.json());


(async () => {
  await initDB();
  await seed();
})();

// Rutas
const usuariosRouter = require('./routes/usuarios');
const horariosRouter = require('./routes/horarios');
const reservasRouter = require('./routes/reservas');
const bonosRouter = require('./routes/bonos');
const pagosRouter = require('./routes/pagos');


app.use('/usuarios', usuariosRouter);
app.use('/horarios', horariosRouter);
app.use('/reservas', reservasRouter);
app.use('/bonos', bonosRouter);
app.use('/pagos', pagosRouter);


// Login
app.post('/login', async (req, res) => {
  try {

    const { email, password } = req.body;

    const user = await Usuario.findOne({
      where: {
        email,
        activo: true
      }
    });

    if (!user) {
      return res.status(401).json({
        error: 'Usuario no v√°lido'
      });
    }

    // comprobar password
    if (user.password_hash !== password) {
      return res.status(401).json({
        error: 'Credenciales incorrectas'
      });
    }

    // üî• eliminar password antes de enviar
    const userSafe = user.toJSON();
    delete userSafe.password_hash;

    res.json(userSafe);

  } catch (err) {
    console.error(err);
    res.status(500).json({
      error: 'Error interno del servidor'
    });
  }
});



// Test
app.get('/', (req, res) => {
  res.json({ mensaje: 'API funcionando üöÄ' });
});

const PORT = process.env.API_PORT || 3000;
app.listen(PORT, () => {
  console.log(`API escuchando en puerto ${PORT}`);
});

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/bonos.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { BonoPlan } = require('../database');


/* =========================
   GET /bonos
========================= */
router.get('/', async (req, res) => {
  try {

    const bonos = await BonoPlan.findAll({
      order: [['precio', 'ASC']]
    });

    res.json(bonos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   POST /bonos
   (admin)
========================= */
router.post('/', async (req, res) => {
  try {

    const bono = await BonoPlan.create(req.body);

    res.status(201).json(bono);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   PUT /bonos/:id
========================= */
router.put('/:id', async (req, res) => {
  try {

    const bono = await BonoPlan.findByPk(req.params.id);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    await bono.update(req.body);

    res.json(bono);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   DELETE /bonos/:id
========================= */
router.delete('/:id', async (req, res) => {
  try {

    const bono = await BonoPlan.findByPk(req.params.id);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    await bono.destroy();

    res.json({
      mensaje: 'Bono eliminado'
    });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/horarios.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Horario, Clase, Usuario, Reserva } = require('../database');

router.get('/', async (req, res) => {
  try {
    const id_cliente = req.query.id_cliente;

    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          include: [
            {
              model: Usuario,
              as: 'profesor',
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false
        }
      ]
    });

    const resultado = horarios.map(h => {
      const reservas = h.Reservas || [];

      const yaReservado = id_cliente
        ? reservas.some(r => r.id_cliente == id_cliente)
        : false;

      const plazas_ocupadas = reservas.length;
      const plazas_totales = h.Clase.capacidad_maxima;

      return {
        ...h.toJSON(),
        plazas_ocupadas,
        plazas_totales,
        plazas_disponibles: plazas_ocupadas < plazas_totales,
        ya_reservado: yaReservado
      };
    });

    res.json(resultado);

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});

// GET /horarios/profesor/:id
router.get('/profesor/:id', async (req, res) => {
  try {
    const { id } = req.params;

    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          where: { id_profesor: id },
          include: [
            {
              model: Usuario,
              as: 'profesor',
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false,
          include: [
            {
              model: Usuario,
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        }
      ],
      order: [['fecha', 'ASC'], ['hora_inicio', 'ASC']]
    });

    const resultado = horarios.map(h => ({
      ...h.toJSON(),
      alumnos: h.Reservas.map(r => r.Usuario),
      plazas_ocupadas: h.Reservas.length,
      plazas_totales: h.Clase.capacidad_maxima
    }));

    res.json(resultado);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});

// PATCH /horarios/:id/cerrar
router.patch('/:id/cerrar', async (req, res) => {
  try {
    const horario = await Horario.findByPk(req.params.id);
    if (!horario) {
      return res.status(404).json({ error: 'Horario no encontrado' });
    }

    horario.reservas_abiertas = false;
    await horario.save();

    res.json({ mensaje: 'Reservas cerradas' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// PATCH /horarios/:id/abrir
router.patch('/:id/abrir', async (req, res) => {
  try {
    const horario = await Horario.findByPk(req.params.id);
    if (!horario) {
      return res.status(404).json({ error: 'Horario no encontrado' });
    }

    horario.reservas_abiertas = true;
    await horario.save();

    res.json({ mensaje: 'Reservas abiertas' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


// =========================
// GET /horarios/:id/alumnos
// =========================
router.get('/:id/alumnos', async (req, res) => {
  try {
    const reservas = await Reserva.findAll({
      where: {
        id_horario: req.params.id,
        estado: 'activa'
      },
      include: [
        {
          model: Usuario,
          attributes: ['id_usuario', 'nombre', 'apellidos', 'email']
        }
      ]
    });

    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// =========================
// GET /horarios/profesor/:id
// =========================
router.get('/profesor/:id', async (req, res) => {
  try {
    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          where: { id_profesor: req.params.id }
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false
        }
      ],
      order: [['fecha', 'ASC'], ['hora_inicio', 'ASC']]
    });

    const resultado = horarios.map(h => ({
      ...h.toJSON(),
      plazas_ocupadas: h.Reservas.length,
      plazas_totales: h.Clase.capacidad_maxima
    }));

    res.json(resultado);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});



















module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/usuarios.js
------------------------------------------------------------------------------
const express = require("express");
const router = express.Router();
const { Usuario } = require("../database");


/* =========================
   GET /usuarios
========================= */
router.get("/", async (req, res) => {
  try {
    const usuarios = await Usuario.findAll({
  where: { activo: true },
  attributes: { exclude: ['password_hash'] }
});

    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   GET /usuarios/rol/:rol
========================= */
router.get("/rol/:rol", async (req, res) => {
  try {
    const usuarios = await Usuario.findAll({
      where: { rol: req.params.rol },
      attributes: { exclude: ['password_hash'] }
    });

    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   POST /usuarios
========================= */
router.post("/", async (req, res) => {
  try {
    const usuario = await Usuario.create(req.body);

    res.status(201).json(usuario);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   PUT /usuarios/:id
========================= */
router.put("/:id", async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: "Usuario no encontrado" });
    }

    await usuario.update(req.body);

    res.json(usuario);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   DELETE /usuarios/:id
========================= */
router.delete("/:id", async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: "Usuario no encontrado" });
    }

    usuario.activo = false;
    await usuario.save();

    res.json({ mensaje: "Usuario desactivado" });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// ADMIN - Crear usuario
router.post('/admin', async (req, res) => {
  try {

    const {
      nombre,
      apellidos,
      email,
      password_hash,
      telefono,
      rol
    } = req.body;

    const existe = await Usuario.findOne({ where: { email } });

    if (existe) {
      return res.status(400).json({
        error: 'El email ya est√° registrado'
      });
    }

    const usuario = await Usuario.create({
      nombre,
      apellidos,
      email,
      password_hash,
      telefono,
      rol,
      activo: true
    });

    res.status(201).json(usuario);

  } catch (err) {
    res.status(500).json({
      error: err.message
    });
  }
});

// ADMIN - Desactivar usuario
router.patch('/:id/desactivar', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({
        error: 'Usuario no encontrado'
      });
    }

    usuario.activo = false;
    await usuario.save();

    res.json({
      mensaje: 'Usuario desactivado'
    });

  } catch (err) {
    res.status(500).json({
      error: err.message
    });
  }
});

router.get('/admin', async (req, res) => {
  try {

    const usuarios = await Usuario.findAll({
      attributes: [
        'id_usuario',
        'nombre',
        'apellidos',
        'email',
        'rol',
        'activo',
        'fecha_registro'
      ],
      order: [['id_usuario', 'DESC']]
    });

    res.json(usuarios);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

router.patch('/:id/toggle-activo', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }

    usuario.activo = !usuario.activo;

    await usuario.save();

    res.json(usuario);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

router.delete('/:id', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }

    // Soft delete profesional
    usuario.activo = false;
    await usuario.save();

    res.json({ mensaje: 'Usuario desactivado' });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/pagos.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Pago, BonoPlan, Usuario } = require('../database');
const { Op } = require('sequelize');


/* =========================
   GET /pagos (admin)
========================= */
router.get('/', async (req, res) => {
  try {

    const pagos = await Pago.findAll({
      include: [
        {
          model: Usuario,
          attributes: ['id_usuario', 'nombre', 'email']
        },
        {
          model: BonoPlan,
          attributes: ['nombre_bono', 'precio']
        }
      ],
      order: [['fecha_pago', 'DESC']]
    });

    res.json(pagos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   GET pagos de un cliente
========================= */
router.get('/cliente/:id', async (req, res) => {
  try {

    const pagos = await Pago.findAll({
      where: { id_cliente: req.params.id },
      include: [BonoPlan],
      order: [['fecha_pago', 'DESC']]
    });

    res.json(pagos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   BONO ACTIVO
========================= */
router.get('/cliente/:id/activo', async (req, res) => {
  try {

    const hoy = new Date();

    const pago = await Pago.findOne({
      where: {
        id_cliente: req.params.id,
        [Op.or]: [
          { fecha_vencimiento: { [Op.gt]: hoy } },
          { sesiones_restantes: { [Op.gt]: 0 } }
        ]
      },
      include: [BonoPlan],
      order: [['fecha_pago', 'DESC']]
    });

    if (!pago) {
      return res.json({ activo: false });
    }

    res.json({
      activo: true,
      bono: pago.BonoPlan.nombre_bono,
      vence: pago.fecha_vencimiento,
      sesiones_restantes: pago.sesiones_restantes
    });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   CREAR PAGO
========================= */
router.post('/', async (req, res) => {
  try {

    const { id_cliente, id_bono, metodo_pago } = req.body;

    const bono = await BonoPlan.findByPk(id_bono);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    let fecha_vencimiento = null;
    let sesiones_restantes = null;

    // bonos por duraci√≥n
    if (bono.duracion_dias) {
      fecha_vencimiento = new Date();
      fecha_vencimiento.setDate(
        fecha_vencimiento.getDate() + bono.duracion_dias
      );
    }

    // bonos por sesiones
    if (bono.num_sesiones) {
      sesiones_restantes = bono.num_sesiones;
    }

    const pago = await Pago.create({
      id_cliente,
      id_bono,
      monto: bono.precio,
      metodo_pago,
      fecha_vencimiento,
      sesiones_restantes
    });

    res.status(201).json(pago);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/reservas.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Reserva, Horario, Clase, Usuario } = require('../database');
const bonoActivo = require('../middleware/bonoActivo');


/* =========================
   GET /reservas
========================= */
router.get('/', async (req, res) => {
  try {
    const reservas = await Reserva.findAll();
    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

/* =========================
   GET /reservas/cliente/:id
========================= */
router.get('/cliente/:id', async (req, res) => {
  try {
    const reservas = await Reserva.findAll({
      where: { id_cliente: req.params.id },
      include: [
        {
          model: Horario,
          include: [
            {
              model: Clase,
              include: [
                {
                  model: Usuario,
                  as: 'profesor',
                  attributes: ['nombre', 'apellidos']
                }
              ]
            }
          ]
        }
      ],
      order: [['fecha_reserva', 'DESC']]
    });

    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

/* =========================
   POST /reservas
========================= */


router.post('/', bonoActivo, async (req, res) => {
  try {
    const { id_cliente, id_horario } = req.body;

   
    // 1Ô∏è‚É£ Buscar horario + clase
    const horario = await Horario.findByPk(id_horario, {
      include: [Clase]
      
    });

    

    if (!horario) {
      return res.status(404).json({ error: 'Horario no existe' });
    }

    // 2Ô∏è‚É£ Evitar duplicados
    const existente = await Reserva.findOne({
      where: {
        id_cliente,
        id_horario,
        estado: 'activa'
      }
    });

    if (existente) {
      return res.status(400).json({
        error: 'Ya tienes una reserva activa en este horario'
      });
    }

    // 3Ô∏è‚É£ Comprobar capacidad
    const reservasActivas = await Reserva.count({
      where: {
        id_horario,
        estado: 'activa'
      }
    });

    if (reservasActivas >= horario.Clase.capacidad_maxima) {
      return res.status(400).json({
        error: 'No hay plazas disponibles'
      });
    }

    if (!horario.reservas_abiertas) {
  return res.status(400).json({
    error: 'Las reservas est√°n cerradas para este horario'
  });
}

    // 4Ô∏è‚É£ Crear reserva
    const reserva = await Reserva.create({
      id_cliente,
      id_horario,
      estado: 'activa'
    });


    res.status(201).json(reserva);

    if (req.bono.sesiones_restantes !== null) {
   req.bono.sesiones_restantes--;
   await req.bono.save();
}

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Error al crear la reserva' });
  }
});

/* =========================
   PATCH /reservas/:id/cancelar
========================= */
router.patch('/:id/cancelar', async (req, res) => {
  try {
    const reserva = await Reserva.findByPk(req.params.id);

    if (!reserva) {
      return res.status(404).json({ error: 'Reserva no encontrada' });
    }

    if (reserva.estado !== 'activa') {
      return res.status(400).json({ error: 'La reserva no est√° activa' });
    }

    reserva.estado = 'cancelada';
    await reserva.save();

    res.json(reserva);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// PATCH /reservas/:id/forzar-cancelacion
router.patch('/:id/forzar-cancelacion', async (req, res) => {
  try {
    const reserva = await Reserva.findByPk(req.params.id);
    if (!reserva) {
      return res.status(404).json({ error: 'Reserva no encontrada' });
    }

    reserva.estado = 'cancelada';
    await reserva.save();

    res.json({ mensaje: 'Reserva cancelada por el profesor' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/database.js
------------------------------------------------------------------------------
const { Sequelize } = require('sequelize');

const sequelize = new Sequelize(
  process.env.DB_NAME,
  process.env.DB_USER,
  process.env.DB_PASS,
  {
    host: process.env.DB_HOST,
    dialect: 'postgres',
    logging: false,
  }
);

// MODELOS
const Usuario = require('./models/Usuario')(sequelize);
const Clase = require('./models/Clase')(sequelize);
const Horario = require('./models/Horario')(sequelize);
const Reserva = require('./models/Reserva')(sequelize);
const BonoPlan = require('./models/BonoPlan')(sequelize);
const Pago = require('./models/Pago')(sequelize);


// =======================
// RELACIONES
// =======================

// Clase ‚Üî Usuario (profesor)
Clase.belongsTo(Usuario, {
  foreignKey: 'id_profesor',
  as: 'profesor'
});
Usuario.hasMany(Clase, {
  foreignKey: 'id_profesor'
});

// Horario ‚Üî Clase
Horario.belongsTo(Clase, {
  foreignKey: 'id_clase'
});
Clase.hasMany(Horario, {
  foreignKey: 'id_clase'
});

// Reserva ‚Üî Horario
Reserva.belongsTo(Horario, {
  foreignKey: 'id_horario'
});
Horario.hasMany(Reserva, {
  foreignKey: 'id_horario'
});

// Reserva ‚Üî Usuario (cliente)
Reserva.belongsTo(Usuario, {
  foreignKey: 'id_cliente'
});
Usuario.hasMany(Reserva, {
  foreignKey: 'id_cliente'
});

// Pago ‚Üî Usuario (cliente)
Pago.belongsTo(Usuario, {
  foreignKey: 'id_cliente'
});
Usuario.hasMany(Pago, {
  foreignKey: 'id_cliente'
});

// Pago ‚Üî BonoPlan
Pago.belongsTo(BonoPlan, {
  foreignKey: 'id_bono'
});
BonoPlan.hasMany(Pago, {
  foreignKey: 'id_bono'
});




// =======================
// INIT DB
// =======================

async function initDB() {
  await sequelize.authenticate();
  console.log('‚úÖ Conectado a PostgreSQL');
  await sequelize.sync({ alter: false });
  console.log('üöÄ Modelos sincronizados');
}

module.exports = {
  sequelize,
  initDB,
  Usuario,
  Clase,
  Horario,
  Reserva,
  BonoPlan,
  Pago
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/seed.js
------------------------------------------------------------------------------
const { Usuario, Clase, Horario, Reserva, BonoPlan } = require('./database');

async function seed() {

  console.log("üå± Ejecutando seed PRO...");

  // Evitar duplicados
  const usuarios = await Usuario.count();
  if (usuarios > 0) {
    console.log("üå± Seed ya ejecutado");
    return;
  }

  /*
  ========================
  USUARIOS
  ========================
  */

  const clientes = [];

  for (let i = 1; i <= 15; i++) {
    clientes.push({
      nombre: `Cliente${i}`,
      apellidos: 'Fitness',
      email: `cliente${i}@mail.com`,
      password_hash: '1234',
      telefono: '600000000',
      rol: 'cliente',
      fecha_registro: new Date(),
      activo:true
    });
  }

  const usuariosCreados = await Usuario.bulkCreate([
    {
      nombre: 'Admin',
      apellidos: 'Root',
      email: 'admin@mail.com',
      password_hash: 'admin',
      rol: 'admin'
      ,
      activo:true
    },
    {
      nombre: 'Ana',
      apellidos: 'Yoga',
      email: 'ana@mail.com',
      password_hash: '1234',
      rol: 'profesor',
      activo:true
    },
    {
      nombre: 'Carlos',
      apellidos: 'Crossfit',
      email: 'carlos@mail.com',
      password_hash: '1234',
      rol: 'profesor',
      activo:true
    },
    ...clientes
  ]);

  console.log("‚úÖ Usuarios creados");


  /*
  ========================
  CLASES
  ========================
  */

  const clases = await Clase.bulkCreate([
    {
      nombre_clase: 'Yoga',
      descripcion: 'Clase relajante',
      capacidad_maxima: 20,
      id_profesor: 2
    },
    {
      nombre_clase: 'CrossFit',
      descripcion: 'Alta intensidad',
      capacidad_maxima: 15,
      id_profesor: 3
    }
  ]);

  console.log("‚úÖ Clases creadas");


  /*
  ========================
  HORARIOS
  ========================
  */

  const horarios = await Horario.bulkCreate([
    {
      id_clase: 1,
      fecha: '2026-02-01',
      hora_inicio: '09:00',
      hora_fin: '10:00',
      lugar: 'Sala 1',
      reservas_abiertas: true
    },
    {
      id_clase: 2,
      fecha: '2026-02-01',
      hora_inicio: '18:00',
      hora_fin: '19:00',
      lugar: 'Sala 2',
      reservas_abiertas: true
    }
  ]);

  console.log("‚úÖ Horarios creados");


  /*
  Reservas de ejemplo aleatorias.
  */

  const reservas = [];

  for (let i = 4; i <= 12; i++) {
    reservas.push({
      id_cliente: i,
      id_horario: 1,
      estado: 'activa'
    });
  }

  await Reserva.bulkCreate(reservas);

  console.log("‚úÖ Reservas creadas");

  /*
Bonos de usuario.
*/

await BonoPlan.bulkCreate([
  {
    nombre_bono: 'Bono mensual',
    precio: 40,
    duracion_dias: 30,
    descripcion: 'Acceso ilimitado durante 30 d√≠as'
  },
  {
    nombre_bono: 'Bono 10 sesiones',
    precio: 50,
    num_sesiones: 10,
    descripcion: '10 accesos al gimnasio'
  },
  {
    nombre_bono: 'Bono anual',
    precio: 400,
    duracion_dias: 365,
    descripcion: 'Acceso ilimitado durante 1 a√±o'
  }

]);




console.log("‚úÖ Bonos creados");

console.log("üî• SEED PRO COMPLETADO");


//Insertar nuevos elementos de seed arriba de este comentario.
}
//Exports

module.exports = seed;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Clase.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Clase', {
    id_clase: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    nombre_clase: {
      type: DataTypes.STRING,
      allowNull: false
    },
    descripcion: DataTypes.TEXT,
    capacidad_maxima: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    contenido_profesor: DataTypes.TEXT,
    id_profesor: {
      type: DataTypes.INTEGER,
      allowNull: false
    }
  }, {
    tableName: 'clase',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Horario.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Horario', {
    id_horario: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    id_clase: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    fecha: {
      type: DataTypes.DATEONLY,
      allowNull: false
    },
    hora_inicio: {
      type: DataTypes.TIME,
      allowNull: false
    },
    hora_fin: {
      type: DataTypes.TIME,
      allowNull: false
    },
    reservas_abiertas: {
  type: DataTypes.BOOLEAN,
  defaultValue: true
},
    lugar: DataTypes.STRING
  }, {
    tableName: 'horario',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/BonoPlan.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('BonoPlan', {

    id_bono: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },

    nombre_bono: {
      type: DataTypes.STRING,
      allowNull: false,
      unique: true
    },

    precio: {
      type: DataTypes.DECIMAL(10,2),
      allowNull: false
    },

    duracion_dias: {
      type: DataTypes.INTEGER
    },

    num_sesiones: {
      type: DataTypes.INTEGER
    },

    descripcion: {
      type: DataTypes.TEXT
    }

  }, {
    tableName: 'bono_plan',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Pago.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Pago', {

    id_pago: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },

    id_cliente: {
      type: DataTypes.INTEGER,
      allowNull: false
    },

    id_bono: {
      type: DataTypes.INTEGER,
      allowNull: false
    },

    fecha_pago: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW
    },

    monto: {
      type: DataTypes.DECIMAL(10,2),
      allowNull: false
    },

    metodo_pago: DataTypes.STRING,

    fecha_vencimiento: DataTypes.DATEONLY,

    sesiones_restantes: {
      type: DataTypes.INTEGER,
      allowNull: true
    }

  }, {
    tableName: 'pago',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Reserva.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Reserva', {
    id_reserva: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    id_cliente: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    id_horario: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    fecha_reserva: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW
    },
    estado: {
      type: DataTypes.STRING,
      allowNull: false,
      defaultValue: 'activa'
    }
  }, {
    tableName: 'reserva',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Usuario.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define("Usuario", {

    id_usuario: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true,
    },

    nombre: DataTypes.STRING,
    apellidos: DataTypes.STRING,

    
    email: {
    type: DataTypes.STRING,
    unique: true,
    allowNull: false,
    validate: {
    isEmail: true
  }
},
    password_hash: {
      type: DataTypes.STRING,
      allowNull:false,
      field: 'password_hash'
},
    telefono: DataTypes.STRING,
    rol: DataTypes.STRING,

    fecha_registro: {
      type: DataTypes.DATEONLY,
      defaultValue: DataTypes.NOW
    },

    activo: {
      type: DataTypes.BOOLEAN,
      defaultValue: true
    }

  }, {
    tableName: "usuario",
    timestamps: false,
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/package.json
------------------------------------------------------------------------------
{
  "name": "api",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "dev": "nodemon src/app.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "dependencies": {
    "cors": "^2.8.6",
    "express": "^5.2.1",
    "pg": "^8.17.2",
    "pg-hstore": "^2.3.4",
    "sequelize": "^6.37.7"
  },
  "devDependencies": {
    "nodemon": "^3.1.11"
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./api/Dockerfile
------------------------------------------------------------------------------
FROM node:20
WORKDIR /app
COPY package*.json ./
RUN npm install
# No copiamos todo aqu√≠ porque usaremos vol√∫menes en compose para desarrollo
COPY . .
EXPOSE 3000
# El usuario node mejora la seguridad y evita l√≠os de permisos en Ubuntu
RUN chown -R node:node /app
USER node
CMD ["npm", "run", "dev"]
------------------------------------------------------------------------------
==============================================================================
INSPECCI√ìN FINALIZADA
==============================================================================

------------------------------------------------------------------------------

[ARCHIVO]: ./.env.example
------------------------------------------------------------------------------
# POSTGRES
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin
POSTGRES_DB=cosmos_db
POSTGRES_PORT=5432

# API
API_PORT=3000

# IONIC
IONIC_PORT=8100

------------------------------------------------------------------------------

[ARCHIVO]: ./build.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  BUILD COMPLETO COSMOS"
echo "=============================="

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

$COMPOSE down
$COMPOSE up -d --build

echo "‚úÖ Build terminado"


------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/.dockerignore
------------------------------------------------------------------------------
node_modules
www
dist
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/main.ts
------------------------------------------------------------------------------
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';

import { AppModule } from './app/app.module';

platformBrowserDynamic().bootstrapModule(AppModule)
  .catch(err => console.log(err));

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/index.html
------------------------------------------------------------------------------
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Ionic App</title>

  <base href="/" />

  <meta name="color-scheme" content="light dark" />
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />

  <link rel="icon" type="image/png" href="assets/icon/favicon.png" />

  <!-- add to homescreen for ios -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
</head>

<body>
  <app-root></app-root>
</body>

</html>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/zone-flags.ts
------------------------------------------------------------------------------
/**
 * Prevents Angular change detection from
 * running with certain Web Component callbacks
 */
// eslint-disable-next-line no-underscore-dangle
(window as any).__Zone_disable_customElements = true;

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/theme/variables.scss
------------------------------------------------------------------------------
// For information on how to create your own theme, please refer to:
// https://ionicframework.com/docs/theming/

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/polyfills.ts
------------------------------------------------------------------------------
/**
 * This file includes polyfills needed by Angular and is loaded before the app.
 * You can add your own extra polyfills to this file.
 *
 * This file is divided into 2 sections:
 *   1. Browser polyfills. These are applied before loading ZoneJS and are sorted by browsers.
 *   2. Application imports. Files imported after ZoneJS that should be loaded before your main
 *      file.
 *
 * The current setup is for so-called "evergreen" browsers; the last versions of browsers that
 * automatically update themselves. This includes recent versions of Safari, Chrome (including
 * Opera), Edge on the desktop, and iOS and Chrome on mobile.
 *
 * Learn more in https://angular.io/guide/browser-support
 */

/***************************************************************************************************
 * BROWSER POLYFILLS
 */

/**
 * By default, zone.js will patch all possible macroTask and DomEvents
 * user can disable parts of macroTask/DomEvents patch by setting following flags
 * because those flags need to be set before `zone.js` being loaded, and webpack
 * will put import in the top of bundle, so user need to create a separate file
 * in this directory (for example: zone-flags.ts), and put the following flags
 * into that file, and then add the following code before importing zone.js.
 * import './zone-flags';
 *
 * The flags allowed in zone-flags.ts are listed here.
 *
 * The following flags will work for all browsers.
 *
 * (window as any).__Zone_disable_requestAnimationFrame = true; // disable patch requestAnimationFrame
 * (window as any).__Zone_disable_on_property = true; // disable patch onProperty such as onclick
 * (window as any).__zone_symbol__UNPATCHED_EVENTS = ['scroll', 'mousemove']; // disable patch specified eventNames
 *
 *  in IE/Edge developer tools, the addEventListener will also be wrapped by zone.js
 *  with the following flag, it will bypass `zone.js` patch for IE/Edge
 *
 *  (window as any).__Zone_enable_cross_context_check = true;
 *
 */
 
import './zone-flags';

/***************************************************************************************************
 * Zone JS is required by default for Angular itself.
 */
import 'zone.js';  // Included with Angular CLI.


/***************************************************************************************************
 * APPLICATION IMPORTS
 */

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/global.scss
------------------------------------------------------------------------------
/*
 * App Global CSS
 * ----------------------------------------------------------------------------
 * Put style rules here that you want to apply globally. These styles are for
 * the entire app and not just one component. Additionally, this file can be
 * used as an entry point to import other CSS/Sass files to be included in the
 * output CSS.
 * For more information on global stylesheets, visit the documentation:
 * https://ionicframework.com/docs/layout/global-stylesheets
 */

/* Core CSS required for Ionic components to work properly */
@import "@ionic/angular/css/core.css";

/* Basic CSS for apps built with Ionic */
@import "@ionic/angular/css/normalize.css";
@import "@ionic/angular/css/structure.css";
@import "@ionic/angular/css/typography.css";
@import "@ionic/angular/css/display.css";

/* Optional CSS utils that can be commented out */
@import "@ionic/angular/css/padding.css";
@import "@ionic/angular/css/float-elements.css";
@import "@ionic/angular/css/text-alignment.css";
@import "@ionic/angular/css/text-transformation.css";
@import "@ionic/angular/css/flex-utils.css";

/**
 * Ionic Dark Mode
 * -----------------------------------------------------
 * For more info, please see:
 * https://ionicframework.com/docs/theming/dark-mode
 */

/* @import "@ionic/angular/css/palettes/dark.always.css"; */
/* @import "@ionic/angular/css/palettes/dark.class.css"; */
@import "@ionic/angular/css/palettes/dark.system.css";

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/environments/environment.prod.ts
------------------------------------------------------------------------------
export const environment = {
  production: true,
  apiUrl: 'http://api-node:3000'
};
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/environments/environment.ts
------------------------------------------------------------------------------
// This file can be replaced during build by using the `fileReplacements` array.
// `ng build` replaces `environment.ts` with `environment.prod.ts`.
// The list of file replacements can be found in `angular.json`.

export const environment = {
  production: false,
  apiUrl: 'http://localhost:3000'
};


/*
 * For easier debugging in development mode, you can import the following file
 * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.
 *
 * This import should be commented out in production mode because it will have a negative impact
 * on performance if an error is thrown.
 */
// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/api.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class Api {
  
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/usuario.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({
  providedIn: 'root'
})

export class UsuarioService {

  private api = 'http://localhost:3000/usuarios';

  constructor(private http: HttpClient) {}

  getUsuariosAdmin() {
    return this.http.get<any[]>(`${this.api}/admin`);
  }

  toggleActivo(id:number) {
    return this.http.patch(`${this.api}/${id}/toggle-activo`, {});
  }

  crearUsuario(usuario:any){
  return this.http.post(
    'http://localhost:3000/usuarios/admin',
    usuario
  );
}


  crearUsuarioAdmin(data: any) {
  return this.http.post(
    'http://localhost:3000/usuarios/admin',
    data
  );


}


}
export class ReservaService {

  private baseUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  getReservasCliente(idCliente: number) {
    return this.http.get<any[]>(
      `${this.baseUrl}/reservas/cliente/${idCliente}`
    );
  }
}




------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/horario.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class HorarioService {

  private apiUrl = 'http://localhost:3000/horarios';

  constructor(private http: HttpClient) {}

  getHorarios(idCliente: number): Observable<any[]> {
    return this.http.get<any[]>(`${this.apiUrl}?id_cliente=${idCliente}`);
  }

/** 
  getHorariosProfesor(idProfesor: number): Observable<any[]> {
  return this.http.get<any[]>(
    `http://localhost:3000/horarios/profesor/${idProfesor}`
  );
}
*/
cerrarReservas(idHorario: number) {
  return this.http.patch(
    `http://localhost:3000/horarios/${idHorario}/cerrar`,
    {}
  );
}

abrirReservas(idHorario: number) {
  return this.http.patch(
    `http://localhost:3000/horarios/${idHorario}/abrir`,
    {}
  );
}
getHorariosProfesor(idProfesor: number) {
  return this.http.get<any[]>(
    `http://localhost:3000/horarios/profesor/${idProfesor}`
  );
}

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/api.spec.ts
------------------------------------------------------------------------------
import { TestBed } from '@angular/core/testing';

import { Api } from './api';

describe('Api', () => {
  let service: Api;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(Api);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/auth.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({ providedIn: 'root' })
export class AuthService {

  private baseUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  login(email: string, password: string) {
    return this.http.post<any>(`${this.baseUrl}/login`, { email, password });
  }

  saveUser(user: any) {
    localStorage.setItem('user', JSON.stringify(user));
  }

  getUser() {
    return JSON.parse(localStorage.getItem('user') || 'null');
  }

  isLogged(): boolean {
  return !!this.getUser();
  }

  getRole(): string | null {
    const user = this.getUser();
    return user ? user.rol : null;
  }


  logout() {
    localStorage.removeItem('user');
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/reserva.service.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment';

@Injectable({
  providedIn: 'root'
})
export class ReservaService {
  private apiUrl = 'http://localhost:3000/reservas';

  private baseUrl = `${environment.apiUrl}/reservas`;

  constructor(private http: HttpClient) {}

  getReservasCliente(idCliente: number) {
    return this.http.get<any[]>(`${this.baseUrl}/cliente/${idCliente}`);
  }

  cancelarReserva(idReserva: number) {
    console.log('URL cancelaci√≥n:', `${this.baseUrl}/${idReserva}/cancelar`);

    return this.http.patch(
      `${this.baseUrl}/${idReserva}/cancelar`,
      {}
    );
  }

  crearReserva(data: { id_cliente: number; id_horario: number }) {
  return this.http.post(this.baseUrl, data);
}

forzarCancelacion(idReserva: number) {
  return this.http.patch(
    `${this.apiUrl}/${idReserva}/forzar-cancelacion`,
    {}
  );
}
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/pago.service.ts
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/services/clase.service.ts
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { PreloadAllModules, RouterModule, Routes } from '@angular/router';
import { AuthGuard } from './guards/auth-guard';



const routes: Routes = [
  {
    path: 'login',
    loadChildren: () => import('./pages/login/login.module').then(m => m.LoginPageModule)
  },

  {
    path: 'cliente',
    loadChildren: () => import('./pages/cliente/cliente.module').then(m => m.ClientePageModule),
    canActivate: [AuthGuard],
    data: { roles: ['cliente'] }
  },

  {
    path: 'profesor',
    loadChildren: () => import('./pages/profesor/profesor.module').then(m => m.ProfesorPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['profesor'] }
  },

  {
    path: 'admin',
    loadChildren: () => import('./pages/admin/admin.module').then(m => m.AdminPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['admin'] }
  },

  {
    path: 'horarios',
    loadChildren: () => import('./pages/horarios/horarios.module').then(m => m.HorariosPageModule),
    canActivate: [AuthGuard],
    data: { roles: ['cliente', 'profesor', 'admin'] } // accesible para todos
  },

  {
    path: '',
    redirectTo: 'login',
    pathMatch: 'full'
  },
  {
    path: 'alumnos-modal',
    loadChildren: () => import('./pages/alumnos-modal/alumnos-modal.module').then( m => m.AlumnosModalPageModule)
  },
  {
    path: 'admin-crear-usuario',
    loadChildren: () => import('./pages/admin-crear-usuario/admin-crear-usuario.module')
    .then( m => m.AdminCrearUsuarioPageModule)
  }
];

@NgModule({
  imports: [
    RouterModule.forRoot(routes, { preloadingStrategy: PreloadAllModules })
  ],
  exports: [RouterModule]
})
export class AppRoutingModule { }

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.spec.ts
------------------------------------------------------------------------------
import { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { TestBed } from '@angular/core/testing';

import { AppComponent } from './app.component';

describe('AppComponent', () => {

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [AppComponent],
      schemas: [CUSTOM_ELEMENTS_SCHEMA],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { HomePage } from './home.page';

describe('HomePage', () => {
  let component: HomePage;
  let fixture: ComponentFixture<HomePage>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [HomePage],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(HomePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { HomePage } from './home.page';

const routes: Routes = [
  {
    path: '',
    component: HomePage,
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class HomePageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';
import { FormsModule } from '@angular/forms';
import { HomePage } from './home.page';

import { HomePageRoutingModule } from './home-routing.module';


@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    HomePageRoutingModule
  ],
  declarations: [HomePage]
})
export class HomePageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';

@Component({
  selector: 'app-home',
  templateUrl: 'home.page.html',
  styleUrls: ['home.page.scss'],
  standalone: false,
})
export class HomePage {

  constructor() {}

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.scss
------------------------------------------------------------------------------
#container {
  text-align: center;

  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
}

#container strong {
  font-size: 20px;
  line-height: 26px;
}

#container p {
  font-size: 16px;
  line-height: 22px;

  color: #8c8c8c;

  margin: 0;
}

#container a {
  text-decoration: none;
}
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/home/home.page.html
------------------------------------------------------------------------------
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Blank
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Blank</ion-title>
    </ion-toolbar>
  </ion-header>

  <div id="container">
    <strong>Ready to create an app?</strong>
    <p>Start with Ionic <a target="_blank" rel="noopener noreferrer" href="https://ionicframework.com/docs/components">UI Components</a></p>
  </div>
</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AuthService } from './services/auth.service';
import { Router } from '@angular/router';

interface MenuItem {
  title: string;
  url: string;
  icon: string;
}

@Component({
  selector: 'app-root',
  standalone: false,
  templateUrl: 'app.component.html',
})
export class AppComponent implements OnInit {

  menuItems: MenuItem[] = [];

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  ngOnInit() {
    this.loadMenu();
  }

  loadMenu() {
    const user = this.auth.getUser();
    if (!user) return;

    if (user.rol === 'cliente') {
      this.menuItems = [
        { title: 'Inicio', url: '/cliente', icon: 'home-outline' },
        { title: 'Horarios', url: '/horarios', icon: 'calendar-outline' },
        { title: 'Mis reservas', url: '/cliente', icon: 'bookmark-outline' },
      ];
    }

    if (user.rol === 'profesor') {
      this.menuItems = [
        { title: 'Mis clases', url: '/profesor', icon: 'fitness-outline' },
        { title: 'Horarios', url: '/horarios', icon: 'calendar-outline' },
      ];
    }

    if (user.rol === 'admin') {
      this.menuItems = [
        { title: 'Usuarios', url: '/admin', icon: 'people-outline' },
        { title: 'Clases', url: '/admin', icon: 'barbell-outline' },
        { title: 'Pagos', url: '/admin', icon: 'card-outline' },
      ];
    }
  }

  logout() {
    this.auth.logout();
    this.router.navigate(['/login']);
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.component.html
------------------------------------------------------------------------------
<ion-app>

  <ion-menu contentId="main-content">
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Cosmos Fitness</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <ion-list>

        <ion-item *ngFor="let item of menuItems" [routerLink]="item.url">
          <ion-icon [name]="item.icon" slot="start"></ion-icon>
          <ion-label>{{ item.title }}</ion-label>
        </ion-item>

        <ion-item button color="danger" (click)="logout()">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          <ion-label>Cerrar sesi√≥n</ion-label>
        </ion-item>

      </ion-list>
    </ion-content>
  </ion-menu>

  <!-- AQU√ç EL CAMBIO -->
  <ion-router-outlet id="main-content"></ion-router-outlet>

</ion-app>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/app.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { RouteReuseStrategy } from '@angular/router';
import { IonicModule, IonicRouteStrategy } from '@ionic/angular';
import { AppComponent } from './app.component';
import { AppRoutingModule } from './app-routing.module';
import { FormsModule } from '@angular/forms';
import { HttpClientModule } from '@angular/common/http';



@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, 
    IonicModule.forRoot(),
     AppRoutingModule,
     FormsModule,
     HttpClientModule],
  providers: [{ provide: RouteReuseStrategy, useClass: IonicRouteStrategy }],
  bootstrap: [AppComponent],
  
})



export class AppModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar>
    <ion-title>Cosmos Fitness</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div style="max-width: 400px; margin: auto; margin-top: 15vh;">

    <ion-card>
      <ion-card-header>
        <ion-card-title>Iniciar sesi√≥n</ion-card-title>
      </ion-card-header>

      <ion-card-content>

        <ion-item>
          <ion-label position="floating">Email</ion-label>
          <ion-input
            type="email"
            [(ngModel)]="email"
            required>
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Contrase√±a</ion-label>
          <ion-input
            type="password"
            [(ngModel)]="password"
            required>
          </ion-input>
        </ion-item>

        <!-- Mensaje de error -->
        <ion-text color="danger" *ngIf="errorMsg">
          <p style="margin-top: 10px;">{{ errorMsg }}</p>
        </ion-text>

        <!-- Bot√≥n login -->
        <ion-button
          expand="block"
          color="primary"
          style="margin-top: 20px;"
          (click)="login()"
          [disabled]="loading">

          <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
          <span *ngIf="!loading">Entrar</span>

        </ion-button>

      </ion-card-content>
    </ion-card>

  </div>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from '../../services/auth.service';

@Component({
  selector: 'app-login',
  standalone: false,
  templateUrl: './login.page.html',
})
export class LoginPage {

  email = '';
  password = '';

  loading = false;
  errorMsg = '';

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  login() {
    this.loading = true;
    this.errorMsg = '';

    this.auth.login(this.email, this.password).subscribe({
      next: user => {
        this.loading = false;
        this.auth.saveUser(user);

        switch (user.rol) {
          case 'cliente':
            this.router.navigate(['/cliente']);
            break;
          case 'profesor':
            this.router.navigate(['/profesor']);
            break;
          case 'admin':
            this.router.navigate(['/admin']);
            break;
          default:
            this.router.navigate(['/home']);
        }
      },
      error: err => {
        this.loading = false;

        if (err.status === 401) {
          this.errorMsg = 'Credenciales incorrectas';
        } else {
          this.errorMsg = 'Error de conexi√≥n con el servidor';
        }
      }
    });
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { LoginPage } from './login.page';

describe('LoginPage', () => {
  let component: LoginPage;
  let fixture: ComponentFixture<LoginPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(LoginPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { LoginPageRoutingModule } from './login-routing.module';

import { LoginPage } from './login.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    LoginPageRoutingModule
  ],
  declarations: [LoginPage]
})
export class LoginPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/login/login-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { LoginPage } from './login.page';

const routes: Routes = [
  {
    path: '',
    component: LoginPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class LoginPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { HorariosPage } from './horarios.page';

describe('HorariosPage', () => {
  let component: HorariosPage;
  let fixture: ComponentFixture<HorariosPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(HorariosPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Horarios disponibles</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="horarios.length > 0; else sinHorarios">

    <ion-item *ngFor="let h of horarios">
      <ion-label>
        <h2>{{ h.Clase?.nombre_clase }}</h2>
        <p>{{ h.fecha }} ¬∑ {{ h.hora_inicio }} - {{ h.hora_fin }}</p>
        <p>{{ h.lugar }}</p>
        <p>
          Profesor:
          {{ h.Clase?.profesor?.nombre }}
          {{ h.Clase?.profesor?.apellidos }}
        </p>
        <p>
            Plazas:
            {{ h.plazas_ocupadas }} / {{ h.plazas_totales }}
        </p>
      </ion-label>
<ion-button
  slot="end"
  color="success"
  fill="outline"
  [disabled]="!h.plazas_disponibles || h.ya_reservado"
  (click)="reservar(h)">

  <ng-container *ngIf="h.ya_reservado">
    Ya reservado
  </ng-container>

  <ng-container *ngIf="!h.ya_reservado && !h.plazas_disponibles">
    Completo
  </ng-container>

  <ng-container *ngIf="!h.ya_reservado && h.plazas_disponibles">
    Reservar
  </ng-container>

</ion-button>

    </ion-item>

  </ion-list>

  <ng-template #sinHorarios>
    <ion-text color="medium">
      <p>No hay horarios disponibles.</p>
    </ion-text>
  </ng-template>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { HorariosPage } from './horarios.page';

const routes: Routes = [
  {
    path: '',
    component: HorariosPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class HorariosPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { HorarioService } from '../../services/horario.service';
import { ReservaService } from '../../services/reserva.service';
import { AuthService } from '../../services/auth.service';
import { AlertController } from '@ionic/angular';

@Component({
  selector: 'app-horarios',
  templateUrl: './horarios.page.html',
  styleUrls: ['./horarios.page.scss'],
  standalone: false,
})
export class HorariosPage implements OnInit {

  horarios: any[] = [];
  user: any;

  constructor(
    private horarioService: HorarioService,
    private reservaService: ReservaService,
    private auth: AuthService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
  }

  cargarHorarios() {
    this.horarioService.getHorarios(this.user.id_usuario).subscribe({
      next: data => this.horarios = data,
      error: err => console.error(err)
    });
  }

  reservar(horario: any) {
    this.reservaService.crearReserva({
      id_cliente: this.user.id_usuario,
      id_horario: horario.id_horario
    }).subscribe({
      next: () => this.cargarHorarios(),
      error: err => this.mostrarError(err.error?.error || 'Error al reservar')
    });
  }

  async mostrarError(msg: string) {
    const alert = await this.alertCtrl.create({
      header: 'Reserva',
      message: msg,
      buttons: ['OK']
    });
    await alert.present();
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/horarios/horarios.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { HorariosPageRoutingModule } from './horarios-routing.module';

import { HorariosPage } from './horarios.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    HorariosPageRoutingModule
  ],
  declarations: [HorariosPage]
})
export class HorariosPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';

import { ClientePageRoutingModule } from './cliente-routing.module';
import { ClientePage } from './cliente.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ClientePageRoutingModule
  ],
  declarations: [ClientePage]
})
export class ClientePageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mis reservas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="reservas.length > 0; else sinReservas">

  <ion-item *ngFor="let r of reservas">
    <ion-label>
      <h2>{{ r.Horario?.Clase?.nombre_clase }}</h2>

      <p>
        {{ r.Horario?.fecha }}
        ¬∑ {{ r.Horario?.hora_inicio }} - {{ r.Horario?.hora_fin }}
      </p>

      <p>
        Profesor:
        {{ r.Horario?.Clase?.profesor?.nombre }}
        {{ r.Horario?.Clase?.profesor?.apellidos }}
      </p>

      <ion-badge
        [color]="r.estado === 'activa' ? 'success' : 'medium'">
        {{ r.estado | uppercase }}
      </ion-badge>
    </ion-label>

    <ion-button
      *ngIf="r.estado === 'activa'"
      color="danger"
      fill="outline"
      slot="end"
      (click)="cancelar(r)">
      Cancelar
    </ion-button>

  </ion-item>

</ion-list>

<ng-template #sinReservas>
  <ion-text color="medium">
    <p>No tienes reservas.</p>
  </ion-text>
</ng-template>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AlertController } from '@ionic/angular';
import { ReservaService } from '../../services/reserva.service';
import { HorarioService } from '../../services/horario.service';
import { AuthService } from '../../services/auth.service';

@Component({
  selector: 'app-cliente',
  standalone: false,
  templateUrl: './cliente.page.html',
  styleUrls: ['./cliente.page.scss']
})
export class ClientePage implements OnInit {

  user: any;

  // üîπ NUEVO
  horarios: any[] = [];

  // üîπ EXISTENTE
  reservas: any[] = [];

  constructor(
    private reservaService: ReservaService,
    private horarioService: HorarioService,
    private auth: AuthService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
    this.cargarReservas();
  }

  // =====================
  // HORARIOS
  // =====================
  cargarHorarios() {
    this.horarioService.getHorarios(this.user.id_usuario).subscribe({
      next: data => this.horarios = data,
      error: err => console.error(err)
    });
  }

  get tieneReservasActivas(): boolean {
  return this.reservas.some(r => r.estado === 'activa');
}

  reservar(idHorario: number) {
    this.reservaService.crearReserva({
      id_cliente: this.user.id_usuario,
      id_horario: idHorario
    }).subscribe({
      next: () => {
        this.cargarReservas();
        alert('Reserva realizada ‚úÖ');
      },
      error: err => {
        alert(err.error?.error || 'No se pudo reservar');
      }
    });
  }

 
  cargarReservas() {
    this.reservaService.getReservasCliente(this.user.id_usuario)
      .subscribe({
        next: data => this.reservas = data,
        error: err => console.error(err)
      });
  }

  async cancelar(reserva: any) {
    const alert = await this.alertCtrl.create({
      header: 'Cancelar reserva',
      message: '¬øSeguro que deseas cancelar esta reserva?',
      buttons: [
        { text: 'No', role: 'cancel' },
        {
          text: 'S√≠, cancelar',
          handler: () => {
            this.reservaService
              .cancelarReserva(reserva.id_reserva)
              .subscribe(() => this.cargarReservas());
          }
        }
      ]
    });

    await alert.present();
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ClientePage } from './cliente.page';

describe('ClientePage', () => {
  let component: ClientePage;
  let fixture: ComponentFixture<ClientePage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(ClientePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/cliente/cliente-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ClientePage } from './cliente.page';

const routes: Routes = [
  {
    path: '',
    component: ClientePage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ClientePageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AdminPage } from './admin.page';

describe('AdminPage', () => {
  let component: AdminPage;
  let fixture: ComponentFixture<AdminPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AdminPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';

import { UsuarioService } from '../../services/usuario.service';
import { AlertController } from '@ionic/angular';

@Component({
  selector: 'app-admin',
  templateUrl: './admin.page.html',
  standalone: false,
  styleUrls: ['./admin.page.scss'],
})
export class AdminPage implements OnInit {

  usuarios:any[] = [];

  constructor(
    private usuarioService: UsuarioService,
    private alertCtrl: AlertController
  ) {}

  ngOnInit() {
    this.cargarUsuarios();
  }

  cargarUsuarios() {
    this.usuarioService.getUsuariosAdmin()
      .subscribe((data:any[]) => this.usuarios = data);
  }

  toggle(usuario:any) {
    this.usuarioService.toggleActivo(usuario.id_usuario)
      .subscribe(() => this.cargarUsuarios());
  }

  async crearUsuario() {

  const alert = await this.alertCtrl.create({
    header: 'Nuevo usuario',
    inputs: [
      { name: 'nombre', placeholder: 'Nombre', type: 'text' },
      { name: 'apellidos', placeholder: 'Apellidos', type: 'text' },
      { name: 'email', placeholder: 'Email', type: 'email' },
      { name: 'password', placeholder: 'Contrase√±a', type: 'password' },
      { name: 'telefono', placeholder: 'Tel√©fono', type: 'text' },
      {
        name: 'rol',
        type: 'radio',
        label: 'Cliente',
        value: 'cliente',
        checked: true
      },
      {
        name: 'rol',
        type: 'radio',
        label: 'Profesor',
        value: 'profesor'
      }
    ],
    buttons: [
      { text: 'Cancelar', role: 'cancel' },
      {
        text: 'Crear',
        handler: (data) => {

          const payload = {
            nombre: data.nombre,
            apellidos: data.apellidos,
            email: data.email,
            password_hash: data.password,
            telefono: data.telefono,
            rol: data.rol
          };

          this.usuarioService.crearUsuarioAdmin(payload)
            .subscribe(() => this.cargarUsuarios());
        }
      }
    ]
  });

  await alert.present();
}

}
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AdminPage } from './admin.page';

const routes: Routes = [
  {
    path: '',
    component: AdminPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AdminPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="dark">
    <ion-title>Panel Admin</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-button expand="block" routerLink="/admin-crear-usuario">
  Crear usuario
  </ion-button >


  <ion-list>


    <ion-item *ngFor="let u of usuarios">

      <ion-label>
        <h2>{{u.nombre}} {{u.apellidos}}</h2>
        <p>{{u.email}}</p>
        <p>Rol: {{u.rol}}</p>
      </ion-label>

      <ion-chip [color]="u.activo ? 'success' : 'danger'">
  <ion-label>
    {{ u.activo ? 'Activo' : 'Desactivado' }}
  </ion-label>
</ion-chip>


      <ion-button
      [disabled]="u.rol === 'admin'"

        slot="end"
        fill="outline"
        (click)="toggle(u)">
        Toggle
      </ion-button>

    </ion-item>

  </ion-list>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AdminPageRoutingModule } from './admin-routing.module';

import { AdminPage } from './admin.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AdminPageRoutingModule
  ],
  declarations: [AdminPage]
})
export class AdminPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin/admin.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mis clases</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-card *ngFor="let h of horarios" class="ion-margin-bottom">

    <ion-card-header>
      <ion-card-title>
        {{ h.Clase.nombre_clase }}
      </ion-card-title>

      <ion-card-subtitle>
        {{ h.fecha }} ¬∑ {{ h.hora_inicio }} - {{ h.hora_fin }}
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>

      <p><strong>Lugar:</strong> {{ h.lugar }}</p>

      <p>
        <strong>Plazas:</strong>
        {{ h.plazas_ocupadas }} / {{ h.plazas_totales }}
      </p>

      <!-- Estado -->
      <ion-chip
        [color]="h.reservas_abiertas ? 'success' : 'danger'">
        <ion-label>
          {{ h.reservas_abiertas ? 'Reservas abiertas' : 'Reservas cerradas' }}
        </ion-label>
      </ion-chip>

      <ion-grid class="ion-margin-top">
        <ion-row>

          <!-- VER ALUMNOS -->
          <ion-col size="6">
            <ion-button
              expand="block"
              fill="outline"
              (click)="verAlumnos(h)">
              Ver alumnos
            </ion-button>
          </ion-col>

          <!-- ABRIR / CERRAR -->
          <ion-col size="6">
            <ion-button
              expand="block"
              [color]="h.reservas_abiertas ? 'warning' : 'success'"
              (click)="cambiarEstado(h)">

              {{ h.reservas_abiertas ? 'Cerrar reservas' : 'Abrir reservas' }}

            </ion-button>
          </ion-col>

        </ion-row>
      </ion-grid>

      <!-- LISTA DE ALUMNOS INLINE -->
      <ion-list *ngIf="h.Reservas?.length">

        <ion-item *ngFor="let r of h.Reservas">

          <ion-label>
            {{ r.Usuario.nombre }}
            {{ r.Usuario.apellidos }}
          </ion-label>

          <ion-button
            color="danger"
            fill="clear"
            (click)="cancelarAlumno(r)">
            Cancelar
          </ion-button>

        </ion-item>

      </ion-list>

    </ion-card-content>
  </ion-card>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.ts
------------------------------------------------------------------------------
import { Component, OnInit } from '@angular/core';
import { AlertController } from '@ionic/angular';
import { HorarioService } from '../../services/horario.service';
import { AuthService } from '../../services/auth.service';
import { ReservaService } from '../../services/reserva.service';
import { ModalController } from '@ionic/angular';
import { AlumnosModalPage } from '../alumnos-modal/alumnos-modal.page';




@Component({
  selector: 'app-profesor',
  templateUrl: './profesor.page.html',
  styleUrls: ['./profesor.page.scss'],
  standalone: false
})
export class ProfesorPage implements OnInit {

  horarios: any[] = [];
  user: any;

  constructor(
    private horarioService: HorarioService,
    private auth: AuthService,
    private reservaService: ReservaService,
    private alertCtrl: AlertController,
    private modalCtrl: ModalController

  ) {}

  ngOnInit() {
    this.user = this.auth.getUser();
    this.cargarHorarios();
  }

  cargarHorarios() {
    this.horarioService.getHorariosProfesor(this.user.id_usuario)
      .subscribe({
        next: data => this.horarios = data,
        error: err => console.error(err)
      });
  }

  async cancelarAlumno(reserva: any) {

  const alert = await this.alertCtrl.create({
    header: 'Cancelar reserva',
    message: `¬øCancelar la reserva de ${reserva.Usuario.nombre} ${reserva.Usuario.apellidos}?`,
    buttons: [
      { text: 'No', role: 'cancel' },
      {
        text: 'S√≠',
        handler: () => {
          this.reservaService.forzarCancelacion(reserva.id_reserva)
            .subscribe(() => this.cargarHorarios());
        }
      }
    ]
  });

  await alert.present();
}
async verAlumnos(horario: any) {

  const modal = await this.modalCtrl.create({
    component: AlumnosModalPage,
    componentProps: {
      reservas: horario.Reservas
    }
  });

  await modal.present();

}



  async cambiarEstado(horario: any) {

    const accion = horario.reservas_abiertas ? 'cerrar' : 'abrir';

    const alert = await this.alertCtrl.create({
      header: 'Confirmar',
      message: `¬øDeseas ${accion} las reservas de este horario?`,
      buttons: [
        { text: 'Cancelar', role: 'cancel' },
        {
          text: 'S√≠',
          handler: () => {
            const obs = horario.reservas_abiertas
              ? this.horarioService.cerrarReservas(horario.id_horario)
              : this.horarioService.abrirReservas(horario.id_horario);

            obs.subscribe(() => this.cargarHorarios());
          }
        }
      ]
    });

    await alert.present();
  }
}




------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ProfesorPage } from './profesor.page';

describe('ProfesorPage', () => {
  let component: ProfesorPage;
  let fixture: ComponentFixture<ProfesorPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(ProfesorPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ProfesorPage } from './profesor.page';

const routes: Routes = [
  {
    path: '',
    component: ProfesorPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ProfesorPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/profesor/profesor.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { ProfesorPageRoutingModule } from './profesor-routing.module';

import { ProfesorPage } from './profesor.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ProfesorPageRoutingModule
  ],
  declarations: [ProfesorPage]
})
export class ProfesorPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AlumnosModalPageRoutingModule } from './alumnos-modal-routing.module';

import { AlumnosModalPage } from './alumnos-modal.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AlumnosModalPageRoutingModule
  ],
  declarations: [AlumnosModalPage]
})
export class AlumnosModalPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AlumnosModalPage } from './alumnos-modal.page';

const routes: Routes = [
  {
    path: '',
    component: AlumnosModalPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AlumnosModalPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Alumnos inscritos</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="cerrar()">Cerrar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-list *ngIf="reservas.length; else vacio">

    <ion-item *ngFor="let r of reservas">

      <ion-label>
        <h2>
          {{ r.Usuario.nombre }}
          {{ r.Usuario.apellidos }}
        </h2>
      </ion-label>

      <ion-button
        color="danger"
        fill="outline"
        (click)="cancelar(r)">
        Cancelar
      </ion-button>

    </ion-item>

  </ion-list>

  <ng-template #vacio>
    <ion-text color="medium">
      No hay alumnos inscritos.
    </ion-text>
  </ng-template>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AlumnosModalPage } from './alumnos-modal.page';

describe('AlumnosModalPage', () => {
  let component: AlumnosModalPage;
  let fixture: ComponentFixture<AlumnosModalPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AlumnosModalPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/alumnos-modal/alumnos-modal.page.ts
------------------------------------------------------------------------------
import { Component, Input } from '@angular/core';
import { ModalController } from '@ionic/angular';
import { ReservaService } from '../../services/reserva.service';

@Component({
  selector: 'app-alumnos-modal',
  templateUrl: './alumnos-modal.page.html',
  styleUrls: ['./alumnos-modal.page.scss'],
  standalone:false
})
export class AlumnosModalPage {

  @Input() reservas: any[] = [];

  constructor(
    private modalCtrl: ModalController,
    private reservaService: ReservaService
  ) {}

  cerrar() {
    this.modalCtrl.dismiss();
  }

  cancelar(reserva: any) {
    this.reservaService
      .forzarCancelacion(reserva.id_reserva)
      .subscribe(() => {

        // eliminar de la lista visualmente
        this.reservas = this.reservas.filter(
          r => r.id_reserva !== reserva.id_reserva
        );

      });
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AdminCrearUsuarioPageRoutingModule } from './admin-crear-usuario-routing.module';

import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AdminCrearUsuarioPageRoutingModule
  ],
  declarations: [AdminCrearUsuarioPage]
})
export class AdminCrearUsuarioPageModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.spec.ts
------------------------------------------------------------------------------
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

describe('AdminCrearUsuarioPage', () => {
  let component: AdminCrearUsuarioPage;
  let fixture: ComponentFixture<AdminCrearUsuarioPage>;

  beforeEach(() => {
    fixture = TestBed.createComponent(AdminCrearUsuarioPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.ts
------------------------------------------------------------------------------
import { Component } from '@angular/core';
import { UsuarioService } from '../../services/usuario.service';
import { AlertController } from '@ionic/angular';
import { Router } from '@angular/router';

@Component({
  selector: 'app-admin-crear-usuario',
  templateUrl: './admin-crear-usuario.page.html',
  styleUrls: ['./admin-crear-usuario.page.scss'],
  standalone:false
})
export class AdminCrearUsuarioPage {

  usuario: any = {
    rol: 'cliente'
  };

  constructor(
    private usuarioService: UsuarioService,
    private alertCtrl: AlertController,
    private router: Router
  ) {}

  async crearUsuario() {

    if (!this.usuario.nombre || !this.usuario.email || !this.usuario.password_hash) {
      return this.mostrarAlert('Faltan campos obligatorios');
    }

    this.usuarioService.crearUsuario(this.usuario)
      .subscribe({
        next: async () => {

          const alert = await this.alertCtrl.create({
            header: '√âxito',
            message: 'Usuario creado correctamente',
            buttons: ['OK']
          });

          await alert.present();

          this.router.navigate(['/admin']);
        },
        error: err => {
          this.mostrarAlert(err.error?.error || 'Error creando usuario');
        }
      });
  }

  async mostrarAlert(msg:string){
    const alert = await this.alertCtrl.create({
      header:'Error',
      message:msg,
      buttons:['OK']
    });

    await alert.present();
  }

}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.html
------------------------------------------------------------------------------
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Crear usuario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-item>
    <ion-input label="Nombre" [(ngModel)]="usuario.nombre"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Apellidos" [(ngModel)]="usuario.apellidos"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Email" [(ngModel)]="usuario.email"></ion-input>
  </ion-item>

  <ion-item>
    <ion-input 
      label="Contrase√±a"
      type="password"
      [(ngModel)]="usuario.password_hash">
    </ion-input>
  </ion-item>

  <ion-item>
    <ion-input label="Tel√©fono" [(ngModel)]="usuario.telefono"></ion-input>
  </ion-item>

  <ion-item>
    <ion-select label="Rol" [(ngModel)]="usuario.rol">
      <ion-select-option value="cliente">Cliente</ion-select-option>
      <ion-select-option value="profesor">Profesor</ion-select-option>
      <ion-select-option value="admin">Admin</ion-select-option>
    </ion-select>
  </ion-item>

  <ion-button expand="block" (click)="crearUsuario()">
    Crear usuario
  </ion-button>

</ion-content>

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario-routing.module.ts
------------------------------------------------------------------------------
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AdminCrearUsuarioPage } from './admin-crear-usuario.page';

const routes: Routes = [
  {
    path: '',
    component: AdminCrearUsuarioPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AdminCrearUsuarioPageRoutingModule {}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/pages/admin-crear-usuario/admin-crear-usuario.page.scss
------------------------------------------------------------------------------

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/guards/auth-guard.spec.ts
------------------------------------------------------------------------------
import { TestBed } from '@angular/core/testing';
import { CanActivateFn } from '@angular/router';

import { authGuard } from './auth-guard';

describe('authGuard', () => {
  const executeGuard: CanActivateFn = (...guardParameters) => 
      TestBed.runInInjectionContext(() => authGuard(...guardParameters));

  beforeEach(() => {
    TestBed.configureTestingModule({});
  });

  it('should be created', () => {
    expect(executeGuard).toBeTruthy();
  });
});
d
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/app/guards/auth-guard.ts
------------------------------------------------------------------------------
import { Injectable } from '@angular/core';
import { CanActivate, ActivatedRouteSnapshot, Router } from '@angular/router';
import { AuthService } from '../services/auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {

  constructor(
    private auth: AuthService,
    private router: Router
  ) {}

  canActivate(route: ActivatedRouteSnapshot): boolean {

    const user = this.auth.getUser();

    if (!user) {
      this.router.navigate(['/login']);
      return false;
    }

    const allowedRoles = route.data['roles'] as string[];

    if (allowedRoles && !allowedRoles.includes(user.rol)) {
      // Redirigir a su panel correcto
      this.router.navigate(['/' + user.rol]);
      return false;
    }

    return true;
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/src/test.ts
------------------------------------------------------------------------------
// This file is required by karma.conf.js and loads recursively all the .spec and framework files

import 'zone.js/testing';
import { getTestBed } from '@angular/core/testing';
import {
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting
} from '@angular/platform-browser-dynamic/testing';

// First, initialize the Angular testing environment.
getTestBed().initTestEnvironment(
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting(),
);

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.gitignore
------------------------------------------------------------------------------
# Specifies intentionally untracked files to ignore when using Git
# http://git-scm.com/docs/gitignore

*~
*.sw[mnpcod]
.tmp
*.tmp
*.tmp.*
UserInterfaceState.xcuserstate
$RECYCLE.BIN/

*.log
log.txt


/.sourcemaps
/.versions
/coverage

# Ionic
/.ionic
/www
/platforms
/plugins

# Compiled output
/dist
/tmp
/out-tsc
/bazel-out

# Node
/node_modules
npm-debug.log
yarn-error.log

# IDEs and editors
.idea/
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-project
*.sublime-workspace

# Visual Studio Code
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
.history/*


# Miscellaneous
/.angular
/.angular/cache
.sass-cache/
/.nx
/.nx/cache
/connect.lock
/coverage
/libpeerconnection.log
testem.log
/typings

# System files
.DS_Store
Thumbs.db

node_modules/
.env
android/
ios/
dist/
build/


------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.editorconfig
------------------------------------------------------------------------------
# Editor configuration, see https://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
insert_final_newline = true
trim_trailing_whitespace = true

[*.ts]
quote_type = single

[*.md]
max_line_length = off
trim_trailing_whitespace = false

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/package.json
------------------------------------------------------------------------------
{
  "name": "app-ionic",
  "version": "0.0.1",
  "author": "Ionic Framework",
  "homepage": "https://ionicframework.com/",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "watch": "ng build --watch --configuration development",
    "test": "ng test",
    "lint": "ng lint"
  },
  "private": true,
  "dependencies": {
    "@angular/animations": "^20.0.0",
    "@angular/common": "^20.0.0",
    "@angular/compiler": "^20.0.0",
    "@angular/core": "^20.0.0",
    "@angular/forms": "^20.0.0",
    "@angular/platform-browser": "^20.0.0",
    "@angular/platform-browser-dynamic": "^20.0.0",
    "@angular/router": "^20.0.0",
    "@capacitor/app": "8.0.0",
    "@capacitor/core": "8.0.1",
    "@capacitor/haptics": "8.0.0",
    "@capacitor/keyboard": "8.0.0",
    "@capacitor/status-bar": "8.0.0",
    "@ionic/angular": "^8.0.0",
    "ionicons": "^7.0.0",
    "rxjs": "~7.8.0",
    "tslib": "^2.3.0",
    "zone.js": "~0.15.0"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "^20.0.0",
    "@angular-eslint/builder": "^20.0.0",
    "@angular-eslint/eslint-plugin": "^20.0.0",
    "@angular-eslint/eslint-plugin-template": "^20.0.0",
    "@angular-eslint/schematics": "^20.0.0",
    "@angular-eslint/template-parser": "^20.0.0",
    "@angular/cli": "^20.0.0",
    "@angular/compiler-cli": "^20.0.0",
    "@angular/language-service": "^20.0.0",
    "@capacitor/cli": "8.0.1",
    "@ionic/angular-toolkit": "^12.0.0",
    "@types/jasmine": "~5.1.0",
    "@typescript-eslint/eslint-plugin": "^8.18.0",
    "@typescript-eslint/parser": "^8.18.0",
    "eslint": "^9.16.0",
    "eslint-plugin-import": "^2.29.1",
    "eslint-plugin-jsdoc": "^48.2.1",
    "eslint-plugin-prefer-arrow": "1.2.2",
    "jasmine-core": "~5.1.0",
    "jasmine-spec-reporter": "~5.0.0",
    "karma": "~6.4.0",
    "karma-chrome-launcher": "~3.2.0",
    "karma-coverage": "~2.2.0",
    "karma-jasmine": "~5.1.0",
    "karma-jasmine-html-reporter": "~2.1.0",
    "typescript": "~5.9.0"
  },
  "description": "An Ionic project"
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.spec.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/spec",
    "types": [
      "jasmine"
    ]
  },
  "files": [
    "src/test.ts",
    "src/polyfills.ts"
  ],
  "include": [
    "src/**/*.spec.ts",
    "src/**/*.d.ts"
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/capacitor.config.json
------------------------------------------------------------------------------
{}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.eslintrc.json
------------------------------------------------------------------------------
{
  "root": true,
  "ignorePatterns": ["projects/**/*"],
  "overrides": [
    {
      "files": ["*.ts"],
      "parserOptions": {
        "project": ["tsconfig.json"],
        "createDefaultProgram": true
      },
      "extends": [
        "plugin:@angular-eslint/recommended",
        "plugin:@angular-eslint/template/process-inline-templates"
      ],
      "rules": {
        "@angular-eslint/prefer-standalone": "off",
        "@angular-eslint/component-class-suffix": [
          "error",
          {
            "suffixes": ["Page", "Component"]
          }
        ],
        "@angular-eslint/component-selector": [
          "error",
          {
            "type": "element",
            "prefix": "app",
            "style": "kebab-case"
          }
        ],
        "@angular-eslint/directive-selector": [
          "error",
          {
            "type": "attribute",
            "prefix": "app",
            "style": "camelCase"
          }
        ]
      }
    },
    {
      "files": ["*.html"],
      "extends": ["plugin:@angular-eslint/template/recommended"],
      "rules": {}
    }
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.browserslistrc
------------------------------------------------------------------------------
# This file is used by the build system to adjust CSS and JS output to support the specified browsers below.
# For additional information regarding the format and rule options, please see:
# https://github.com/browserslist/browserslist#queries

# For the full list of supported browsers by the Angular framework, please see:
# https://angular.dev/reference/versions#browser-support

# You can see what browsers were selected by your queries by running:
#   npx browserslist

Chrome >=107
Firefox >=106
Edge >=107
Safari >=16.1
iOS >=16.1

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/ionic.config.json
------------------------------------------------------------------------------
{
  "name": "app-ionic",
  "integrations": {
    "capacitor": {}
  },
  "type": "angular"
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.app.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/app",
    "types": []
  },
  "files": [
    "src/main.ts",
    "src/polyfills.ts"
  ],
  "include": [
    "src/**/*.d.ts"
  ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/capacitor.config.ts
------------------------------------------------------------------------------
import type { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'io.ionic.starter',
  appName: 'app-ionic',
  webDir: 'www'
};

export default config;

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/tsconfig.json
------------------------------------------------------------------------------
/* To learn more about this file see: https://angular.io/config/tsconfig. */
{
  "compileOnSave": false,
  "compilerOptions": {
    "baseUrl": "./",
    "outDir": "./dist/out-tsc",
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "sourceMap": true,
    "declaration": false,
    "downlevelIteration": true,
    "experimentalDecorators": true,
    "moduleResolution": "node",
    "importHelpers": true,
    "target": "es2022",
    "module": "es2020",
    "lib": [
      "es2018",
      "dom"
    ],
    "skipLibCheck": true,
    "useDefineForClassFields": false
  },
  "angularCompilerOptions": {
    "enableI18nLegacyMessageIdFormat": false,
    "strictInjectionParameters": true,
    "strictInputAccessModifiers": true,
    "strictTemplates": true
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.vscode/extensions.json
------------------------------------------------------------------------------
{
    "recommendations": [
       "Webnative.webnative"
    ]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/.vscode/settings.json
------------------------------------------------------------------------------
{
  "typescript.preferences.autoImportFileExcludePatterns": ["@ionic/angular/common", "@ionic/angular/standalone"]
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/angular.json
------------------------------------------------------------------------------
{
  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
  "version": 1,
  "newProjectRoot": "projects",
  "projects": {
    "app": {
      "projectType": "application",
      "schematics": {},
      "root": "",
      "sourceRoot": "src",
      "prefix": "app",
      "architect": {
        "build": {
          "builder": "@angular-devkit/build-angular:browser",
          "options": {
            "outputPath": "www",
            "index": "src/index.html",
            "main": "src/main.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "tsconfig.app.json",
            "inlineStyleLanguage": "scss",
            "assets": [
              {
                "glob": "**/*",
                "input": "src/assets",
                "output": "assets"
              },
              {
                "glob": "**/*.svg",
                "input": "node_modules/ionicons/dist/ionicons/svg",
                "output": "./svg"
              }
            ],
            "styles": ["src/global.scss", "src/theme/variables.scss"],
            "scripts": []
          },
          "configurations": {
            "production": {
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "2mb",
                  "maximumError": "5mb"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "2kb",
                  "maximumError": "4kb"
                }
              ],
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.prod.ts"
                }
              ],
              "outputHashing": "all"
            },
            "development": {
              "buildOptimizer": false,
              "optimization": false,
              "vendorChunk": true,
              "extractLicenses": false,
              "sourceMap": true,
              "namedChunks": true
            },
            "ci": {
              "progress": false
            }
          },
          "defaultConfiguration": "production"
        },
        "serve": {
          "builder": "@angular-devkit/build-angular:dev-server",
          "configurations": {
            "production": {
              "buildTarget": "app:build:production"
            },
            "development": {
              "buildTarget": "app:build:development"
            },
            "ci": {
              "progress": false
            }
          },
          "defaultConfiguration": "development"
        },
        "extract-i18n": {
          "builder": "@angular-devkit/build-angular:extract-i18n",
          "options": {
            "buildTarget": "app:build"
          }
        },
        "test": {
          "builder": "@angular-devkit/build-angular:karma",
          "options": {
            "main": "src/test.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "tsconfig.spec.json",
            "karmaConfig": "karma.conf.js",
            "inlineStyleLanguage": "scss",
            "assets": [
              {
                "glob": "**/*",
                "input": "src/assets",
                "output": "assets"
              },
              {
                "glob": "**/*.svg",
                "input": "node_modules/ionicons/dist/ionicons/svg",
                "output": "./svg"
              }
            ],
            "styles": ["src/global.scss", "src/theme/variables.scss"],
            "scripts": []
          },
          "configurations": {
            "ci": {
              "progress": false,
              "watch": false
            }
          }
        },
        "lint": {
          "builder": "@angular-eslint/builder:lint",
          "options": {
            "lintFilePatterns": [
              "src/**/*.ts",
              "src/**/*.html"
            ]
          }
        }
      }
    }
  },
  "cli": {
    "schematicCollections": [
      "@ionic/angular-toolkit"
    ],
    "analytics": false
  },
  "schematics": {
    "@ionic/angular-toolkit:component": {
      "styleext": "scss"
    },
    "@ionic/angular-toolkit:page": {
      "styleext": "scss"
    }
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/Dockerfile
------------------------------------------------------------------------------
FROM node:20
WORKDIR /app
COPY package*.json ./
# Instalamos CLI de forma global y dependencias locales
RUN npm install -g @ionic/cli && npm install
COPY . .
EXPOSE 8100
# --poll ayuda a que detecte cambios en vol√∫menes de Ubuntu/Docker
CMD ["ionic", "serve", "--host=0.0.0.0", "--port=8100", "--disable-host-check"]
------------------------------------------------------------------------------

[ARCHIVO]: ./ionic/app-ionic/karma.conf.js
------------------------------------------------------------------------------
// Karma configuration file, see link for more information
// https://karma-runner.github.io/1.0/config/configuration-file.html

module.exports = function (config) {
  config.set({
    basePath: '',
    frameworks: ['jasmine', '@angular-devkit/build-angular'],
    plugins: [
      require('karma-jasmine'),
      require('karma-chrome-launcher'),
      require('karma-jasmine-html-reporter'),
      require('karma-coverage'),
      require('@angular-devkit/build-angular/plugins/karma')
    ],
    client: {
      jasmine: {
        // you can add configuration options for Jasmine here
        // the possible options are listed at https://jasmine.github.io/api/edge/Configuration.html
        // for example, you can disable the random execution with `random: false`
        // or set a specific seed with `seed: 4321`
      },
      clearContext: false // leave Jasmine Spec Runner output visible in browser
    },
    jasmineHtmlReporter: {
      suppressAll: true // removes the duplicated traces
    },
    coverageReporter: {
      dir: require('path').join(__dirname, './coverage/app'),
      subdir: '.',
      reporters: [
        { type: 'html' },
        { type: 'text-summary' }
      ]
    },
    reporters: ['progress', 'kjhtml'],
    port: 9876,
    colors: true,
    logLevel: config.LOG_INFO,
    autoWatch: true,
    browsers: ['Chrome'],
    singleRun: false,
    restartOnFileChange: true
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./subirGithub.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo " üöÄ GESTOR DE GITHUB - COSMOS"
echo "=============================="

# ==============================
# Selecci√≥n de usuario
# ==============================

echo "üë§ ¬øQui√©n est√° realizando los cambios?"
echo " [ 1 ] - Domingo"
echo " [ 2 ] - D√°maris"
echo " [ 0 ] - Salir"
echo "------------------------------"
read -p "Selecciona una opci√≥n: " USER_OPTION

case $USER_OPTION in
    1)
        USER_NAME="Domingo"
        USER_EMAIL="domingojosenavarroorihuela@alumno.ieselrincon.es"
        ;;
    2)
        USER_NAME="D√°maris"
        USER_EMAIL="damarisvidalrodriguez@alumno.ieselrincon.es"
        ;;
    0)
        echo "üëã Saliendo."
        exit 0
        ;;
    *)
        echo "‚ùå Opci√≥n no v√°lida."
        exit 1
        ;;
esac

git config user.name "$USER_NAME"
git config user.email "$USER_EMAIL"

echo "‚úÖ Identidad configurada como: $USER_NAME"
echo ""

# ==============================
# Verificar repo
# ==============================

if [ ! -d ".git" ]; then
  echo "‚ùå Este directorio no es un repositorio git"
  exit 1
fi

# ==============================
# Men√∫ principal
# ==============================

echo "üìå ¬øQu√© deseas hacer?"
echo " [ 1 ] Subir cambios a DEVELOP"
echo " [ 2 ] Migrar DEVELOP ‚Üí MAIN"
echo " [ 0 ] Salir"
echo "------------------------------"
read -p "Selecciona una opci√≥n: " OPCION

# ==============================
# OPCI√ìN 1 ‚Üí DEVELOP
# ==============================

if [ "$OPCION" == "1" ]; then

    echo "üåø Cambiando a rama develop..."

    # Crear develop si no existe
    git checkout develop 2>/dev/null || git checkout -b develop

    echo "üìã Estado actual:"
    git status -s

    echo "‚ûï A√±adiendo archivos..."
    git add .

    read -p "‚úèÔ∏è  Mensaje del commit: " MENSAJE

    if [ -z "$MENSAJE" ]; then
      MENSAJE="Actualizaci√≥n en develop por $USER_NAME"
    fi

    git commit -m "$MENSAJE"

    echo "‚¨ÜÔ∏è Subiendo a develop..."
    git push -u origin develop

    echo ""
    echo "‚úÖ Cambios subidos a DEVELOP"
    echo "======================================"
fi


# ==============================
# OPCI√ìN 2 ‚Üí MERGE A MAIN
# ==============================

if [ "$OPCION" == "2" ]; then

    echo "‚ö†Ô∏è Vas a migrar DEVELOP ‚Üí MAIN"
    read -p "¬øEst√°s seguro? (yes/no): " CONFIRMACION

    if [ "$CONFIRMACION" != "yes" ]; then
        echo "Cancelado."
        exit 0
    fi

    echo "üåø Cambiando a main..."
    git checkout main

    echo "üîÑ Haciendo merge de develop..."
    git merge develop

    echo "‚¨ÜÔ∏è Subiendo main..."
    git push origin main

    echo ""
    echo "üöÄ DEVELOP MIGRADO A MAIN"
    echo "======================================"
fi


------------------------------------------------------------------------------

[ARCHIVO]: ./peticiones/test_api.sh
------------------------------------------------------------------------------
#!/bin/bash

API="http://localhost:3000"

echo "====================================="
echo "      üß™ TEST AUTOM√ÅTICO COSMOS"
echo "====================================="


##################################
echo ""
echo "1Ô∏è‚É£ Comprobando API..."
##################################

curl -s $API | jq .

if [ $? -ne 0 ]; then
  echo "‚ùå API no responde"
  exit 1
fi

echo "‚úÖ API OK"



##################################
echo ""
echo "2Ô∏è‚É£ Login ADMIN"
##################################

curl -s -X POST $API/login \
-H "Content-Type: application/json" \
-d '{"email":"admin@mail.com","password":"admin"}' | jq .

echo "‚úÖ Login admin OK"



##################################
echo ""
echo "3Ô∏è‚É£ Obtener bonos"
##################################

curl -s $API/bonos | jq .

echo "‚úÖ Bonos cargan"



##################################
echo ""
echo "4Ô∏è‚É£ Crear pago cliente 10"
##################################

curl -s -X POST $API/pagos \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_bono":2,
"metodo_pago":"tarjeta"
}' | jq .

echo "‚úÖ Pago creado"



##################################
echo ""
echo "5Ô∏è‚É£ Ver bono activo"
##################################

curl -s $API/pagos/cliente/10/activo | jq .

echo "‚úÖ Bono activo detectado"



##################################
echo ""
echo "6Ô∏è‚É£ Intentar reservar SIN bono (cliente 14)"
##################################

curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":14,
"id_horario":1
}' | jq .

echo "üëâ Debe devolver error 403"



##################################
echo ""
echo "7Ô∏è‚É£ Crear reserva v√°lida (cliente 10)"
##################################

RESERVA=$(curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_horario":1
}')

echo $RESERVA | jq .

RESERVA_ID=$(echo $RESERVA | jq -r '.id_reserva')

echo "Reserva ID: $RESERVA_ID"



##################################
echo ""
echo "8Ô∏è‚É£ Ver sesiones restantes"
##################################

curl -s $API/pagos/cliente/10 | jq .

echo "üëâ Debe ser 9"



##################################
echo ""
echo "9Ô∏è‚É£ Probar duplicado"
##################################

curl -s -X POST $API/reservas \
-H "Content-Type: application/json" \
-d '{
"id_cliente":10,
"id_horario":1
}' | jq .

echo "üëâ Debe decir 'Ya tienes una reserva activa'"



##################################
echo ""
echo "üîü Cancelar reserva"
##################################

curl -s -X PATCH $API/reservas/$RESERVA_ID/cancelar | jq .

echo "‚úÖ Reserva cancelada"



##################################
echo ""
echo "11Ô∏è‚É£ Ver reservas cliente"
##################################

curl -s $API/reservas/cliente/10 | jq .



echo ""
echo "====================================="
echo "       ‚úÖ TEST COMPLETADO"
echo "====================================="

------------------------------------------------------------------------------

[ARCHIVO]: ./lectura.sh
------------------------------------------------------------------------------
#!/bin/bash

# ==============================================================================
# SCRIPT DE INSPECCI√ìN ESENCIAL
# OBJETIVO: Mostrar solo c√≥digo fuente y archivos de configuraci√≥n clave.
# ==============================================================================

ROOT_DIR=${1:-"."}

# Validar existencia del directorio
[ ! -d "$ROOT_DIR" ] && echo "Error: Directorio no encontrado." && exit 1

echo "=============================================================================="
echo "RESUMEN EJECUTIVO DE C√ìDIGO FUENTE"
echo "=============================================================================="

# B√∫squeda selectiva:
# 1. Excluye node_modules, .git, y assets de imagen.
# 2. Excluye archivos de bloqueo (lock) y temporales.
find "$ROOT_DIR" \( -name "node_modules" -o -name ".git" -o -name "assets" -o -name ".angular" \) -prune -o \
    -type f \
    ! -name "package-lock.json" \
    ! -name "*.png" \
    ! -name "*.svg" \
    ! -name "*.ico" \
    ! -name "*.jpg" \
    -print | while read -r archivo; do

    echo -e "\n[ARCHIVO]: $archivo"
    echo "------------------------------------------------------------------------------"
    
    # Mostrar contenido
    cat "$archivo"
    
    echo -e "\n------------------------------------------------------------------------------"
done

echo "=============================================================================="
echo "INSPECCI√ìN FINALIZADA"
echo "=============================================================================="

------------------------------------------------------------------------------

[ARCHIVO]: ./docker-compose.yml
------------------------------------------------------------------------------
services:
  postgres:
    image: postgres:16
    container_name: postgres-db
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
      - "${POSTGRES_PORT}:5432"
    volumes:
    - postgres_data:/var/lib/postgresql/data
    - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 5s
      timeout: 5s
      retries: 10

  api:
    build: ./api
    container_name: api-node
    ports:
      - "${API_PORT}:3000"
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      DB_HOST: postgres
      DB_USER: ${POSTGRES_USER}
      DB_PASS: ${POSTGRES_PASSWORD}
      DB_NAME: ${POSTGRES_DB}
    volumes:
      - ./api:/app
      - /app/node_modules

  ionic:
    build: ./ionic/app-ionic
    container_name: ionic-app
    ports:
      - "${IONIC_PORT}:8100"
    depends_on:
      - api
    volumes:
      - ./ionic/app-ionic:/app
      - /app/node_modules

volumes:
  postgres_data:

------------------------------------------------------------------------------

[ARCHIVO]: ./db/init.sql
------------------------------------------------------------------------------

CREATE TABLE Usuario (
id_usuario SERIAL PRIMARY KEY,
nombre VARCHAR(100) NOT NULL,
apellidos VARCHAR(100) NOT NULL,
email VARCHAR(100) UNIQUE NOT NULL,
password_hash VARCHAR(255) NOT NULL,
telefono VARCHAR(20),
rol VARCHAR(20) NOT NULL,
fecha_registro DATE DEFAULT CURRENT_DATE
);
CREATE TABLE Bono_Plan (
id_bono SERIAL PRIMARY KEY,
nombre_bono VARCHAR(100) UNIQUE NOT NULL,
precio NUMERIC(10,2) NOT NULL,
duracion_dias INTEGER,
num_sesiones INTEGER,
descripcion TEXT
);
CREATE TABLE Pago (
id_pago SERIAL PRIMARY KEY,
id_cliente INTEGER NOT NULL,
id_bono INTEGER NOT NULL,
fecha_pago TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
monto NUMERIC(10,2) NOT NULL,
metodo_pago VARCHAR(50),
fecha_vencimiento DATE,
CONSTRAINT fk_pago_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_pago_bono FOREIGN KEY (id_bono)
REFERENCES Bono_Plan(id_bono)
);
CREATE TABLE Clase (
id_clase SERIAL PRIMARY KEY,
nombre_clase VARCHAR(100) NOT NULL,
descripcion TEXT,
capacidad_maxima INTEGER NOT NULL,
contenido_profesor TEXT,
id_profesor INTEGER NOT NULL,
CONSTRAINT fk_clase_profesor FOREIGN KEY (id_profesor)
REFERENCES Usuario(id_usuario)
);
CREATE TABLE Horario (
id_horario SERIAL PRIMARY KEY,
id_clase INTEGER NOT NULL,
fecha DATE NOT NULL,
hora_inicio TIME NOT NULL,
hora_fin TIME NOT NULL,
reservas_abiertas BOOLEAN DEFAULT true, -- üëà A√ëADE
lugar VARCHAR(100),
CONSTRAINT fk_horario_clase FOREIGN KEY (id_clase)
REFERENCES Clase(id_clase)
);


CREATE TABLE Reserva (
id_reserva SERIAL PRIMARY KEY,
id_cliente INTEGER NOT NULL,
id_horario INTEGER NOT NULL,
fecha_reserva TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
estado VARCHAR(20) NOT NULL,
CONSTRAINT fk_reserva_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_reserva_horario FOREIGN KEY (id_horario)
REFERENCES Horario(id_horario)
);
CREATE TABLE Rutina (
id_rutina SERIAL PRIMARY KEY,
nombre_rutina VARCHAR(100) NOT NULL,
descripcion TEXT,
fecha_asignacion DATE DEFAULT CURRENT_DATE,
id_cliente INTEGER NOT NULL,
id_profesor INTEGER NOT NULL,
CONSTRAINT fk_rutina_cliente FOREIGN KEY (id_cliente)
REFERENCES Usuario(id_usuario),
CONSTRAINT fk_rutina_profesor FOREIGN KEY (id_profesor)
REFERENCES Usuario(id_usuario)
);
------------------------------------------------------------------------------

[ARCHIVO]: ./texto.txt
------------------------------------------------------------------------------
prueba.
prueba2
------------------------------------------------------------------------------

[ARCHIVO]: ./.lectura.sh.swp
------------------------------------------------------------------------------
b0VIM 9.1      µ¥áiá1K " dno                                     dno-X570-Phantom-Gaming-4S              ~dno/ProyectoCosmos/lectura.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               utf-8U3210    #"! U                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 tp           `                            A       b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ad     ≥     `       £  ê  x  `  C  :  '    	    ›  √  i  Û  ‡  »  ∞  í  â  v  ^  V  O  ,    º  F  .      ˚  Ù  œ  µ  [  Â
  Œ
  «
  ´
  ë
  I
  ”	  ¿	  ®	  ô	  q	  i	  b	  D	  *	  ﬁ  h  P  8    ı  ÷  Õ  ∫  °  ô  í  r  X    í    h  a  @  %  “  \  E  >       ©  3      ¯  ﬁ  î      Û  ⁄  “  À  ∞  ñ  P  ⁄  ¬  ≥  ≤                               "bin": {       "license": "MIT",       "integrity": "sha512-+NYs2QeMWy+GWFOEm9xnn6HCDp0l7QBD7ml8zLUmJ+93Q5NF0NocErnwkTkXVFNiX3/fpC6afS8Dhb/gz7R7eg==",       "resolved": "https://registry.npmjs.org/uuid/-/uuid-8.3.2.tgz",       "version": "8.3.2",     "node_modules/uuid": {     },       }         "node": ">= 0.8"       "engines": {       "license": "MIT",       "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",       "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",       "version": "1.0.0",     "node_modules/unpipe": {     },       "license": "MIT"       "integrity": "sha512-Zz+aZWSj8LE6zoxD+xrjh4VfkIG8Ya6LvYkZqtUQGJPZjYl53ypCaUwWqo7eI0x66KBGeRo+mlBEkMSeSZ38Nw==",       "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-7.16.0.tgz",       "version": "7.16.0",     "node_modules/undici-types": {     },       "license": "MIT"       "integrity": "sha512-GMXzWtsc57XAtguZgaQViUOzs0KTkk8ojr3/xAxXLITqf/3EMwxC0inyETfDFjH/Krbhuep0HNbbjI9i/q3F3g==",       "resolved": "https://registry.npmjs.org/underscore/-/underscore-1.13.7.tgz",       "version": "1.13.7",     "node_modules/underscore": {     },       "license": "MIT"       "dev": true,       "integrity": "sha512-WxONCrssBM8TSPRqN5EmsjVrsv4A8X12J4ArBiiayv3DyyG3ZlIg6yysuuSYdZsVz3TKcTg2fd//Ujd4CHV1iA==",       "resolved": "https://registry.npmjs.org/undefsafe/-/undefsafe-2.0.5.tgz",       "version": "2.0.5",     "node_modules/undefsafe": {     },       }         "node": ">= 0.6"       "engines": {       },         "mime-types": "^3.0.0"         "media-typer": "^1.1.0",         "content-type": "^1.0.5",       "dependencies": {       "license": "MIT",       "integrity": "sha512-OZs6gsjF4vMp32qrCbiVSkrFmXtG/AZhY3t0iAMrMBiAZyV9oALtXO8hsrHbMXF9x6L3grlFuwW2oAz7cav+Gw==",       "resolved": "https://registry.npmjs.org/type-is/-/type-is-2.0.1.tgz",       "version": "2.0.1",     "node_modules/type-is": {     },       }         "nodetouch": "bin/nodetouch.js"       "bin": {       "license": "ISC",       "dev": true,       "integrity": "sha512-r0eojU4bI8MnHr8c5bNo7lJDdI2qXlWWJk6a9EAFG7vbhTjElYhBVS3/miuE0uOuoLdb8Mc/rVfsmm6eo5o9GA==",       "resolved": "https://registry.npmjs.org/touch/-/touch-3.1.1.tgz",       "version": "3.1.1",     "node_modules/touch": {     },       "license": "MIT"       "integrity": "sha512-OsLcGGbYF3rMjPUf8oKktyvCiUxSbqMMS39m33MAjLTC1DVIH6x3WSt63/M77ihI09+Sdfk1AXvfhCEeUmC7mg==",       "resolved": "https://registry.npmjs.org/toposort-class/-/toposort-class-1.0.1.tgz",       "version": "1.0.1",     "node_modules/toposort-class": {     },       }         "node": ">=0.6"       "engines": {       "license": "MIT",       "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",       "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",       "version": "1.0.1",     "node_modules/toidentifier": {     },       }         "node": ">=8.0"       "engines": {       },         "is-number": "^7.0.0"       "dependencies": {       "license": "MIT",       "dev": true,       "integrity": "sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==",       "resolved": "https://registry.npmjs.org/to-regex-range/-/to-regex-range-5.0.1.tgz",       "version": "5.0.1",     "node_modules/to-regex-range": {     },       }         "node": ">=4"       "engines": {       },         "has-flag": "^3.0.0"       "dependencies": {       "license": "MIT",       "dev": true, 2-QjVjwdXIt408MIiAqCX4oUKsgU2EqAGzs2Ppkm4aQYbjm+ZEWEcW4SfFNTr4uMNZma0ey4f5lgLrkB0aX0QMow==", ad  ‰  –     5       ‡  ÿ  —  ±  î  A  À  ≥  †  Ü  ~  w  \  B  ¸  Ü  n  [  B  :  3    ˇ  ª  E  -    ˙  Ú  Î  Œ  ¥  j  Ù
  ›
  ÷
  ∫
  †
  X
  ‚	   	  ∑	  ü	  ó	  ë	  ç	  ã	  ä	  â	  :	   	  —  –                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ------------------------------------------------------------------------------ ARCHIVO: ./api/Dockerfile ------------------------------------------------------------------------------   }   }     }       }         "node": ">=0.4"       "engines": {       "license": "MIT",       "integrity": "sha512-LKYU1iAXJXUgAXn9URjiu+MWhyUXHsvfp7mcuYm9dSUKK0/CjtrUwFAxD82/mCWbtLsGjFIad0wIsod4zrTAEQ==",       "resolved": "https://registry.npmjs.org/xtend/-/xtend-4.0.2.tgz",       "version": "4.0.2",     "node_modules/xtend": {     },       "license": "ISC"       "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==",       "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",       "version": "1.0.2",     "node_modules/wrappy": {     },       }         "@types/node": "*"       "dependencies": {       "license": "MIT",       "integrity": "sha512-Xng/d4Ichh8uN4l0FToV/258EjMGU9MGcA0HV2d9B/ZpZB3lqQm7nkOdZdm5GhKtLLhAE7PiVQwN4eN+2YJJUg==",       "resolved": "https://registry.npmjs.org/wkx/-/wkx-0.5.0.tgz",       "version": "0.5.0",     "node_modules/wkx": {     },       }         "node": ">= 0.8"       "engines": {       "license": "MIT",       "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",       "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",       "version": "1.1.2",     "node_modules/vary": {     },       }         "node": ">= 0.10"       "engines": {       "license": "MIT",       "integrity": "sha512-spH26xU080ydGggxRyR1Yhcbgx+j3y5jbNXk/8L+iRvdIEQ4uTRH2Sgf2dokud6Q4oAtsbNvJ1Ft+9xmm6IZcA==",       "resolved": "https://registry.npmjs.org/validator/-/validator-13.15.26.tgz",       "version": "13.15.26",     "node_modules/validator": {     },       }         "uuid": "dist/bin/uuid" 
------------------------------------------------------------------------------

[ARCHIVO]: ./.env
------------------------------------------------------------------------------
# Postgres
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin123
POSTGRES_DB=cosmos_db
POSTGRES_PORT=5432

# Backend
API_PORT=3000

# Frontend
IONIC_PORT=8100


------------------------------------------------------------------------------

[ARCHIVO]: ./win_start.ps1
------------------------------------------------------------------------------
Write-Host "=============================="
Write-Host "  INICIANDO COSMOS FITNESS"
Write-Host "=============================="

docker compose build
docker compose up -d

Write-Host "API: http://localhost:3000"
Write-Host "FRONTEND: http://localhost:8100"

------------------------------------------------------------------------------

[ARCHIVO]: ./start.sh
------------------------------------------------------------------------------
#!/bin/bash

echo "=============================="
echo "  INICIANDO COSMOS FITNESS"
echo "=============================="

if ! command -v docker &> /dev/null
then
    echo "‚ùå Docker no est√° instalado"
    exit 1
fi

if command -v docker-compose &> /dev/null
then
    COMPOSE="docker-compose"
else
    COMPOSE="docker compose"
fi

echo "‚û° Usando: $COMPOSE"

echo "üöÄ Levantando servicios SIN rebuild..."
$COMPOSE up -d

echo "=============================="
echo " COSMOS FITNESS EN MARCHA"
echo " API:      http://localhost:3000"
echo " FRONTEND: http://localhost:8100"
echo "=============================="


------------------------------------------------------------------------------

[ARCHIVO]: ./api/.dockerignore
------------------------------------------------------------------------------
node_modules
npm-debug.log
Dockerfile
.git
.gitignore

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/middleware/bonoActivo.js
------------------------------------------------------------------------------
const { Pago, BonoPlan } = require('../database');
const { Op } = require('sequelize');

module.exports = async function bonoActivo(req, res, next) {

  try {

    const idCliente = req.body.id_cliente;

    if (!idCliente) {
      return res.status(400).json({
        error: 'Falta id_cliente'
      });
    }

    const hoy = new Date();

    const pagoActivo = await Pago.findOne({
      where: {
        id_cliente: idCliente,
        fecha_vencimiento: {
          [Op.gt]: hoy
        }
      },
      include: [BonoPlan]



    });

    if (
   pagoActivo.sesiones_restantes !== null &&
   pagoActivo.sesiones_restantes <= 0
){
   return res.status(403).json({
      error: 'No te quedan sesiones disponibles'
   });
}


    if (!pagoActivo) {
      return res.status(403).json({
        error: 'Necesitas un bono activo para reservar'
      });
    }

    // opcional ‚Äî dejamos info √∫til
    req.bono = pagoActivo;

    next();

  } catch (err) {

    res.status(500).json({
      error: err.message
    });

  }
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/app.js
------------------------------------------------------------------------------
const express = require('express');
const cors = require('cors');
const { initDB, Usuario } = require('./database');
const seed = require('./seed');
const app = express();

app.use(cors({
  origin: [
    'http://localhost:8100',
    'http://127.0.0.1:8100'
  ],
  methods: ['GET','POST','PUT','PATCH','DELETE'],
  allowedHeaders: ['Content-Type','Authorization'],
  credentials: true
}));
app.options('*', cors());


app.use(express.json());


(async () => {
  await initDB();
  await seed();
})();

// Rutas
const usuariosRouter = require('./routes/usuarios');
const horariosRouter = require('./routes/horarios');
const reservasRouter = require('./routes/reservas');
const bonosRouter = require('./routes/bonos');
const pagosRouter = require('./routes/pagos');


app.use('/usuarios', usuariosRouter);
app.use('/horarios', horariosRouter);
app.use('/reservas', reservasRouter);
app.use('/bonos', bonosRouter);
app.use('/pagos', pagosRouter);


// Login
app.post('/login', async (req, res) => {
  try {

    const { email, password } = req.body;

    const user = await Usuario.findOne({
      where: {
        email,
        activo: true
      }
    });

    if (!user) {
      return res.status(401).json({
        error: 'Usuario no v√°lido'
      });
    }

    // comprobar password
    if (user.password_hash !== password) {
      return res.status(401).json({
        error: 'Credenciales incorrectas'
      });
    }

    // üî• eliminar password antes de enviar
    const userSafe = user.toJSON();
    delete userSafe.password_hash;

    res.json(userSafe);

  } catch (err) {
    console.error(err);
    res.status(500).json({
      error: 'Error interno del servidor'
    });
  }
});



// Test
app.get('/', (req, res) => {
  res.json({ mensaje: 'API funcionando üöÄ' });
});

const PORT = process.env.API_PORT || 3000;
app.listen(PORT, () => {
  console.log(`API escuchando en puerto ${PORT}`);
});

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/bonos.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { BonoPlan } = require('../database');


/* =========================
   GET /bonos
========================= */
router.get('/', async (req, res) => {
  try {

    const bonos = await BonoPlan.findAll({
      order: [['precio', 'ASC']]
    });

    res.json(bonos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   POST /bonos
   (admin)
========================= */
router.post('/', async (req, res) => {
  try {

    const bono = await BonoPlan.create(req.body);

    res.status(201).json(bono);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   PUT /bonos/:id
========================= */
router.put('/:id', async (req, res) => {
  try {

    const bono = await BonoPlan.findByPk(req.params.id);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    await bono.update(req.body);

    res.json(bono);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   DELETE /bonos/:id
========================= */
router.delete('/:id', async (req, res) => {
  try {

    const bono = await BonoPlan.findByPk(req.params.id);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    await bono.destroy();

    res.json({
      mensaje: 'Bono eliminado'
    });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/horarios.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Horario, Clase, Usuario, Reserva } = require('../database');

router.get('/', async (req, res) => {
  try {
    const id_cliente = req.query.id_cliente;

    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          include: [
            {
              model: Usuario,
              as: 'profesor',
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false
        }
      ]
    });

    const resultado = horarios.map(h => {
      const reservas = h.Reservas || [];

      const yaReservado = id_cliente
        ? reservas.some(r => r.id_cliente == id_cliente)
        : false;

      const plazas_ocupadas = reservas.length;
      const plazas_totales = h.Clase.capacidad_maxima;

      return {
        ...h.toJSON(),
        plazas_ocupadas,
        plazas_totales,
        plazas_disponibles: plazas_ocupadas < plazas_totales,
        ya_reservado: yaReservado
      };
    });

    res.json(resultado);

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});

// GET /horarios/profesor/:id
router.get('/profesor/:id', async (req, res) => {
  try {
    const { id } = req.params;

    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          where: { id_profesor: id },
          include: [
            {
              model: Usuario,
              as: 'profesor',
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false,
          include: [
            {
              model: Usuario,
              attributes: ['id_usuario', 'nombre', 'apellidos']
            }
          ]
        }
      ],
      order: [['fecha', 'ASC'], ['hora_inicio', 'ASC']]
    });

    const resultado = horarios.map(h => ({
      ...h.toJSON(),
      alumnos: h.Reservas.map(r => r.Usuario),
      plazas_ocupadas: h.Reservas.length,
      plazas_totales: h.Clase.capacidad_maxima
    }));

    res.json(resultado);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});

// PATCH /horarios/:id/cerrar
router.patch('/:id/cerrar', async (req, res) => {
  try {
    const horario = await Horario.findByPk(req.params.id);
    if (!horario) {
      return res.status(404).json({ error: 'Horario no encontrado' });
    }

    horario.reservas_abiertas = false;
    await horario.save();

    res.json({ mensaje: 'Reservas cerradas' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// PATCH /horarios/:id/abrir
router.patch('/:id/abrir', async (req, res) => {
  try {
    const horario = await Horario.findByPk(req.params.id);
    if (!horario) {
      return res.status(404).json({ error: 'Horario no encontrado' });
    }

    horario.reservas_abiertas = true;
    await horario.save();

    res.json({ mensaje: 'Reservas abiertas' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


// =========================
// GET /horarios/:id/alumnos
// =========================
router.get('/:id/alumnos', async (req, res) => {
  try {
    const reservas = await Reserva.findAll({
      where: {
        id_horario: req.params.id,
        estado: 'activa'
      },
      include: [
        {
          model: Usuario,
          attributes: ['id_usuario', 'nombre', 'apellidos', 'email']
        }
      ]
    });

    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// =========================
// GET /horarios/profesor/:id
// =========================
router.get('/profesor/:id', async (req, res) => {
  try {
    const horarios = await Horario.findAll({
      include: [
        {
          model: Clase,
          where: { id_profesor: req.params.id }
        },
        {
          model: Reserva,
          where: { estado: 'activa' },
          required: false
        }
      ],
      order: [['fecha', 'ASC'], ['hora_inicio', 'ASC']]
    });

    const resultado = horarios.map(h => ({
      ...h.toJSON(),
      plazas_ocupadas: h.Reservas.length,
      plazas_totales: h.Clase.capacidad_maxima
    }));

    res.json(resultado);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});



















module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/usuarios.js
------------------------------------------------------------------------------
const express = require("express");
const router = express.Router();
const { Usuario } = require("../database");


/* =========================
   GET /usuarios
========================= */
router.get("/", async (req, res) => {
  try {
    const usuarios = await Usuario.findAll({
  where: { activo: true },
  attributes: { exclude: ['password_hash'] }
});

    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   GET /usuarios/rol/:rol
========================= */
router.get("/rol/:rol", async (req, res) => {
  try {
    const usuarios = await Usuario.findAll({
      where: { rol: req.params.rol },
      attributes: { exclude: ['password_hash'] }
    });

    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   POST /usuarios
========================= */
router.post("/", async (req, res) => {
  try {
    const usuario = await Usuario.create(req.body);

    res.status(201).json(usuario);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   PUT /usuarios/:id
========================= */
router.put("/:id", async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: "Usuario no encontrado" });
    }

    await usuario.update(req.body);

    res.json(usuario);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   DELETE /usuarios/:id
========================= */
router.delete("/:id", async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: "Usuario no encontrado" });
    }

    usuario.activo = false;
    await usuario.save();

    res.json({ mensaje: "Usuario desactivado" });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// ADMIN - Crear usuario
router.post('/admin', async (req, res) => {
  try {

    const {
      nombre,
      apellidos,
      email,
      password_hash,
      telefono,
      rol
    } = req.body;

    const existe = await Usuario.findOne({ where: { email } });

    if (existe) {
      return res.status(400).json({
        error: 'El email ya est√° registrado'
      });
    }

    const usuario = await Usuario.create({
      nombre,
      apellidos,
      email,
      password_hash,
      telefono,
      rol,
      activo: true
    });

    res.status(201).json(usuario);

  } catch (err) {
    res.status(500).json({
      error: err.message
    });
  }
});

// ADMIN - Desactivar usuario
router.patch('/:id/desactivar', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({
        error: 'Usuario no encontrado'
      });
    }

    usuario.activo = false;
    await usuario.save();

    res.json({
      mensaje: 'Usuario desactivado'
    });

  } catch (err) {
    res.status(500).json({
      error: err.message
    });
  }
});

router.get('/admin', async (req, res) => {
  try {

    const usuarios = await Usuario.findAll({
      attributes: [
        'id_usuario',
        'nombre',
        'apellidos',
        'email',
        'rol',
        'activo',
        'fecha_registro'
      ],
      order: [['id_usuario', 'DESC']]
    });

    res.json(usuarios);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

router.patch('/:id/toggle-activo', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }

    usuario.activo = !usuario.activo;

    await usuario.save();

    res.json(usuario);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

router.delete('/:id', async (req, res) => {
  try {

    const usuario = await Usuario.findByPk(req.params.id);

    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }

    // Soft delete profesional
    usuario.activo = false;
    await usuario.save();

    res.json({ mensaje: 'Usuario desactivado' });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/pagos.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Pago, BonoPlan, Usuario } = require('../database');
const { Op } = require('sequelize');


/* =========================
   GET /pagos (admin)
========================= */
router.get('/', async (req, res) => {
  try {

    const pagos = await Pago.findAll({
      include: [
        {
          model: Usuario,
          attributes: ['id_usuario', 'nombre', 'email']
        },
        {
          model: BonoPlan,
          attributes: ['nombre_bono', 'precio']
        }
      ],
      order: [['fecha_pago', 'DESC']]
    });

    res.json(pagos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   GET pagos de un cliente
========================= */
router.get('/cliente/:id', async (req, res) => {
  try {

    const pagos = await Pago.findAll({
      where: { id_cliente: req.params.id },
      include: [BonoPlan],
      order: [['fecha_pago', 'DESC']]
    });

    res.json(pagos);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   BONO ACTIVO
========================= */
router.get('/cliente/:id/activo', async (req, res) => {
  try {

    const hoy = new Date();

    const pago = await Pago.findOne({
      where: {
        id_cliente: req.params.id,
        [Op.or]: [
          { fecha_vencimiento: { [Op.gt]: hoy } },
          { sesiones_restantes: { [Op.gt]: 0 } }
        ]
      },
      include: [BonoPlan],
      order: [['fecha_pago', 'DESC']]
    });

    if (!pago) {
      return res.json({ activo: false });
    }

    res.json({
      activo: true,
      bono: pago.BonoPlan.nombre_bono,
      vence: pago.fecha_vencimiento,
      sesiones_restantes: pago.sesiones_restantes
    });

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


/* =========================
   CREAR PAGO
========================= */
router.post('/', async (req, res) => {
  try {

    const { id_cliente, id_bono, metodo_pago } = req.body;

    const bono = await BonoPlan.findByPk(id_bono);

    if (!bono) {
      return res.status(404).json({
        error: 'Bono no encontrado'
      });
    }

    let fecha_vencimiento = null;
    let sesiones_restantes = null;

    // bonos por duraci√≥n
    if (bono.duracion_dias) {
      fecha_vencimiento = new Date();
      fecha_vencimiento.setDate(
        fecha_vencimiento.getDate() + bono.duracion_dias
      );
    }

    // bonos por sesiones
    if (bono.num_sesiones) {
      sesiones_restantes = bono.num_sesiones;
    }

    const pago = await Pago.create({
      id_cliente,
      id_bono,
      monto: bono.precio,
      metodo_pago,
      fecha_vencimiento,
      sesiones_restantes
    });

    res.status(201).json(pago);

  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/routes/reservas.js
------------------------------------------------------------------------------
const express = require('express');
const router = express.Router();
const { Reserva, Horario, Clase, Usuario } = require('../database');
const bonoActivo = require('../middleware/bonoActivo');


/* =========================
   GET /reservas
========================= */
router.get('/', async (req, res) => {
  try {
    const reservas = await Reserva.findAll();
    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

/* =========================
   GET /reservas/cliente/:id
========================= */
router.get('/cliente/:id', async (req, res) => {
  try {
    const reservas = await Reserva.findAll({
      where: { id_cliente: req.params.id },
      include: [
        {
          model: Horario,
          include: [
            {
              model: Clase,
              include: [
                {
                  model: Usuario,
                  as: 'profesor',
                  attributes: ['nombre', 'apellidos']
                }
              ]
            }
          ]
        }
      ],
      order: [['fecha_reserva', 'DESC']]
    });

    res.json(reservas);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

/* =========================
   POST /reservas
========================= */


router.post('/', bonoActivo, async (req, res) => {
  try {
    const { id_cliente, id_horario } = req.body;

   
    // 1Ô∏è‚É£ Buscar horario + clase
    const horario = await Horario.findByPk(id_horario, {
      include: [Clase]
      
    });

    

    if (!horario) {
      return res.status(404).json({ error: 'Horario no existe' });
    }

    // 2Ô∏è‚É£ Evitar duplicados
    const existente = await Reserva.findOne({
      where: {
        id_cliente,
        id_horario,
        estado: 'activa'
      }
    });

    if (existente) {
      return res.status(400).json({
        error: 'Ya tienes una reserva activa en este horario'
      });
    }

    // 3Ô∏è‚É£ Comprobar capacidad
    const reservasActivas = await Reserva.count({
      where: {
        id_horario,
        estado: 'activa'
      }
    });

    if (reservasActivas >= horario.Clase.capacidad_maxima) {
      return res.status(400).json({
        error: 'No hay plazas disponibles'
      });
    }

    if (!horario.reservas_abiertas) {
  return res.status(400).json({
    error: 'Las reservas est√°n cerradas para este horario'
  });
}

    // 4Ô∏è‚É£ Crear reserva
    const reserva = await Reserva.create({
      id_cliente,
      id_horario,
      estado: 'activa'
    });


    res.status(201).json(reserva);

    if (req.bono.sesiones_restantes !== null) {
   req.bono.sesiones_restantes--;
   await req.bono.save();
}

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Error al crear la reserva' });
  }
});

/* =========================
   PATCH /reservas/:id/cancelar
========================= */
router.patch('/:id/cancelar', async (req, res) => {
  try {
    const reserva = await Reserva.findByPk(req.params.id);

    if (!reserva) {
      return res.status(404).json({ error: 'Reserva no encontrada' });
    }

    if (reserva.estado !== 'activa') {
      return res.status(400).json({ error: 'La reserva no est√° activa' });
    }

    reserva.estado = 'cancelada';
    await reserva.save();

    res.json(reserva);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// PATCH /reservas/:id/forzar-cancelacion
router.patch('/:id/forzar-cancelacion', async (req, res) => {
  try {
    const reserva = await Reserva.findByPk(req.params.id);
    if (!reserva) {
      return res.status(404).json({ error: 'Reserva no encontrada' });
    }

    reserva.estado = 'cancelada';
    await reserva.save();

    res.json({ mensaje: 'Reserva cancelada por el profesor' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


module.exports = router;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/database.js
------------------------------------------------------------------------------
const { Sequelize } = require('sequelize');

const sequelize = new Sequelize(
  process.env.DB_NAME,
  process.env.DB_USER,
  process.env.DB_PASS,
  {
    host: process.env.DB_HOST,
    dialect: 'postgres',
    logging: false,
  }
);

// MODELOS
const Usuario = require('./models/Usuario')(sequelize);
const Clase = require('./models/Clase')(sequelize);
const Horario = require('./models/Horario')(sequelize);
const Reserva = require('./models/Reserva')(sequelize);
const BonoPlan = require('./models/BonoPlan')(sequelize);
const Pago = require('./models/Pago')(sequelize);


// =======================
// RELACIONES
// =======================

// Clase ‚Üî Usuario (profesor)
Clase.belongsTo(Usuario, {
  foreignKey: 'id_profesor',
  as: 'profesor'
});
Usuario.hasMany(Clase, {
  foreignKey: 'id_profesor'
});

// Horario ‚Üî Clase
Horario.belongsTo(Clase, {
  foreignKey: 'id_clase'
});
Clase.hasMany(Horario, {
  foreignKey: 'id_clase'
});

// Reserva ‚Üî Horario
Reserva.belongsTo(Horario, {
  foreignKey: 'id_horario'
});
Horario.hasMany(Reserva, {
  foreignKey: 'id_horario'
});

// Reserva ‚Üî Usuario (cliente)
Reserva.belongsTo(Usuario, {
  foreignKey: 'id_cliente'
});
Usuario.hasMany(Reserva, {
  foreignKey: 'id_cliente'
});

// Pago ‚Üî Usuario (cliente)
Pago.belongsTo(Usuario, {
  foreignKey: 'id_cliente'
});
Usuario.hasMany(Pago, {
  foreignKey: 'id_cliente'
});

// Pago ‚Üî BonoPlan
Pago.belongsTo(BonoPlan, {
  foreignKey: 'id_bono'
});
BonoPlan.hasMany(Pago, {
  foreignKey: 'id_bono'
});




// =======================
// INIT DB
// =======================

async function initDB() {
  await sequelize.authenticate();
  console.log('‚úÖ Conectado a PostgreSQL');
  await sequelize.sync({ alter: false });
  console.log('üöÄ Modelos sincronizados');
}

module.exports = {
  sequelize,
  initDB,
  Usuario,
  Clase,
  Horario,
  Reserva,
  BonoPlan,
  Pago
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/seed.js
------------------------------------------------------------------------------
const { Usuario, Clase, Horario, Reserva, BonoPlan } = require('./database');

async function seed() {

  console.log("üå± Ejecutando seed PRO...");

  // Evitar duplicados
  const usuarios = await Usuario.count();
  if (usuarios > 0) {
    console.log("üå± Seed ya ejecutado");
    return;
  }

  /*
  ========================
  USUARIOS
  ========================
  */

  const clientes = [];

  for (let i = 1; i <= 15; i++) {
    clientes.push({
      nombre: `Cliente${i}`,
      apellidos: 'Fitness',
      email: `cliente${i}@mail.com`,
      password_hash: '1234',
      telefono: '600000000',
      rol: 'cliente',
      fecha_registro: new Date(),
      activo:true
    });
  }

  const usuariosCreados = await Usuario.bulkCreate([
    {
      nombre: 'Admin',
      apellidos: 'Root',
      email: 'admin@mail.com',
      password_hash: 'admin',
      rol: 'admin'
      ,
      activo:true
    },
    {
      nombre: 'Ana',
      apellidos: 'Yoga',
      email: 'ana@mail.com',
      password_hash: '1234',
      rol: 'profesor',
      activo:true
    },
    {
      nombre: 'Carlos',
      apellidos: 'Crossfit',
      email: 'carlos@mail.com',
      password_hash: '1234',
      rol: 'profesor',
      activo:true
    },
    ...clientes
  ]);

  console.log("‚úÖ Usuarios creados");


  /*
  ========================
  CLASES
  ========================
  */

  const clases = await Clase.bulkCreate([
    {
      nombre_clase: 'Yoga',
      descripcion: 'Clase relajante',
      capacidad_maxima: 20,
      id_profesor: 2
    },
    {
      nombre_clase: 'CrossFit',
      descripcion: 'Alta intensidad',
      capacidad_maxima: 15,
      id_profesor: 3
    }
  ]);

  console.log("‚úÖ Clases creadas");


  /*
  ========================
  HORARIOS
  ========================
  */

  const horarios = await Horario.bulkCreate([
    {
      id_clase: 1,
      fecha: '2026-02-01',
      hora_inicio: '09:00',
      hora_fin: '10:00',
      lugar: 'Sala 1',
      reservas_abiertas: true
    },
    {
      id_clase: 2,
      fecha: '2026-02-01',
      hora_inicio: '18:00',
      hora_fin: '19:00',
      lugar: 'Sala 2',
      reservas_abiertas: true
    }
  ]);

  console.log("‚úÖ Horarios creados");


  /*
  Reservas de ejemplo aleatorias.
  */

  const reservas = [];

  for (let i = 4; i <= 12; i++) {
    reservas.push({
      id_cliente: i,
      id_horario: 1,
      estado: 'activa'
    });
  }

  await Reserva.bulkCreate(reservas);

  console.log("‚úÖ Reservas creadas");

  /*
Bonos de usuario.
*/

await BonoPlan.bulkCreate([
  {
    nombre_bono: 'Bono mensual',
    precio: 40,
    duracion_dias: 30,
    descripcion: 'Acceso ilimitado durante 30 d√≠as'
  },
  {
    nombre_bono: 'Bono 10 sesiones',
    precio: 50,
    num_sesiones: 10,
    descripcion: '10 accesos al gimnasio'
  },
  {
    nombre_bono: 'Bono anual',
    precio: 400,
    duracion_dias: 365,
    descripcion: 'Acceso ilimitado durante 1 a√±o'
  }

]);




console.log("‚úÖ Bonos creados");

console.log("üî• SEED PRO COMPLETADO");


//Insertar nuevos elementos de seed arriba de este comentario.
}
//Exports

module.exports = seed;

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Clase.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Clase', {
    id_clase: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    nombre_clase: {
      type: DataTypes.STRING,
      allowNull: false
    },
    descripcion: DataTypes.TEXT,
    capacidad_maxima: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    contenido_profesor: DataTypes.TEXT,
    id_profesor: {
      type: DataTypes.INTEGER,
      allowNull: false
    }
  }, {
    tableName: 'clase',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Horario.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Horario', {
    id_horario: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    id_clase: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    fecha: {
      type: DataTypes.DATEONLY,
      allowNull: false
    },
    hora_inicio: {
      type: DataTypes.TIME,
      allowNull: false
    },
    hora_fin: {
      type: DataTypes.TIME,
      allowNull: false
    },
    reservas_abiertas: {
  type: DataTypes.BOOLEAN,
  defaultValue: true
},
    lugar: DataTypes.STRING
  }, {
    tableName: 'horario',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/BonoPlan.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('BonoPlan', {

    id_bono: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },

    nombre_bono: {
      type: DataTypes.STRING,
      allowNull: false,
      unique: true
    },

    precio: {
      type: DataTypes.DECIMAL(10,2),
      allowNull: false
    },

    duracion_dias: {
      type: DataTypes.INTEGER
    },

    num_sesiones: {
      type: DataTypes.INTEGER
    },

    descripcion: {
      type: DataTypes.TEXT
    }

  }, {
    tableName: 'bono_plan',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Pago.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Pago', {

    id_pago: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },

    id_cliente: {
      type: DataTypes.INTEGER,
      allowNull: false
    },

    id_bono: {
      type: DataTypes.INTEGER,
      allowNull: false
    },

    fecha_pago: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW
    },

    monto: {
      type: DataTypes.DECIMAL(10,2),
      allowNull: false
    },

    metodo_pago: DataTypes.STRING,

    fecha_vencimiento: DataTypes.DATEONLY,

    sesiones_restantes: {
      type: DataTypes.INTEGER,
      allowNull: true
    }

  }, {
    tableName: 'pago',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Reserva.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define('Reserva', {
    id_reserva: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    id_cliente: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    id_horario: {
      type: DataTypes.INTEGER,
      allowNull: false
    },
    fecha_reserva: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW
    },
    estado: {
      type: DataTypes.STRING,
      allowNull: false,
      defaultValue: 'activa'
    }
  }, {
    tableName: 'reserva',
    timestamps: false
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/src/models/Usuario.js
------------------------------------------------------------------------------
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  return sequelize.define("Usuario", {

    id_usuario: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true,
    },

    nombre: DataTypes.STRING,
    apellidos: DataTypes.STRING,

    
    email: {
    type: DataTypes.STRING,
    unique: true,
    allowNull: false,
    validate: {
    isEmail: true
  }
},
    password_hash: {
      type: DataTypes.STRING,
      allowNull:false,
      field: 'password_hash'
},
    telefono: DataTypes.STRING,
    rol: DataTypes.STRING,

    fecha_registro: {
      type: DataTypes.DATEONLY,
      defaultValue: DataTypes.NOW
    },

    activo: {
      type: DataTypes.BOOLEAN,
      defaultValue: true
    }

  }, {
    tableName: "usuario",
    timestamps: false,
  });
};

------------------------------------------------------------------------------

[ARCHIVO]: ./api/package.json
------------------------------------------------------------------------------
{
  "name": "api",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "dev": "nodemon src/app.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "dependencies": {
    "cors": "^2.8.6",
    "express": "^5.2.1",
    "pg": "^8.17.2",
    "pg-hstore": "^2.3.4",
    "sequelize": "^6.37.7"
  },
  "devDependencies": {
    "nodemon": "^3.1.11"
  }
}

------------------------------------------------------------------------------

[ARCHIVO]: ./api/Dockerfile
------------------------------------------------------------------------------
FROM node:20
WORKDIR /app
COPY package*.json ./
RUN npm install
# No copiamos todo aqu√≠ porque usaremos vol√∫menes en compose para desarrollo
COPY . .
EXPOSE 3000
# El usuario node mejora la seguridad y evita l√≠os de permisos en Ubuntu
RUN chown -R node:node /app
USER node
CMD ["npm", "run", "dev"]
------------------------------------------------------------------------------
==============================================================================
INSPECCI√ìN FINALIZADA
==============================================================================
